{
  "comments": [
    {
      "key": {
        "uuid": "ba02669f_6846c0c8",
        "filename": "modules/desktop_capture/BUILD.gn",
        "patchSetId": 10
      },
      "lineNbr": 414,
      "author": {
        "id": 6236
      },
      "writtenOn": "2019-09-10T19:38:23Z",
      "side": 1,
      "message": "In chromium/ui/base/x/BUILD.gn there is \"//build/config/linux:xrandr\" and it seems to just add Xrandr without any condition.",
      "range": {
        "startLine": 414,
        "startChar": 7,
        "endLine": 414,
        "endChar": 13
      },
      "revId": "e7153012682ccd3d1eacc18f802cab7820e3bad3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "be4179d4_413cc803",
        "filename": "modules/desktop_capture/BUILD.gn",
        "patchSetId": 10
      },
      "lineNbr": 414,
      "author": {
        "id": 9600
      },
      "writtenOn": "2019-09-10T22:22:41Z",
      "side": 1,
      "message": "Are you saying I should do this instead:\nconfigs +\u003d [\n  \"//build/config/linux:xrandr\",\n]",
      "parentUuid": "ba02669f_6846c0c8",
      "range": {
        "startLine": 414,
        "startChar": 7,
        "endLine": 414,
        "endChar": 13
      },
      "revId": "e7153012682ccd3d1eacc18f802cab7820e3bad3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7106ad94_f48c919d",
        "filename": "modules/desktop_capture/BUILD.gn",
        "patchSetId": 10
      },
      "lineNbr": 414,
      "author": {
        "id": 6236
      },
      "writtenOn": "2019-09-11T17:44:07Z",
      "side": 1,
      "message": "I meant, the CL was reverted because of chromium and chromium does not guard Xrandr so we need to understand more the reason of the failure.",
      "parentUuid": "be4179d4_413cc803",
      "range": {
        "startLine": 414,
        "startChar": 7,
        "endLine": 414,
        "endChar": 13
      },
      "revId": "e7153012682ccd3d1eacc18f802cab7820e3bad3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cd749fb1_af955d00",
        "filename": "modules/desktop_capture/BUILD.gn",
        "patchSetId": 10
      },
      "lineNbr": 414,
      "author": {
        "id": 9600
      },
      "writtenOn": "2019-09-11T22:01:44Z",
      "side": 1,
      "message": "Oh, I see.\n\nMy current understanding is that https://chromium.googlesource.com/chromium/src.git/+/refs/heads/master/chrome/installer/linux/debian/calculate_package_deps.py uses dpkg-shlibdeps to check package dependencies and then checks them against https://chromium.googlesource.com/chromium/src.git/+/refs/heads/master/chrome/installer/linux/debian/dist_package_versions.json#67\n\nI am running Arch, and I have never made a Debian package before, but from researching dpkg-shlibdeps I am guessing it has detected the XRRGetMonitors symbol and so reported version 1.5.\n\nTo complicate matters for all versions of Debian after Jessie depending on version 1.5 is exactly what we want. However for Debian Jessie it\u0027s probably being too strict given the runtime checks. I will have to setup some Debian VMs to confirm my assumptions.",
      "parentUuid": "7106ad94_f48c919d",
      "range": {
        "startLine": 414,
        "startChar": 7,
        "endLine": 414,
        "endChar": 13
      },
      "revId": "e7153012682ccd3d1eacc18f802cab7820e3bad3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d1d82753_9cd22232",
        "filename": "modules/desktop_capture/BUILD.gn",
        "patchSetId": 10
      },
      "lineNbr": 414,
      "author": {
        "id": 9600
      },
      "writtenOn": "2019-09-12T09:32:58Z",
      "side": 1,
      "message": "I have set up VMs with Debian 8 and Debian 10. I then wrote a small test program that checks the XRandR version and uses XRRGetMonitors to print the monitor count if it\u0027s version 1.5 otherwise it prints the old version number found. The results are as expected. You can compile the program on Debian 10, copy it to Debian 8, and there are no dynamic linking errors when you run it. It prints out version 1.4 for Debian 8. It prints the monitor count for Debian 10. What you can\u0027t do is compile the program on Debian 8.\n\nIs it a requirement that chromium can be compiled from source on a Debian 8 machine?",
      "parentUuid": "cd749fb1_af955d00",
      "range": {
        "startLine": 414,
        "startChar": 7,
        "endLine": 414,
        "endChar": 13
      },
      "revId": "e7153012682ccd3d1eacc18f802cab7820e3bad3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bdd74e85_bdd87efa",
        "filename": "modules/desktop_capture/BUILD.gn",
        "patchSetId": 10
      },
      "lineNbr": 414,
      "author": {
        "id": 9753
      },
      "writtenOn": "2019-09-12T11:40:05Z",
      "side": 1,
      "message": "Just throwing this out there as an idea. I have no way to test this myself. What if you provided a weak stub implementation of XRRGetMonitors() to allow Debian 8 to link, like so:\n\nextern \"C\" {\n__attribute__((weak))\nXRRMonitorInfo *\nXRRGetMonitors(Display *, Window, Bool, int *) { return nullptr; }\n}\n\nIn theory, if xrandr 1.5 is available with a real XRRGetMonitors() implementation it will override the weak stub",
      "parentUuid": "d1d82753_9cd22232",
      "range": {
        "startLine": 414,
        "startChar": 7,
        "endLine": 414,
        "endChar": 13
      },
      "revId": "e7153012682ccd3d1eacc18f802cab7820e3bad3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b31a601a_9edce8c6",
        "filename": "modules/desktop_capture/BUILD.gn",
        "patchSetId": 10
      },
      "lineNbr": 414,
      "author": {
        "id": 9600
      },
      "writtenOn": "2019-09-19T06:38:19Z",
      "side": 1,
      "message": "Thanks for the idea, I have done an experiment with my test program. It will compile on Debian 8 however if that executable is then taken to Debian 10 it will not be able to list monitors. Recompiling on Debian 10 ended up still using the weak stubs. I also tried with #pragma weak.\n\nEven if it had worked, I suspect that the chrome build might still complain, because the symbols are in the file.\n\nI may just have to rewrite it for an older version, at this point that\u0027s starting to look easier, and it will fix the bug for more people. It\u0027s possible other projects using WebRTC might have a similar issue as well depending on their build systems. The only way I can think of now to continue to use XRRGetMonitors without requiring patches to the chrome build system and while allowing compiling from source on Debian 8 is to implement XRRGetMonitors internally under a different name... Depending on how the IPC to the X server works that might not be too difficult the library implementation is quite small. https://gitlab.freedesktop.org/xorg/lib/libxrandr/blob/master/src/XrrMonitor.c",
      "parentUuid": "bdd74e85_bdd87efa",
      "range": {
        "startLine": 414,
        "startChar": 7,
        "endLine": 414,
        "endChar": 13
      },
      "revId": "e7153012682ccd3d1eacc18f802cab7820e3bad3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "390f9249_d3bbaf84",
        "filename": "modules/desktop_capture/BUILD.gn",
        "patchSetId": 10
      },
      "lineNbr": 414,
      "author": {
        "id": 10031
      },
      "writtenOn": "2019-09-28T11:05:24Z",
      "side": 1,
      "message": "Maybe you could load the XRRGetMonitors symbol dynamically with dlsym?\n\nI tested this approach with a small test program and then experimented how dpkg-shlibdeps analyzes the dependencies. It seems that this approach would produce a dependency to the 1.4 version of xrandr (generated dep is just \"libxrandr2\" rather than \"libxrandr2 (\u003e\u003d 2:1.5.0)\").\n\nHere\u0027s my test program https://gist.github.com/suutari/b1f19ef1897af8ee814b344a873501f6",
      "parentUuid": "b31a601a_9edce8c6",
      "range": {
        "startLine": 414,
        "startChar": 7,
        "endLine": 414,
        "endChar": 13
      },
      "revId": "e7153012682ccd3d1eacc18f802cab7820e3bad3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    }
  ]
}