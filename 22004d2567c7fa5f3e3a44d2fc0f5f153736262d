{
  "comments": [
    {
      "key": {
        "uuid": "77841ff8_d2fc2b57",
        "filename": "rtc_base/bit_buffer.cc",
        "patchSetId": 5
      },
      "lineNbr": 320,
      "author": {
        "id": 5126
      },
      "writtenOn": "2019-07-02T14:31:39Z",
      "side": 1,
      "message": "int; there\u0027s no particular reason to use any other type, is there?",
      "range": {
        "startLine": 320,
        "startChar": 2,
        "endLine": 320,
        "endChar": 8
      },
      "revId": "22004d2567c7fa5f3e3a44d2fc0f5f153736262d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7bc8556c_9933ea33",
        "filename": "rtc_base/bit_buffer.cc",
        "patchSetId": 5
      },
      "lineNbr": 320,
      "author": {
        "id": 5019
      },
      "writtenOn": "2019-07-03T12:04:30Z",
      "side": 1,
      "message": "CountBits function returns size_t. Is it good enough reason to keep using size_t?\n(may be CountBits better return int, but I think that is out of scope of this change).",
      "parentUuid": "77841ff8_d2fc2b57",
      "range": {
        "startLine": 320,
        "startChar": 2,
        "endLine": 320,
        "endChar": 8
      },
      "revId": "22004d2567c7fa5f3e3a44d2fc0f5f153736262d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "012dd18d_63d0f2f0",
        "filename": "rtc_base/bit_buffer.cc",
        "patchSetId": 5
      },
      "lineNbr": 321,
      "author": {
        "id": 5126
      },
      "writtenOn": "2019-07-02T14:31:39Z",
      "side": 1,
      "message": "a \u003c\u003c b has the type of its left operand, so you need to say unit32_t{1} \u003c\u003c count_bits if you don\u0027t want UB if num_values \u003e\u003d 2^30. But then you still get UB if num_values \u003e\u003d 2^31. So I think you need\n\n  uint32_t num_min_bits_values \u003d static_cast\u003cuint32_t\u003e(uint64_t{1} \u003c\u003c count_bits) - num_values;",
      "range": {
        "startLine": 321,
        "startChar": 34,
        "endLine": 321,
        "endChar": 49
      },
      "revId": "22004d2567c7fa5f3e3a44d2fc0f5f153736262d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "774e3cf1_0eab9aef",
        "filename": "rtc_base/bit_buffer.cc",
        "patchSetId": 5
      },
      "lineNbr": 321,
      "author": {
        "id": 5019
      },
      "writtenOn": "2019-07-03T12:04:30Z",
      "side": 1,
      "message": "changed int{1} to uint32_t{1}\ninstead of handling case count_bits\u003d32, DCHECKed to document it is not supported\n(I\u0027m unaware of use case where num_values is so large. for those cases it is more likely better to use fixed-size encoding.)",
      "parentUuid": "012dd18d_63d0f2f0",
      "range": {
        "startLine": 321,
        "startChar": 34,
        "endLine": 321,
        "endChar": 49
      },
      "revId": "22004d2567c7fa5f3e3a44d2fc0f5f153736262d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "108480b5_75d4d830",
        "filename": "rtc_base/bit_buffer.h",
        "patchSetId": 5
      },
      "lineNbr": 58,
      "author": {
        "id": 5126
      },
      "writtenOn": "2019-07-02T14:31:39Z",
      "side": 1,
      "message": "I don\u0027t understand these docs, particularly the last line. Does it read k bits, where k is the smallest integer such that 2^k \u003c num_values? (And in that case, what happens if the bit pattern in those k bits corresponds to a number larger than num_values?)\n\nAlso, using max_val instead of num_values (with the range [0, max_val] instead of [0, num_values - 1]) would not needlessly exclude the [0, 2^32 - 1] range.\n\n...Having read the rest implementation, I would suggest something like this:\n\n  // Reads a value in the range [0, max_val]. Let n be the smallest integer such that 2^n \u003e max_val, and let k \u003d 2^n - 1 - max_val. An integer x in [0, k) is coded with n - 1 bits in the obvious way, and an integer x in [k, max_val] is coded as x + k with n bits.\n  // Returns false if not enough bits remain. (This is the only failure mode, since all bit patterns are valid inputs.)\n  bool ReadNonSymmetric(uint32_t* val, uint32_t max_val);",
      "revId": "22004d2567c7fa5f3e3a44d2fc0f5f153736262d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e9915c6c_82ec41da",
        "filename": "rtc_base/bit_buffer.h",
        "patchSetId": 5
      },
      "lineNbr": 58,
      "author": {
        "id": 5126
      },
      "writtenOn": "2019-07-03T11:59:00Z",
      "side": 1,
      "message": "Is there a Wikipedia page or RFC or something that describes this encoding scheme, that you could point to?",
      "parentUuid": "108480b5_75d4d830",
      "revId": "22004d2567c7fa5f3e3a44d2fc0f5f153736262d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3edf59ea_95920ea5",
        "filename": "rtc_base/bit_buffer.h",
        "patchSetId": 5
      },
      "lineNbr": 58,
      "author": {
        "id": 5019
      },
      "writtenOn": "2019-07-03T12:04:30Z",
      "side": 1,
      "message": "I would prefer to keep using num_values rather than max_val\nin particular because in c++ it is more common to specify upper bound exclusive rather than inclusive.\nif num_values \u003d\u003d 2³², then it is better to use ReadUInt32.\nFor my use case num_values will be maximum 33.\n\nUpdated the documentation with more details how this encoding works (by copy-pasting WriteNonSymmetric implementation and translating it to English)\n\nI took this encoding from av1 spec:\nhttps://aomediacodec.github.io/av1-spec/#nsn\nBut I didn\u0027t found more central rfc or wiki for that format",
      "parentUuid": "108480b5_75d4d830",
      "revId": "22004d2567c7fa5f3e3a44d2fc0f5f153736262d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "438379ca_a2c08547",
        "filename": "rtc_base/bit_buffer.h",
        "patchSetId": 5
      },
      "lineNbr": 117,
      "author": {
        "id": 5126
      },
      "writtenOn": "2019-07-02T14:31:39Z",
      "side": 1,
      "message": "Specify the number of bits written. Also, same comment as above regarding num_values vs. max_val.",
      "revId": "22004d2567c7fa5f3e3a44d2fc0f5f153736262d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "571987ce_8058d4c0",
        "filename": "rtc_base/bit_buffer.h",
        "patchSetId": 5
      },
      "lineNbr": 117,
      "author": {
        "id": 5019
      },
      "writtenOn": "2019-07-03T12:04:30Z",
      "side": 1,
      "message": "added math-readable hints how many bits will be used. Since exact number of bits is non-trivial, there is dedicated run-time function to get it.",
      "parentUuid": "438379ca_a2c08547",
      "revId": "22004d2567c7fa5f3e3a44d2fc0f5f153736262d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "64d93280_cac822b5",
        "filename": "rtc_base/bit_buffer_unittest.cc",
        "patchSetId": 5
      },
      "lineNbr": 201,
      "author": {
        "id": 5126
      },
      "writtenOn": "2019-07-02T14:31:39Z",
      "side": 1,
      "message": "{} is better. {0, 0} is OK too, but then you have the possibility of size mismatch.",
      "range": {
        "startLine": 201,
        "startChar": 21,
        "endLine": 201,
        "endChar": 24
      },
      "revId": "22004d2567c7fa5f3e3a44d2fc0f5f153736262d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d0547f14_3fa3a3b7",
        "filename": "rtc_base/bit_buffer_unittest.cc",
        "patchSetId": 5
      },
      "lineNbr": 201,
      "author": {
        "id": 5126
      },
      "writtenOn": "2019-07-03T11:59:00Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "64d93280_cac822b5",
      "range": {
        "startLine": 201,
        "startChar": 21,
        "endLine": 201,
        "endChar": 24
      },
      "revId": "22004d2567c7fa5f3e3a44d2fc0f5f153736262d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b7da6c3e_1c172446",
        "filename": "rtc_base/bit_buffer_unittest.cc",
        "patchSetId": 5
      },
      "lineNbr": 201,
      "author": {
        "id": 5019
      },
      "writtenOn": "2019-07-03T12:04:30Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "64d93280_cac822b5",
      "range": {
        "startLine": 201,
        "startChar": 21,
        "endLine": 201,
        "endChar": 24
      },
      "revId": "22004d2567c7fa5f3e3a44d2fc0f5f153736262d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d170411b_58501c5e",
        "filename": "rtc_base/bit_buffer_unittest.cc",
        "patchSetId": 5
      },
      "lineNbr": 202,
      "author": {
        "id": 5126
      },
      "writtenOn": "2019-07-02T14:31:39Z",
      "side": 1,
      "message": "Why the explicit size (which can mismatch)? Doesn\u0027t BitBufferWriter take an ArrayView argument?",
      "range": {
        "startLine": 202,
        "startChar": 32,
        "endLine": 202,
        "endChar": 33
      },
      "revId": "22004d2567c7fa5f3e3a44d2fc0f5f153736262d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f5c58a7a_a53e90a1",
        "filename": "rtc_base/bit_buffer_unittest.cc",
        "patchSetId": 5
      },
      "lineNbr": 202,
      "author": {
        "id": 5019
      },
      "writtenOn": "2019-07-03T12:04:30Z",
      "side": 1,
      "message": "It doesn\u0027t.\nthere is only one constructor for BitBufferWriter (and only one for BitBuffer)",
      "parentUuid": "d170411b_58501c5e",
      "range": {
        "startLine": 202,
        "startChar": 32,
        "endLine": 202,
        "endChar": 33
      },
      "revId": "22004d2567c7fa5f3e3a44d2fc0f5f153736262d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4f9b2b1b_d4ef37d6",
        "filename": "rtc_base/bit_buffer_unittest.cc",
        "patchSetId": 5
      },
      "lineNbr": 221,
      "author": {
        "id": 5126
      },
      "writtenOn": "2019-07-02T14:31:39Z",
      "side": 1,
      "message": "You already have a unit test for reading. Why not just EXPECT that the right bytes are in the array?",
      "range": {
        "startLine": 213,
        "startChar": 0,
        "endLine": 221,
        "endChar": 55
      },
      "revId": "22004d2567c7fa5f3e3a44d2fc0f5f153736262d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "569056a0_0db6dddb",
        "filename": "rtc_base/bit_buffer_unittest.cc",
        "patchSetId": 5
      },
      "lineNbr": 221,
      "author": {
        "id": 5126
      },
      "writtenOn": "2019-07-03T11:59:00Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "4f9b2b1b_d4ef37d6",
      "range": {
        "startLine": 213,
        "startChar": 0,
        "endLine": 221,
        "endChar": 55
      },
      "revId": "22004d2567c7fa5f3e3a44d2fc0f5f153736262d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "df197c0b_8d49e11c",
        "filename": "rtc_base/bit_buffer_unittest.cc",
        "patchSetId": 5
      },
      "lineNbr": 221,
      "author": {
        "id": 5019
      },
      "writtenOn": "2019-07-03T12:04:30Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "4f9b2b1b_d4ef37d6",
      "range": {
        "startLine": 213,
        "startChar": 0,
        "endLine": 221,
        "endChar": 55
      },
      "revId": "22004d2567c7fa5f3e3a44d2fc0f5f153736262d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    }
  ]
}