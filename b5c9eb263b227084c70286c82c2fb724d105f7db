{
  "comments": [
    {
      "key": {
        "uuid": "48a6e68e_3482b607",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 12214
      },
      "writtenOn": "2020-07-08T12:56:32Z",
      "side": 1,
      "message": "well, I could debug this at least. Bear with me :-)\n\nI added debug along these lines to MonitoringAudioPacketizationCallback::SendData\n\n  printf(\"frame_type %d payload_type %d ts\u003d%d delta\u003d%ld, len\u003d%ld\\n\",\n    static_cast\u003cint\u003e(frame_type), payload_type, timestamp, timestamp - fippo_ts, payload_len_bytes);\n\nReminder: the position in the file is such that there is silence followed by non-silence.\nframe_type 2 \u003d\u003e CN, 1 \u003d\u003e speech, 0 \u003d\u003e empty.\n\nFor opus mono without dtx this looks as follows:\nframe_type 2 payload_type 17 ts\u003d305419896 delta\u003d305419896, len\u003d68\nframe_type 2 payload_type 17 ts\u003d305420856 delta\u003d960, len\u003d68\nframe_type 2 payload_type 17 ts\u003d305421816 delta\u003d960, len\u003d67\nframe_type 2 payload_type 17 ts\u003d305422776 delta\u003d960, len\u003d68\nframe_type 2 payload_type 17 ts\u003d305423736 delta\u003d960, len\u003d71\nframe_type 2 payload_type 17 ts\u003d305424696 delta\u003d960, len\u003d68\nframe_type 2 payload_type 17 ts\u003d305425656 delta\u003d960, len\u003d74\nframe_type 2 payload_type 17 ts\u003d305426616 delta\u003d960, len\u003d66\nframe_type 2 payload_type 17 ts\u003d305427576 delta\u003d960, len\u003d70\nframe_type 2 payload_type 17 ts\u003d305428536 delta\u003d960, len\u003d60\nframe_type 2 payload_type 17 ts\u003d305429496 delta\u003d960, len\u003d63\nframe_type 2 payload_type 17 ts\u003d305430456 delta\u003d960, len\u003d66\nframe_type 2 payload_type 17 ts\u003d305431416 delta\u003d960, len\u003d61\nframe_type 2 payload_type 17 ts\u003d305432376 delta\u003d960, len\u003d64\nframe_type 2 payload_type 17 ts\u003d305433336 delta\u003d960, len\u003d64\nframe_type 2 payload_type 17 ts\u003d305434296 delta\u003d960, len\u003d70\nframe_type 2 payload_type 17 ts\u003d305435256 delta\u003d960, len\u003d69\nframe_type 2 payload_type 17 ts\u003d305436216 delta\u003d960, len\u003d71\nframe_type 2 payload_type 17 ts\u003d305437176 delta\u003d960, len\u003d66\nframe_type 2 payload_type 17 ts\u003d305438136 delta\u003d960, len\u003d69\nframe_type 2 payload_type 17 ts\u003d305439096 delta\u003d960, len\u003d60\nframe_type 2 payload_type 17 ts\u003d305440056 delta\u003d960, len\u003d69\nframe_type 2 payload_type 17 ts\u003d305441016 delta\u003d960, len\u003d67\nframe_type 2 payload_type 17 ts\u003d305441976 delta\u003d960, len\u003d66\nframe_type 2 payload_type 17 ts\u003d305442936 delta\u003d960, len\u003d66\nframe_type 2 payload_type 17 ts\u003d305443896 delta\u003d960, len\u003d84\nframe_type 1 payload_type 17 ts\u003d305444856 delta\u003d960, len\u003d79\nframe_type 1 payload_type 17 ts\u003d305445816 delta\u003d960, len\u003d90\nframe_type 1 payload_type 17 ts\u003d305446776 delta\u003d960, len\u003d87\nframe_type 1 payload_type 17 ts\u003d305447736 delta\u003d960, len\u003d82\nframe_type 1 payload_type 17 ts\u003d305448696 delta\u003d960, len\u003d88\nframe_type 1 payload_type 17 ts\u003d305449656 delta\u003d960, len\u003d89\nframe_type 1 payload_type 17 ts\u003d305450616 delta\u003d960, len\u003d83\nframe_type 1 payload_type 17 ts\u003d305451576 delta\u003d960, len\u003d86\nframe_type 1 payload_type 17 ts\u003d305452536 delta\u003d960, len\u003d84\nframe_type 1 payload_type 17 ts\u003d305453496 delta\u003d960, len\u003d90\nframe_type 1 payload_type 17 ts\u003d305454456 delta\u003d960, len\u003d81\nframe_type 1 payload_type 17 ts\u003d305455416 delta\u003d960, len\u003d83\nframe_type 1 payload_type 17 ts\u003d305456376 delta\u003d960, len\u003d97\nframe_type 1 payload_type 17 ts\u003d305457336 delta\u003d960, len\u003d93\nframe_type 1 payload_type 17 ts\u003d305458296 delta\u003d960, len\u003d84\nframe_type 1 payload_type 17 ts\u003d305459256 delta\u003d960, len\u003d79\nframe_type 1 payload_type 17 ts\u003d305460216 delta\u003d960, len\u003d79\nframe_type 1 payload_type 17 ts\u003d305461176 delta\u003d960, len\u003d73\nframe_type 1 payload_type 17 ts\u003d305462136 delta\u003d960, len\u003d77\nframe_type 1 payload_type 17 ts\u003d305463096 delta\u003d960, len\u003d88\nframe_type 1 payload_type 17 ts\u003d305464056 delta\u003d960, len\u003d83\nframe_type 1 payload_type 17 ts\u003d305465016 delta\u003d960, len\u003d83\nframe_type 1 payload_type 17 ts\u003d305465976 delta\u003d960, len\u003d87\nframe_type 1 payload_type 17 ts\u003d305466936 delta\u003d960, len\u003d89\n\nOn master, frame type is always 1 here. We get 2 because we set the speech bit correctly now.\nSame same for mono with dtx:\nframe_type 1 payload_type 17 ts\u003d305467896 delta\u003d960, len\u003d74\nframe_type 2 payload_type 17 ts\u003d305468856 delta\u003d960, len\u003d60\nframe_type 2 payload_type 17 ts\u003d305469816 delta\u003d960, len\u003d65\nframe_type 2 payload_type 17 ts\u003d305470776 delta\u003d960, len\u003d68\nframe_type 2 payload_type 17 ts\u003d305471736 delta\u003d960, len\u003d67\nframe_type 2 payload_type 17 ts\u003d305472696 delta\u003d960, len\u003d68\nframe_type 2 payload_type 17 ts\u003d305473656 delta\u003d960, len\u003d67\nframe_type 2 payload_type 17 ts\u003d305474616 delta\u003d960, len\u003d66\nframe_type 2 payload_type 17 ts\u003d305475576 delta\u003d960, len\u003d72\nframe_type 2 payload_type 17 ts\u003d305476536 delta\u003d960, len\u003d69\nframe_type 2 payload_type 17 ts\u003d305477496 delta\u003d960, len\u003d73\nframe_type 2 payload_type 17 ts\u003d305478456 delta\u003d960, len\u003d72\nframe_type 2 payload_type 17 ts\u003d305479416 delta\u003d960, len\u003d67\nframe_type 2 payload_type 17 ts\u003d305480376 delta\u003d960, len\u003d67\nframe_type 2 payload_type 17 ts\u003d305481336 delta\u003d960, len\u003d68\nframe_type 2 payload_type 17 ts\u003d305482296 delta\u003d960, len\u003d73\nframe_type 2 payload_type 17 ts\u003d305483256 delta\u003d960, len\u003d72\nframe_type 2 payload_type 17 ts\u003d305484216 delta\u003d960, len\u003d71\nframe_type 2 payload_type 17 ts\u003d305485176 delta\u003d960, len\u003d1\nframe_type 0 payload_type 17 ts\u003d305486136 delta\u003d960, len\u003d0\nframe_type 0 payload_type 17 ts\u003d305487096 delta\u003d960, len\u003d0\nframe_type 0 payload_type 17 ts\u003d305488056 delta\u003d960, len\u003d0\nframe_type 0 payload_type 17 ts\u003d305489016 delta\u003d960, len\u003d0\nframe_type 0 payload_type 17 ts\u003d305489976 delta\u003d960, len\u003d0\nframe_type 0 payload_type 17 ts\u003d305490936 delta\u003d960, len\u003d0\nframe_type 0 payload_type 17 ts\u003d305491896 delta\u003d960, len\u003d0\nframe_type 1 payload_type 17 ts\u003d305492856 delta\u003d960, len\u003d78\nframe_type 1 payload_type 17 ts\u003d305493816 delta\u003d960, len\u003d90\nframe_type 1 payload_type 17 ts\u003d305494776 delta\u003d960, len\u003d88\nframe_type 1 payload_type 17 ts\u003d305495736 delta\u003d960, len\u003d79\nframe_type 1 payload_type 17 ts\u003d305496696 delta\u003d960, len\u003d84\nframe_type 1 payload_type 17 ts\u003d305497656 delta\u003d960, len\u003d87\nframe_type 1 payload_type 17 ts\u003d305498616 delta\u003d960, len\u003d86\nframe_type 1 payload_type 17 ts\u003d305499576 delta\u003d960, len\u003d86\nframe_type 1 payload_type 17 ts\u003d305500536 delta\u003d960, len\u003d82\nframe_type 1 payload_type 17 ts\u003d305501496 delta\u003d960, len\u003d92\nframe_type 1 payload_type 17 ts\u003d305502456 delta\u003d960, len\u003d83\nframe_type 1 payload_type 17 ts\u003d305503416 delta\u003d960, len\u003d84\nframe_type 1 payload_type 17 ts\u003d305504376 delta\u003d960, len\u003d96\nframe_type 1 payload_type 17 ts\u003d305505336 delta\u003d960, len\u003d94\nframe_type 1 payload_type 17 ts\u003d305506296 delta\u003d960, len\u003d82\nframe_type 1 payload_type 17 ts\u003d305507256 delta\u003d960, len\u003d81\nframe_type 1 payload_type 17 ts\u003d305508216 delta\u003d960, len\u003d91\nframe_type 1 payload_type 17 ts\u003d305509176 delta\u003d960, len\u003d74\nframe_type 1 payload_type 17 ts\u003d305510136 delta\u003d960, len\u003d78\nframe_type 1 payload_type 17 ts\u003d305511096 delta\u003d960, len\u003d82\nframe_type 1 payload_type 17 ts\u003d305512056 delta\u003d960, len\u003d84\nframe_type 1 payload_type 17 ts\u003d305513016 delta\u003d960, len\u003d87\nframe_type 1 payload_type 17 ts\u003d305513976 delta\u003d960, len\u003d87\nframe_type 1 payload_type 17 ts\u003d305514936 delta\u003d960, len\u003d89\n\nStereo without dtx does not change compared to master:\nstereo, no dtx\nframe_type 1 payload_type 17 ts\u003d305515896 delta\u003d960, len\u003d214\nframe_type 1 payload_type 17 ts\u003d305516856 delta\u003d960, len\u003d114\nframe_type 1 payload_type 17 ts\u003d305517816 delta\u003d960, len\u003d155\nframe_type 1 payload_type 17 ts\u003d305518776 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305519736 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305520696 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305521656 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305522616 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305523576 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305524536 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305525496 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305526456 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305527416 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305528376 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305529336 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305530296 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305531256 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305532216 delta\u003d960, len\u003d175\nframe_type 1 payload_type 17 ts\u003d305533176 delta\u003d960, len\u003d172\nframe_type 1 payload_type 17 ts\u003d305534136 delta\u003d960, len\u003d172\nframe_type 1 payload_type 17 ts\u003d305535096 delta\u003d960, len\u003d127\nframe_type 1 payload_type 17 ts\u003d305536056 delta\u003d960, len\u003d159\nframe_type 1 payload_type 17 ts\u003d305537016 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305537976 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305538936 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305539896 delta\u003d960, len\u003d249\nframe_type 1 payload_type 17 ts\u003d305540856 delta\u003d960, len\u003d199\nframe_type 1 payload_type 17 ts\u003d305541816 delta\u003d960, len\u003d181\nframe_type 1 payload_type 17 ts\u003d305542776 delta\u003d960, len\u003d175\nframe_type 1 payload_type 17 ts\u003d305543736 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305544696 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305545656 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305546616 delta\u003d960, len\u003d140\nframe_type 1 payload_type 17 ts\u003d305547576 delta\u003d960, len\u003d140\nframe_type 1 payload_type 17 ts\u003d305548536 delta\u003d960, len\u003d137\nframe_type 1 payload_type 17 ts\u003d305549496 delta\u003d960, len\u003d150\nframe_type 1 payload_type 17 ts\u003d305550456 delta\u003d960, len\u003d199\nframe_type 1 payload_type 17 ts\u003d305551416 delta\u003d960, len\u003d163\nframe_type 1 payload_type 17 ts\u003d305552376 delta\u003d960, len\u003d198\nframe_type 1 payload_type 17 ts\u003d305553336 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305554296 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305555256 delta\u003d960, len\u003d154\nframe_type 1 payload_type 17 ts\u003d305556216 delta\u003d960, len\u003d162\nframe_type 1 payload_type 17 ts\u003d305557176 delta\u003d960, len\u003d167\nframe_type 1 payload_type 17 ts\u003d305558136 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305559096 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305560056 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305561016 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305561976 delta\u003d960, len\u003d156\nframe_type 1 payload_type 17 ts\u003d305562936 delta\u003d960, len\u003d157\n\nQuite notably we never get frame_type\u003d2 here.\nNow stereo with dtx enabled gives the following:\nframe_type 1 payload_type 17 ts\u003d305563896 delta\u003d960, len\u003d170\nframe_type 1 payload_type 17 ts\u003d305564856 delta\u003d960, len\u003d114\nframe_type 1 payload_type 17 ts\u003d305565816 delta\u003d960, len\u003d103\nframe_type 1 payload_type 17 ts\u003d305566776 delta\u003d960, len\u003d108\nframe_type 1 payload_type 17 ts\u003d305567736 delta\u003d960, len\u003d159\nframe_type 1 payload_type 17 ts\u003d305568696 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305569656 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305570616 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305571576 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305572536 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305573496 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305574456 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305575416 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305576376 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305577336 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305578296 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305579256 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305580216 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305581176 delta\u003d960, len\u003d1\nframe_type 0 payload_type 17 ts\u003d305582136 delta\u003d960, len\u003d0\nframe_type 0 payload_type 17 ts\u003d305583096 delta\u003d960, len\u003d0\nframe_type 0 payload_type 17 ts\u003d305584056 delta\u003d960, len\u003d0\nframe_type 0 payload_type 17 ts\u003d305585016 delta\u003d960, len\u003d0\nframe_type 0 payload_type 17 ts\u003d305585976 delta\u003d960, len\u003d0\nframe_type 0 payload_type 17 ts\u003d305586936 delta\u003d960, len\u003d0\nframe_type 0 payload_type 17 ts\u003d305587896 delta\u003d960, len\u003d0\nframe_type 1 payload_type 17 ts\u003d305588856 delta\u003d960, len\u003d208\nframe_type 1 payload_type 17 ts\u003d305589816 delta\u003d960, len\u003d186\nframe_type 1 payload_type 17 ts\u003d305590776 delta\u003d960, len\u003d171\nframe_type 1 payload_type 17 ts\u003d305591736 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305592696 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305593656 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305594616 delta\u003d960, len\u003d152\nframe_type 1 payload_type 17 ts\u003d305595576 delta\u003d960, len\u003d151\nframe_type 1 payload_type 17 ts\u003d305596536 delta\u003d960, len\u003d148\nframe_type 1 payload_type 17 ts\u003d305597496 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305598456 delta\u003d960, len\u003d193\nframe_type 1 payload_type 17 ts\u003d305599416 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305600376 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305601336 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305602296 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305603256 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305604216 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305605176 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305606136 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305607096 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305608056 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305609016 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305609976 delta\u003d960, len\u003d161\nframe_type 1 payload_type 17 ts\u003d305610936 delta\u003d960, len\u003d161\n\nThere is a subtle difference to the code on the main branch which shows this:\nframe_type 2 payload_type 17 ts\u003d305581176 delta\u003d960, len\u003d1\n\nThis branch has\nframe_type 1 payload_type 17 ts\u003d305581176 delta\u003d960, len\u003d1\nand its on the 19th frame. That is related to the MAX_CONSECUTIVE_DTX thing that got removed.\n\nSo we have .speech set to true on a frame that is a single byte long... that is because we return -1 not only in CELT mode but also if there are no silk frames in the packet in WebRtcOpus_PacketHasVoiceActivity.\nThis sets the speech flag which seems wrong.\n\nVery subtle ;-)",
      "revId": "b5c9eb263b227084c70286c82c2fb724d105f7db",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    }
  ]
}