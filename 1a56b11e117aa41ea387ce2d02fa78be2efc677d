{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "86ff36d6_68964fcd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 5053
      },
      "writtenOn": "2021-07-19T23:05:07Z",
      "side": 1,
      "message": "\u003e Patch Set 4:\n\u003e \n\u003e On vacation without PC, but check for performance regression before submitting.\n\nWhen doing 100-transceiver negotiations, the additional offer validation took an average of 20us, which seems acceptable to me.",
      "revId": "1a56b11e117aa41ea387ce2d02fa78be2efc677d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4a413955_ad1b69bd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 5142
      },
      "writtenOn": "2021-07-20T08:25:53Z",
      "side": 1,
      "message": "LGTM with comments",
      "revId": "1a56b11e117aa41ea387ce2d02fa78be2efc677d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "364d6cdc_2c76cf48",
        "filename": "pc/jsep_transport_collection.cc",
        "patchSetId": 4
      },
      "lineNbr": 39,
      "author": {
        "id": 5142
      },
      "writtenOn": "2021-07-20T08:25:53Z",
      "side": 1,
      "message": "nit: \"If this is an offer\"",
      "revId": "1a56b11e117aa41ea387ce2d02fa78be2efc677d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "db045b02_f460d1c7",
        "filename": "pc/jsep_transport_collection.cc",
        "patchSetId": 4
      },
      "lineNbr": 39,
      "author": {
        "id": 5053
      },
      "writtenOn": "2021-07-20T21:11:05Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "364d6cdc_2c76cf48",
      "revId": "1a56b11e117aa41ea387ce2d02fa78be2efc677d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fbe4dfcc_ecef3137",
        "filename": "pc/jsep_transport_collection.cc",
        "patchSetId": 4
      },
      "lineNbr": 47,
      "author": {
        "id": 5053
      },
      "writtenOn": "2021-07-10T00:26:13Z",
      "side": 1,
      "message": "Note that this is safe due to the additional validation I added, which ensures there is a 1:1 mapping between existing and new bundle groups.",
      "revId": "1a56b11e117aa41ea387ce2d02fa78be2efc677d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7c949dd5_efee1f08",
        "filename": "pc/jsep_transport_collection.cc",
        "patchSetId": 4
      },
      "lineNbr": 65,
      "author": {
        "id": 5142
      },
      "writtenOn": "2021-07-20T08:25:53Z",
      "side": 1,
      "message": "A thought not related to this CL specifically... so no action needed in this CL but I\u0027m curious what you think:\n\nI wonder how well \"rollback\" works together with bundle groups considering we store states for which bundle group certain MIDs belong to?\n\nE.g. glare happening when the two endpoints are trying to add different types of tracks: apply an offer putting a MID in VIDEO group, roll back, and then put the same MID in AUDIO group instead.",
      "revId": "1a56b11e117aa41ea387ce2d02fa78be2efc677d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bbb85eb6_c0e1c3b5",
        "filename": "pc/jsep_transport_collection.cc",
        "patchSetId": 4
      },
      "lineNbr": 65,
      "author": {
        "id": 5053
      },
      "writtenOn": "2021-07-20T21:11:05Z",
      "side": 1,
      "message": "This concern is actually very related to this CL. Previously an offer could only update a bundle group if using max-bundle, but now it always can. The example you provide is a situation where the extra offer validation would now say \"the new MID is moving between groups\".\n\nAnd even ignoring the fact that established_bundle_groups_by_mid_/bundle_groups_ are not being rolled back, in some corner cases this has consequences that potentially aren\u0027t being handled by RollbackTransports. What if the offer causes an existing m\u003d section to be bundled on a different or new MID? Such as going from:\n\n[1,2],3(unbundled)\n|\nv\n[1,2,3]\n\nRollbackTransports will not undo this bundling. And it can\u0027t, because 3\u0027s transport will already have been destroyed...\n\nSo it seems like we need to:\n1. Keep transports that otherwise would be deleted around until an answer has been applied.\n2. Don\u0027t only keep track of \"pending_mids_\"; keep track of all mid-\u003etransport mappings from the last stable state.\n\nI don\u0027t think this should be too hard. But if it ends up being too involved, I\u0027ll leave this as is (or maybe just make sure bundle_groups_/established_bundle_groups_by_mid_ are rolled back).",
      "parentUuid": "7c949dd5_efee1f08",
      "revId": "1a56b11e117aa41ea387ce2d02fa78be2efc677d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "50395de8_d7eeb4a2",
        "filename": "pc/jsep_transport_collection.cc",
        "patchSetId": 4
      },
      "lineNbr": 65,
      "author": {
        "id": 5053
      },
      "writtenOn": "2021-07-21T01:35:26Z",
      "side": 1,
      "message": "I\u0027m wondering now, if this CL is too complex/risky, maybe we just revert https://webrtc-review.googlesource.com/c/src/+/221601 for M93? Anyone who really wants to avoid the redundant transports can already use max-bundle.",
      "parentUuid": "bbb85eb6_c0e1c3b5",
      "revId": "1a56b11e117aa41ea387ce2d02fa78be2efc677d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "17692697_c240187f",
        "filename": "pc/jsep_transport_collection.cc",
        "patchSetId": 4
      },
      "lineNbr": 65,
      "author": {
        "id": 5142
      },
      "writtenOn": "2021-07-21T08:17:42Z",
      "side": 1,
      "message": "I don\u0027t think rollback of multi-bundle is a common use case since rollback is a Unified Plan-only feature and multiple bundle groups was not supported in Unified Plan prior to M92. So the Plan B users who are used to multiple transports wouldn\u0027t have used rollback anyway, and the Unified Plan users who used rollback wouldn\u0027t have used it for multi-bundle since multi-bundle didn\u0027t exist prior to M92. So the intersection of multiple bundle groups and rollback is a \"new\" M92 feature IIUC.\n\nSo breaking rollback of multi-bundle might be an edge case where we don\u0027t have users yet. If we break rollback for \"normal\" bundle paths that would be a problem though, but I don\u0027t think we do that? This has more to do with legacy endpoints, right? And legacy endpoints probably don\u0027t do rollback? Safari stable doesn\u0027t even have rollback yet, though it\u0027s in their tech preview I think.\n\nWhat I think is a must-have for M93 is that it is possible to add new m\u003d sections in either bundle group, but I\u0027m not sure rollback of the multi-bundle is as important since multi-bundle doesn\u0027t happen by default?\n\nhttps://webrtc-review.googlesource.com/c/src/+/221601 on the other hand brought down negotiation time by an order of magnitude for many m\u003d sections (in Chrome the PostTasks for each candidate caused A LOT of delay) and is definitely a nice-to-have on M93. While \"max-bundle\" doesn\u0027t have this issue, it does require opting in to it, which users might not understand they have to do.\n\nSo what do you say? Do we still want to revert? Or should we aim to do the simple fix of https://crbug.com/webrtc/12906 for M93 and fix multi-bundle rollback in M94?",
      "parentUuid": "50395de8_d7eeb4a2",
      "revId": "1a56b11e117aa41ea387ce2d02fa78be2efc677d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1d722a49_0181ffbb",
        "filename": "pc/jsep_transport_collection.cc",
        "patchSetId": 4
      },
      "lineNbr": 65,
      "author": {
        "id": 5142
      },
      "writtenOn": "2021-07-21T08:20:24Z",
      "side": 1,
      "message": "I\u0027m leaning towards not reverting but I might be underestimating or misjudging the severity of this, so this is not a strong position - I\u0027ll let you decide.",
      "parentUuid": "17692697_c240187f",
      "revId": "1a56b11e117aa41ea387ce2d02fa78be2efc677d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "471f3d46_e4ce92ca",
        "filename": "pc/jsep_transport_collection.cc",
        "patchSetId": 4
      },
      "lineNbr": 65,
      "author": {
        "id": 5142
      },
      "writtenOn": "2021-07-21T12:20:34Z",
      "side": 1,
      "message": "Speaking of rollback issues, I re-discovered this one while going through old work items:\nhttps://crbug.com/webrtc/12653",
      "parentUuid": "1d722a49_0181ffbb",
      "revId": "1a56b11e117aa41ea387ce2d02fa78be2efc677d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "42d05f7e_2c427698",
        "filename": "pc/jsep_transport_collection.cc",
        "patchSetId": 4
      },
      "lineNbr": 65,
      "author": {
        "id": 5053
      },
      "writtenOn": "2021-07-22T00:50:04Z",
      "side": 1,
      "message": "Rollback issues (at least the ones in JsepTransportController) should be resolved.\n\nOne consequence is that if a transport is kept in a limbo state just in case it\u0027s needed for rollback, it will be factored into the aggregated transport state. I don\u0027t think it\u0027s a problem, and it seems like it agrees with the spec if you take it literally, but I just wanted to point it out.",
      "parentUuid": "471f3d46_e4ce92ca",
      "revId": "1a56b11e117aa41ea387ce2d02fa78be2efc677d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "369233c4_cfc4495e",
        "filename": "pc/peer_connection_bundle_unittest.cc",
        "patchSetId": 4
      },
      "lineNbr": 967,
      "author": {
        "id": 5142
      },
      "writtenOn": "2021-07-20T08:25:53Z",
      "side": 1,
      "message": "This covers 3_audio not being part of the group, which is good.\n\nBut either here or in jsep_transport_controller_unittest.cc: can you also add a test for when the new track is added to a different group than the first one and that it succeeds?\n\nTo cover the \"all audio in one group and all video in one group\" case and adding more tracks after the initial negotiation since that is probably what people who have starred https://crbug.com/webrtc/10208 would like to do.",
      "revId": "1a56b11e117aa41ea387ce2d02fa78be2efc677d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "37ca89f7_09ba9b2f",
        "filename": "pc/peer_connection_bundle_unittest.cc",
        "patchSetId": 4
      },
      "lineNbr": 967,
      "author": {
        "id": 5053
      },
      "writtenOn": "2021-07-20T21:11:05Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "369233c4_cfc4495e",
      "revId": "1a56b11e117aa41ea387ce2d02fa78be2efc677d",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    }
  ]
}