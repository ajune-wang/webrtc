{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "148ec52f_224c9675",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 17719
      },
      "writtenOn": "2022-10-19T14:39:06Z",
      "side": 1,
      "message": "Hi Alessio and Per, can you please take a look? Thanks!",
      "revId": "262a19da9943b2c47be361623cedf738c925f3ee",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c7654726_b17c7642",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 5122
      },
      "writtenOn": "2022-10-19T15:04:23Z",
      "side": 1,
      "message": "Thanks Hanna! I added some comments",
      "revId": "262a19da9943b2c47be361623cedf738c925f3ee",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "44875286_ae93d6fa",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 5125
      },
      "writtenOn": "2022-10-21T07:14:54Z",
      "side": 1,
      "message": "Thanks for this CL!",
      "revId": "262a19da9943b2c47be361623cedf738c925f3ee",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5f7ae0ba_e43a0143",
        "filename": "modules/audio_processing/gain_controller2.cc",
        "patchSetId": 1
      },
      "lineNbr": 175,
      "author": {
        "id": 5122
      },
      "writtenOn": "2022-10-19T15:04:23Z",
      "side": 1,
      "message": "I would DCHECK this: the input volume controller should never be used on platforms without input volume",
      "range": {
        "startLine": 175,
        "startChar": 4,
        "endLine": 175,
        "endChar": 43
      },
      "revId": "262a19da9943b2c47be361623cedf738c925f3ee",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f004d1e4_410d36d4",
        "filename": "modules/audio_processing/gain_controller2.cc",
        "patchSetId": 1
      },
      "lineNbr": 175,
      "author": {
        "id": 5125
      },
      "writtenOn": "2022-10-21T07:14:54Z",
      "side": 1,
      "message": "If that is the case (i.e., it should always have a value), I\u0027d instead make applied_input_volume not being an optional.\n\nMaking it an optional is a clear signal that it is allowed for it not to have a value. Then we shouldn\u0027t DCHECK when it hasn\u0027t a value.\n\nAlso, DCHECKing is not really a safety since it only happens in debug builds.",
      "parentUuid": "5f7ae0ba_e43a0143",
      "range": {
        "startLine": 175,
        "startChar": 4,
        "endLine": 175,
        "endChar": 43
      },
      "revId": "262a19da9943b2c47be361623cedf738c925f3ee",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3d4750db_a9bc9950",
        "filename": "modules/audio_processing/gain_controller2.cc",
        "patchSetId": 1
      },
      "lineNbr": 175,
      "author": {
        "id": 17719
      },
      "writtenOn": "2022-10-24T13:11:20Z",
      "side": 1,
      "message": "I\u0027ve changed applied_input_volume to be non-optional and added the checks.",
      "parentUuid": "f004d1e4_410d36d4",
      "range": {
        "startLine": 175,
        "startChar": 4,
        "endLine": 175,
        "endChar": 43
      },
      "revId": "262a19da9943b2c47be361623cedf738c925f3ee",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9834a3c4_2eaee290",
        "filename": "modules/audio_processing/gain_controller2.cc",
        "patchSetId": 1
      },
      "lineNbr": 175,
      "author": {
        "id": 5122
      },
      "writtenOn": "2022-10-27T16:21:19Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "3d4750db_a9bc9950",
      "range": {
        "startLine": 175,
        "startChar": 4,
        "endLine": 175,
        "endChar": 43
      },
      "revId": "262a19da9943b2c47be361623cedf738c925f3ee",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "26ae686f_790fd8d6",
        "filename": "modules/audio_processing/gain_controller2.cc",
        "patchSetId": 1
      },
      "lineNbr": 217,
      "author": {
        "id": 5122
      },
      "writtenOn": "2022-10-19T15:04:23Z",
      "side": 1,
      "message": "feel free to ignore this comment since, in practice, we don\u0027t deal with any platforms which require input volume adaptation without digital gain adaptation\n\n---\n\nmy bad, I should have prioritized the work to move the speech level estimator outside of the digital adaptive controller into GainController2; I wonder if I should fast track that change so that we always pass speech probability and speech level here",
      "range": {
        "startLine": 210,
        "startChar": 0,
        "endLine": 217,
        "endChar": 3
      },
      "revId": "262a19da9943b2c47be361623cedf738c925f3ee",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a45d8641_5ef13f18",
        "filename": "modules/audio_processing/gain_controller2.cc",
        "patchSetId": 1
      },
      "lineNbr": 252,
      "author": {
        "id": 5122
      },
      "writtenOn": "2022-10-19T15:04:23Z",
      "side": 1,
      "message": "I added a comment about these params in https://webrtc-review.googlesource.com/c/src/+/278625/7/modules/audio_processing/agc2/input_volume_controller.h#179. Let\u0027s discuss in the other CL and/or offline.",
      "range": {
        "startLine": 249,
        "startChar": 0,
        "endLine": 252,
        "endChar": 59
      },
      "revId": "262a19da9943b2c47be361623cedf738c925f3ee",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5608d32c_9d2ba2bf",
        "filename": "modules/audio_processing/gain_controller2.h",
        "patchSetId": 1
      },
      "lineNbr": 46,
      "author": {
        "id": 5122
      },
      "writtenOn": "2022-10-19T15:04:23Z",
      "side": 1,
      "message": "good catch!",
      "range": {
        "startLine": 46,
        "startChar": 54,
        "endLine": 46,
        "endChar": 68
      },
      "revId": "262a19da9943b2c47be361623cedf738c925f3ee",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "40e5a33a_d13a47db",
        "filename": "modules/audio_processing/gain_controller2.h",
        "patchSetId": 1
      },
      "lineNbr": 51,
      "author": {
        "id": 5122
      },
      "writtenOn": "2022-10-19T15:04:23Z",
      "side": 1,
      "message": "let\u0027s just add a parent CL that removes Initialize() since it\u0027s not used",
      "range": {
        "startLine": 50,
        "startChar": 0,
        "endLine": 51,
        "endChar": 17
      },
      "revId": "262a19da9943b2c47be361623cedf738c925f3ee",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "64027193_63b8275f",
        "filename": "modules/audio_processing/gain_controller2.h",
        "patchSetId": 1
      },
      "lineNbr": 51,
      "author": {
        "id": 5125
      },
      "writtenOn": "2022-10-21T07:14:54Z",
      "side": 1,
      "message": "?I\u0027m a bit confused here.\nWhy modify the initialize method if it is not used and marked as deprecated?\n\nAnother aspect is why AudioProcessing::Config::GainController2::InputVolumeController is an argument. Is this to support runtime configurations of the input volume controller? \nAn aspect of that is that just passing this substruct makes it a bit unintuitive to control GainController2. I.e., why only pass a substruct, and not the whole GainController2 config struct?",
      "range": {
        "startLine": 50,
        "startChar": 6,
        "endLine": 51,
        "endChar": 16
      },
      "revId": "262a19da9943b2c47be361623cedf738c925f3ee",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "72e315ec_b1d74fdc",
        "filename": "modules/audio_processing/gain_controller2.h",
        "patchSetId": 1
      },
      "lineNbr": 51,
      "author": {
        "id": 17719
      },
      "writtenOn": "2022-10-24T13:11:20Z",
      "side": 1,
      "message": "Initialize() removed in https://webrtc-review.googlesource.com/c/src/+/280040",
      "parentUuid": "40e5a33a_d13a47db",
      "range": {
        "startLine": 50,
        "startChar": 0,
        "endLine": 51,
        "endChar": 17
      },
      "revId": "262a19da9943b2c47be361623cedf738c925f3ee",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "11a2557e_a2f7350d",
        "filename": "modules/audio_processing/gain_controller2.h",
        "patchSetId": 1
      },
      "lineNbr": 51,
      "author": {
        "id": 17719
      },
      "writtenOn": "2022-10-24T13:11:20Z",
      "side": 1,
      "message": "Intialize() is removed in https://webrtc-review.googlesource.com/c/src/+/280040.",
      "parentUuid": "64027193_63b8275f",
      "range": {
        "startLine": 50,
        "startChar": 6,
        "endLine": 51,
        "endChar": 16
      },
      "revId": "262a19da9943b2c47be361623cedf738c925f3ee",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b53a2818_16bd2c00",
        "filename": "modules/audio_processing/gain_controller2.h",
        "patchSetId": 1
      },
      "lineNbr": 68,
      "author": {
        "id": 5125
      },
      "writtenOn": "2022-10-21T07:14:54Z",
      "side": 1,
      "message": "Do you have an example of a case where there is no applied_input_volume available, but we still want to run Analyze?\n\nI thought we always got the input volume reported when we run the analog agc?",
      "range": {
        "startLine": 67,
        "startChar": 7,
        "endLine": 68,
        "endChar": 48
      },
      "revId": "262a19da9943b2c47be361623cedf738c925f3ee",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1f149195_e8e662ad",
        "filename": "modules/audio_processing/gain_controller2.h",
        "patchSetId": 1
      },
      "lineNbr": 68,
      "author": {
        "id": 17719
      },
      "writtenOn": "2022-10-24T13:11:20Z",
      "side": 1,
      "message": "I changed applied_input_volume to be non-optional",
      "parentUuid": "b53a2818_16bd2c00",
      "range": {
        "startLine": 67,
        "startChar": 7,
        "endLine": 68,
        "endChar": 48
      },
      "revId": "262a19da9943b2c47be361623cedf738c925f3ee",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7d04ce7e_761086ef",
        "filename": "modules/audio_processing/gain_controller2.h",
        "patchSetId": 1
      },
      "lineNbr": 68,
      "author": {
        "id": 5122
      },
      "writtenOn": "2022-10-27T16:21:19Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "1f149195_e8e662ad",
      "range": {
        "startLine": 67,
        "startChar": 7,
        "endLine": 68,
        "endChar": 48
      },
      "revId": "262a19da9943b2c47be361623cedf738c925f3ee",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c3b71d6e_4954a78c",
        "filename": "modules/audio_processing/gain_controller2.h",
        "patchSetId": 1
      },
      "lineNbr": 86,
      "author": {
        "id": 5122
      },
      "writtenOn": "2022-10-19T15:04:23Z",
      "side": 1,
      "message": "what about returning the (optional) recommended input volume when `Analyze()` or `Process()` are called?",
      "range": {
        "startLine": 84,
        "startChar": 0,
        "endLine": 86,
        "endChar": 56
      },
      "revId": "262a19da9943b2c47be361623cedf738c925f3ee",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e7e9f78f_30ce2997",
        "filename": "modules/audio_processing/gain_controller2.h",
        "patchSetId": 1
      },
      "lineNbr": 86,
      "author": {
        "id": 17719
      },
      "writtenOn": "2022-10-24T13:11:20Z",
      "side": 1,
      "message": "Could you please elaborate on this a bit more? On the one hand, it would remove some temporal coupling, but on the other hand, both Analyze() and Process() mutate this class consisting of analog and digital gain control as well as VAD so it isn\u0027t necessarily obvious that the return value then is the analog gain.",
      "parentUuid": "c3b71d6e_4954a78c",
      "range": {
        "startLine": 84,
        "startChar": 0,
        "endLine": 86,
        "endChar": 56
      },
      "revId": "262a19da9943b2c47be361623cedf738c925f3ee",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "93bad6af_4ddad45b",
        "filename": "modules/audio_processing/gain_controller2.h",
        "patchSetId": 1
      },
      "lineNbr": 86,
      "author": {
        "id": 5122
      },
      "writtenOn": "2022-10-27T16:21:19Z",
      "side": 1,
      "message": "Reason for my proposal: live without unnecessary methods to improve code clarity and reduce misuse.\n\nAs shown below, we don\u0027t really need to store the recommended input volume anywhere (not in APM, not in `InputVolumeController`, not even in `MonoInputVolumeController`):\n\n```\nAudioProcessingImpl::ProcessCapture(..., int applied_input_volume, int\u0026 recommended_input_volume) {\n  ...\n  agc2-\u003eAnalyze(applied_input_volume, capture_buffer);\n  ...\n  recommended_input_volume \u003d agc2-\u003eProcess(applied_input_volume, capture_buffer);\n  ...\n}\n\nint GainController2::Process(...) {\n  ...\n  int recommended_input_volume \u003d input_volume_controller_-\u003eProcess(...);\n  ...\n  return recommended_input_volume;\n}\n```\n\nsame for `MonoInputVolumeController::Process()`.\n\nSo, if we can already remove the getter at this stage, I wouldn\u0027t wait.\n\nMy view is that we shouldn\u0027t repeat the choice of adding `set_stream_analog_level()` and `recommended_stream_analog_level()`, which would have made sense if they hadn\u0027t been called for every frame.\n\nFinally, I do not recommend adding non-trivial getters - I evince `GetRecommendedInputVolume()` is not trivial from the camel case. Just compute the recommended input volume in Process() and return it. IMO, clarifying what `GainController2::Process()` returns in its docstring is sufficiently clear.",
      "parentUuid": "e7e9f78f_30ce2997",
      "range": {
        "startLine": 84,
        "startChar": 0,
        "endLine": 86,
        "endChar": 56
      },
      "revId": "262a19da9943b2c47be361623cedf738c925f3ee",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    }
  ]
}