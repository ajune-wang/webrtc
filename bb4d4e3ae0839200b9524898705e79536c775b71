{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "3a820be8_3874303e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 7036
      },
      "writtenOn": "2022-06-30T09:37:15Z",
      "side": 1,
      "message": "Can you also add an entry for L2T3 in svc_e2e_tests.cc ? Not S2T3 though, those tests don\u0027t support S modes yet.",
      "revId": "bb4d4e3ae0839200b9524898705e79536c775b71",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9a236aeb_9902423c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 5234
      },
      "writtenOn": "2022-06-30T09:59:44Z",
      "side": 1,
      "message": "Done, and started a test run.",
      "parentUuid": "3a820be8_3874303e",
      "revId": "bb4d4e3ae0839200b9524898705e79536c775b71",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ca0a2121_8c2b3ce3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 5234
      },
      "writtenOn": "2022-06-30T10:19:36Z",
      "side": 1,
      "message": "It fails with errors like \n\n(libvpx_vp9_encoder.cc:506): Encoder in error state: 8\n(default_video_quality_analyzer.cc:542): Encoder error for frame.id\u003d10, code\u003d-1\n(video_stream_encoder.cc:1900): Failed to encode frame. Error code: -1\n(default_video_quality_analyzer.cc:542): Encoder error for frame.id\u003d11, code\u003d-1\n(video_stream_encoder.cc:1900): Failed to encode frame. Error code: -1\n\nI guess one has to dig in libvpx sources to find out what error state 8 means.",
      "parentUuid": "9a236aeb_9902423c",
      "revId": "bb4d4e3ae0839200b9524898705e79536c775b71",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e7b239f1_3e71b6c8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 5234
      },
      "writtenOn": "2022-06-30T10:30:42Z",
      "side": 1,
      "message": "Looks like it\u0027s\n\n  /*!\\brief An application-supplied parameter is not valid.                                \n   *                                                                                       \n   */\n  VPX_CODEC_INVALID_PARAM,\n\nNot that surprising, but not very specific either... \n\nMain suspect is perhaps this call: https://source.chromium.org/chromium/chromium/src/+/main:third_party/webrtc/modules/video_coding/codecs/vp9/libvpx_vp9_encoder.cc;drc\u003d179f40e81a461a9978701f6d830f8fdad92d5e2e;l\u003d1214\n\n    vpx_svc_ref_frame_config_t ref_config \u003d Vp9References(layer_frames_);\n    libvpx_-\u003ecodec_control(encoder_, VP9E_SET_SVC_REF_FRAME_CONFIG,\n                           \u0026ref_config);",
      "parentUuid": "ca0a2121_8c2b3ce3",
      "revId": "bb4d4e3ae0839200b9524898705e79536c775b71",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "74258f59_e03d29e5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 5234
      },
      "writtenOn": "2022-06-30T12:19:38Z",
      "side": 1,
      "message": "I\u0027ve debugged a bit more about this. We get layer_frames_ like\n\n(libvpx_vp9_encoder.cc:1213): XXX layer_frames_:\n(libvpx_vp9_encoder.cc:1215):   spatial id: 0\n(libvpx_vp9_encoder.cc:1217):     id: 2, referenced: 1, updated: 0\n(libvpx_vp9_encoder.cc:1217):     id: 4, referenced: 0, updated: 1\n\nSo only a single spatial layer, which seems like a problem for the test, but doesn\u0027t really explain encoder failure.\n\nThe reason for only a single layer, is that the second spatial layer gets disabled by ScalabilityStructureFullSvc::OnRatesUpdated.",
      "parentUuid": "e7b239f1_3e71b6c8",
      "revId": "bb4d4e3ae0839200b9524898705e79536c775b71",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5496bbf1_aa9b2e98",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 5234
      },
      "writtenOn": "2022-06-30T13:44:32Z",
      "side": 1,
      "message": "This call to codec_enc_config_set fails: https://source.chromium.org/chromium/chromium/src/+/main:third_party/webrtc/modules/video_coding/codecs/vp9/libvpx_vp9_encoder.cc;drc\u003d179f40e81a461a9978701f6d830f8fdad92d5e2e;l\u003d1117\n\nBut it\u0027s rather curious, the contents of the config struct appear to be exactly the same as for the previous call, which succeeded. Is it possible that other changes, e.g., via codec_control, can make the config no longer valid?\n\nHowever, looking at config changes, I see one other anomaly:\n\nThe attribute config_-\u003elayer_target_bitrate is changed from {391, 510, 725, 0, 0, 0, 0, 0, 0, 0, 0, 0}, i.e., all temporal layers of first spatial layer, to {391, 510, 725, 732, 222, 403, 0, 0, 0, 0, 0, 0}, i.e., include second spatial layer.\n\nAt the same time, ss_target_bitrate changes from \n{725, 0, 0, 0, 0} to {725, 1357, 0, 0, 0} which kind of makes sense. Except that 725 equals the rate for S0T2, and 1357 is the sum of rates for S1T0, S1T1 and S1S2. It\u0027s as if code does\u0027n agree with itself if rate for temporal layers should be cumulative or not. There\u0027s a comment in LibvpxVp9Encoder::SetSvcRates\n\n      // Bitrates in `layer_target_bitrate` are accumulated for each temporal              \n      // layer but in `VideoBitrateAllocation` they should be separated.                   \n\nThat appears broken with the above layer_target_bitrate settings.\n\nAlso at the same time, layer_frames_ only has a single entry,\n\n(libvpx_vp9_encoder.cc:1219): XXX layer_frames_:\n(libvpx_vp9_encoder.cc:1221):   spatial id: 0\n(libvpx_vp9_encoder.cc:1223):     id: 2, referenced: 1, updated: 0\n(libvpx_vp9_encoder.cc:1223):     id: 4, referenced: 0, updated: 1\n\nSo here, it looks Like the second spatial is still disabled.",
      "parentUuid": "74258f59_e03d29e5",
      "revId": "bb4d4e3ae0839200b9524898705e79536c775b71",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    }
  ]
}