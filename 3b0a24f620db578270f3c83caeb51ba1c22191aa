{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "6d427fc4_581d662f",
        "filename": "video/video_stream_encoder.cc",
        "patchSetId": 1
      },
      "lineNbr": 2363,
      "author": {
        "id": 5117
      },
      "writtenOn": "2021-10-15T16:45:42Z",
      "side": 1,
      "message": "Shouldn\u0027t you be resetting this in ConfigureEncoder(). Maybe only if is_screenshare has changed.\n\nAre you sure it\u0027s impossible to switch the stream of camera to screenshare. It\u0027s not happening in e.g. Meet now, but in theory just changing the source track for the transceiver could do it.\n\nOr maybe, a better place to report it is in OnConstraintsChanged() if there was any change? Also why do you report it only for screenshare?",
      "range": {
        "startLine": 2363,
        "startChar": 2,
        "endLine": 2363,
        "endChar": 44
      },
      "revId": "3b0a24f620db578270f3c83caeb51ba1c22191aa",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "934b4021_79900361",
        "filename": "video/video_stream_encoder.cc",
        "patchSetId": 1
      },
      "lineNbr": 2363,
      "author": {
        "id": 9515
      },
      "writtenOn": "2021-10-18T15:55:08Z",
      "side": 1,
      "message": "I\u0027m only interested in screenshare as I have no intention of changing things dependent on constraints for normal video.\n\nGood point - resetting |has_reported_screenshare_frame_rate_umas_| now when the encoder is re-configured.\n\nAFAICT ConfigureEncoder calls happen on the worker thread, and OnConstraintsChanged happens on the networking thread. Even though I see OnConstraintsChanged is the last call before frame entry begins, acting on OnConstraintsChanged will at best be racy. So I prefer to update the stats indirectly from OnFrame as I assume everything is set up on the first call.",
      "parentUuid": "6d427fc4_581d662f",
      "range": {
        "startLine": 2363,
        "startChar": 2,
        "endLine": 2363,
        "endChar": 44
      },
      "revId": "3b0a24f620db578270f3c83caeb51ba1c22191aa",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c344eb33_55ba650e",
        "filename": "video/video_stream_encoder.cc",
        "patchSetId": 1
      },
      "lineNbr": 2377,
      "author": {
        "id": 5117
      },
      "writtenOn": "2021-10-15T16:45:42Z",
      "side": 1,
      "message": "FYI, all these have 50 buckets:\nhttps://source.chromium.org/chromium/chromium/src/+/main:third_party/webrtc/system_wrappers/include/metrics.h;l\u003d105;drc\u003df0671921a12717388a575c023aa610e4088b588e\n\nShould be enough for your case, but you decide.",
      "range": {
        "startLine": 2377,
        "startChar": 8,
        "endLine": 2377,
        "endChar": 32
      },
      "revId": "3b0a24f620db578270f3c83caeb51ba1c22191aa",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "42c14e28_61af6b82",
        "filename": "video/video_stream_encoder.cc",
        "patchSetId": 1
      },
      "lineNbr": 2377,
      "author": {
        "id": 9515
      },
      "writtenOn": "2021-10-18T15:56:13Z",
      "side": 1,
      "message": "Ack - I think it\u0027s ok.",
      "parentUuid": "c344eb33_55ba650e",
      "range": {
        "startLine": 2377,
        "startChar": 8,
        "endLine": 2377,
        "endChar": 32
      },
      "revId": "3b0a24f620db578270f3c83caeb51ba1c22191aa",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a0e978ac_d438fa94",
        "filename": "video/video_stream_encoder.cc",
        "patchSetId": 1
      },
      "lineNbr": 2405,
      "author": {
        "id": 5117
      },
      "writtenOn": "2021-10-15T16:45:42Z",
      "side": 1,
      "message": "That macro creates a histogram with only 50 buckets:\nhttps://source.chromium.org/chromium/chromium/src/+/main:third_party/webrtc/system_wrappers/include/metrics.h;l\u003d150;drc\u003df0671921a12717388a575c023aa610e4088b588e\n\nThat\u0027s far too low resolution for your purpose of encoding 2 values in one. It would basically be impossible to see max_fps value.\n\nAlso, you don\u0027t need slow (e.g. *_SPARSE\") methods - they are needed only if you were reporting different histograms dynamically at the same place in the code.\n\nYou should use |RTC_HISTOGRAM_COUNTS_LINEAR(\"...120MinPlusMax\", x*120+y, 1, max, max)| here.",
      "range": {
        "startLine": 2405,
        "startChar": 8,
        "endLine": 2405,
        "endChar": 41
      },
      "revId": "3b0a24f620db578270f3c83caeb51ba1c22191aa",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "81bd6927_8ed99139",
        "filename": "video/video_stream_encoder.cc",
        "patchSetId": 1
      },
      "lineNbr": 2405,
      "author": {
        "id": 9515
      },
      "writtenOn": "2021-10-18T15:55:08Z",
      "side": 1,
      "message": "There\u0027s a max bucket count of 1002, https://source.chromium.org/chromium/chromium/src/+/main:base/metrics/histogram.cc;drc\u003d984c3018ecb2ff818e900fdb7c743fc00caf7efe;l\u003d97?q\u003dhistogram.cc:830\u0026ss\u003dchromium.\n\nI\u0027ve reduced the max to 60*60+60-1 and 1000 buckets, probably good enough.",
      "parentUuid": "a0e978ac_d438fa94",
      "range": {
        "startLine": 2405,
        "startChar": 8,
        "endLine": 2405,
        "endChar": 41
      },
      "revId": "3b0a24f620db578270f3c83caeb51ba1c22191aa",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    }
  ]
}