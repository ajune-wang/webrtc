{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "b7b17954_d674df2a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 5508
      },
      "writtenOn": "2021-06-07T14:25:23Z",
      "side": 1,
      "message": "+henrik - can you chime in on the 100Hz -\u003e 1Hz suggestion?",
      "revId": "066928cda24964f01e906dbc94e4734e1ac5e41a",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c8044086_c0a12c12",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 5508
      },
      "writtenOn": "2021-06-07T19:29:46Z",
      "side": 1,
      "message": "Reporting frequency changes moved here:\nhttps://webrtc-review.googlesource.com/c/src/+/221371",
      "parentUuid": "b7b17954_d674df2a",
      "revId": "066928cda24964f01e906dbc94e4734e1ac5e41a",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b9962dc3_230a79c7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 5508
      },
      "writtenOn": "2021-06-08T15:00:07Z",
      "side": 1,
      "message": "Markus - wdyt about moving the reporting frequency question over to\nhttps://webrtc-review.googlesource.com/c/src/+/221371\n?\n\nMinyue and Chen are taking a look there as well.",
      "revId": "066928cda24964f01e906dbc94e4734e1ac5e41a",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b3cd77e7_393868f1",
        "filename": "audio/channel_receive.cc",
        "patchSetId": 6
      },
      "lineNbr": 461,
      "author": {
        "id": 9515
      },
      "writtenOn": "2021-06-06T20:48:46Z",
      "side": 1,
      "message": "According to a power formula, 100 Hz more wakeups would yield 1W extra consumption if the worker thread is woken up. Can we change so that |playout_delay_|, acm_receiver_.TargetDelayMs(), acm_receiver_.FilteredCurrentDelayMs() use atomics?",
      "range": {
        "startLine": 461,
        "startChar": 18,
        "endLine": 461,
        "endChar": 26
      },
      "revId": "066928cda24964f01e906dbc94e4734e1ac5e41a",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1af5886d_3ec72a1f",
        "filename": "audio/channel_receive.cc",
        "patchSetId": 6
      },
      "lineNbr": 461,
      "author": {
        "id": 5508
      },
      "writtenOn": "2021-06-07T06:57:35Z",
      "side": 1,
      "message": "I would like to change TargetDelayMs() and FilteredCurrentDelayMs() so that they don\u0027t grab the same lock that has already been taken a few times during the same operation. AcmReceiver also seems to add a lock on top of NetEq\u0027s lock (but a comment in the header says \"NetEq is thread-safe; no lock needed\").\n\nEach histogram has an atomic operation + mutex lock, which means that there are already several of those happening here on the audio thread. I\u0027d rather not add more. Reporting the stats on the worker is also more consistent with how things work on the video side.\n\n\"100 Hz more wakeups\" is true if the worker is always idle, that\u0027s not super likely to be the case during a call though, but there is some amount of wakeups for sure. What I was wondering about is if we could rather do is report the stats fewer times, e.g. 1Hz. We could batch them up on the callback thread and then std::move them to a reporting task on the worker.\n\nHowever in this CL I was thinking to not make changes as far as this goes but do those separately along with making a few changes to NetEq and AcmReceiver to reduce the locking (e.g. return the delay values when GetAudio() is called, don\u0027t call last_output_sample_rate_hz() right after `neteq_-\u003eGetAudio()`, etc.\n\nwdyt?",
      "parentUuid": "b3cd77e7_393868f1",
      "range": {
        "startLine": 461,
        "startChar": 18,
        "endLine": 461,
        "endChar": 26
      },
      "revId": "066928cda24964f01e906dbc94e4734e1ac5e41a",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "36288a19_7d5041ff",
        "filename": "audio/channel_receive.cc",
        "patchSetId": 6
      },
      "lineNbr": 461,
      "author": {
        "id": 9515
      },
      "writtenOn": "2021-06-07T07:35:11Z",
      "side": 1,
      "message": "Mutex removal looks good.\n\nIt\u0027s just that I think that unless RTC_HISTOGRAM takes time to execute the PostTask here is just frequent and unfortunate. IIRC the context we call in here on is based of the sound card clock which isn\u0027t synchronized to other activity on the worker so it\u0027s likely to yield close to 100% wakeups.\n\n\u003e I\u0027d rather not add more.\n\nWe only need relaxed consistency here. Using relaxed memory ordering access will just emit loads and stores without any barriers.\n\nSpeaking about collection frequency. We\u0027re collecting samples at 100 Hz, but collecting them at say 1 Hz would give the same shape of the histograms. How about just dropping the frequency?",
      "parentUuid": "1af5886d_3ec72a1f",
      "range": {
        "startLine": 461,
        "startChar": 18,
        "endLine": 461,
        "endChar": 26
      },
      "revId": "066928cda24964f01e906dbc94e4734e1ac5e41a",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8d464736_33e44b42",
        "filename": "audio/channel_receive.cc",
        "patchSetId": 6
      },
      "lineNbr": 461,
      "author": {
        "id": 5508
      },
      "writtenOn": "2021-06-07T14:13:21Z",
      "side": 1,
      "message": "I think the 1Hz approach is the way to go. Are you thinking with or without batching of samples or simply skip recording 99/100 samples?\nBtw, the docs for the sample gathering today states that the samples are gathered every 10ms, so that would need to be corrected if we don\u0027t batch.",
      "parentUuid": "36288a19_7d5041ff",
      "range": {
        "startLine": 461,
        "startChar": 18,
        "endLine": 461,
        "endChar": 26
      },
      "revId": "066928cda24964f01e906dbc94e4734e1ac5e41a",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "394ca082_77aa0e6e",
        "filename": "audio/channel_receive.cc",
        "patchSetId": 6
      },
      "lineNbr": 461,
      "author": {
        "id": 9515
      },
      "writtenOn": "2021-06-07T14:16:00Z",
      "side": 1,
      "message": "I was thinking without batching, just skipping out on 99/100.",
      "parentUuid": "8d464736_33e44b42",
      "range": {
        "startLine": 461,
        "startChar": 18,
        "endLine": 461,
        "endChar": 26
      },
      "revId": "066928cda24964f01e906dbc94e4734e1ac5e41a",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    }
  ]
}