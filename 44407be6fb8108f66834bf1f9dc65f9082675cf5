{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "6b4617f8_be4524d1",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 19549
      },
      "writtenOn": "2022-11-14T07:07:37Z",
      "side": 1,
      "message": "still pondering where the right test for this should live, so far I have only demonstrated no change in behavior.\n\nSimilar to TestSimulcastEncoderAdapterFake.ActivatesCorrectStreamsInInitEncode maybe?",
      "revId": "44407be6fb8108f66834bf1f9dc65f9082675cf5",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7385faef_8b29e071",
        "filename": "media/engine/simulcast_encoder_adapter.cc",
        "patchSetId": 2
      },
      "lineNbr": 471,
      "author": {
        "id": 19549
      },
      "writtenOn": "2022-11-14T07:07:37Z",
      "side": 1,
      "message": "the stream_frame_types.size() \u003d\u003d 1 here was required or some tests started crashing with out of bounds. Which seems a bit like those tests are not set up correctly? See https://webrtc-review.googlesource.com/c/src/+/281002?checksPatchset\u003d1\u0026tab\u003dchecks",
      "revId": "44407be6fb8108f66834bf1f9dc65f9082675cf5",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a6ef0d8d_866dc79a",
        "filename": "media/engine/simulcast_encoder_adapter.cc",
        "patchSetId": 2
      },
      "lineNbr": 471,
      "author": {
        "id": 5117
      },
      "writtenOn": "2022-11-14T09:55:55Z",
      "side": 1,
      "message": "Weird... For this to have any effect, the stream_frame_types should have size 1.\nSo |total_streams_count_| should be 1, yet it\u0027s not a bypass mode somehow?\n\nI can only guess that it\u0027s happening because the simulcast bitrate isn\u0027t set up correctly here [1]\n\n[1] https://source.chromium.org/chromium/chromium/src/+/main:third_party/webrtc/media/engine/simulcast_encoder_adapter.cc;l\u003d70;drc\u003d26f382174adc04c0d92e7dff24c6aed5d5e0246b\n\nCould you instead try to set some bitrate in the tests?\n\nAlso, please additional hardening below: In addition to checking that |layer.stream_idx()| fits in the |frame_types|, check that it fits in |stream_frame_types| in the code below.",
      "parentUuid": "7385faef_8b29e071",
      "revId": "44407be6fb8108f66834bf1f9dc65f9082675cf5",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "279a7812_00f1acf0",
        "filename": "media/engine/simulcast_encoder_adapter.cc",
        "patchSetId": 2
      },
      "lineNbr": 471,
      "author": {
        "id": 19549
      },
      "writtenOn": "2022-11-18T15:39:37Z",
      "side": 1,
      "message": "this is what blew up indeed. So we have this for\n  VideoSendStreamTest.TestTemporalLayersVp8SimulcastWithDifferentNumTls\nbypass_mode_\u003dfalse, total_streams_count_\u003d2 which leads to stream_frame_types.size()\u003d1.\nThose are two encoders because they have a different number of temporal layers.\n\nIt turns out that moving this up here was wrong.",
      "parentUuid": "a6ef0d8d_866dc79a",
      "revId": "44407be6fb8108f66834bf1f9dc65f9082675cf5",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a34499ae_41997578",
        "filename": "media/engine/simulcast_encoder_adapter.cc",
        "patchSetId": 2
      },
      "lineNbr": 471,
      "author": {
        "id": 5117
      },
      "writtenOn": "2022-11-18T16:05:22Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "279a7812_00f1acf0",
      "revId": "44407be6fb8108f66834bf1f9dc65f9082675cf5",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2b9cb2d2_98642511",
        "filename": "media/engine/simulcast_encoder_adapter.cc",
        "patchSetId": 2
      },
      "lineNbr": 473,
      "author": {
        "id": 5117
      },
      "writtenOn": "2022-11-14T09:55:55Z",
      "side": 1,
      "message": "Why though? If we just pass frame_types as is to the encode (presumably libvpx, if there\u0027s more than one stream), would it not handle it correctly?",
      "range": {
        "startLine": 472,
        "startChar": 9,
        "endLine": 473,
        "endChar": 41
      },
      "revId": "44407be6fb8108f66834bf1f9dc65f9082675cf5",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c05327f2_c9e155c5",
        "filename": "media/engine/simulcast_encoder_adapter.cc",
        "patchSetId": 2
      },
      "lineNbr": 473,
      "author": {
        "id": 19549
      },
      "writtenOn": "2022-11-18T15:39:37Z",
      "side": 1,
      "message": "It (LibvpxVp8Encoder::Encode, H264EncoderImpl::Encode) does but I am making these changes step by step.",
      "parentUuid": "2b9cb2d2_98642511",
      "range": {
        "startLine": 472,
        "startChar": 9,
        "endLine": 473,
        "endChar": 41
      },
      "revId": "44407be6fb8108f66834bf1f9dc65f9082675cf5",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "34685c6d_f5d4b500",
        "filename": "media/engine/simulcast_encoder_adapter.cc",
        "patchSetId": 2
      },
      "lineNbr": 473,
      "author": {
        "id": 5117
      },
      "writtenOn": "2022-11-18T16:05:22Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "c05327f2_c9e155c5",
      "range": {
        "startLine": 472,
        "startChar": 9,
        "endLine": 473,
        "endChar": 41
      },
      "revId": "44407be6fb8108f66834bf1f9dc65f9082675cf5",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d459a7ff_e9d52b96",
        "filename": "media/engine/simulcast_encoder_adapter.cc",
        "patchSetId": 2
      },
      "lineNbr": 494,
      "author": {
        "id": 5117
      },
      "writtenOn": "2022-11-14T09:55:55Z",
      "side": 1,
      "message": "What layer is \"new\"? Shouldn\u0027t it be \"when requesting keyframe on any layer\" instead?",
      "range": {
        "startLine": 494,
        "startChar": 35,
        "endLine": 494,
        "endChar": 44
      },
      "revId": "44407be6fb8108f66834bf1f9dc65f9082675cf5",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9555a229_f1d3a3bb",
        "filename": "media/engine/simulcast_encoder_adapter.cc",
        "patchSetId": 2
      },
      "lineNbr": 494,
      "author": {
        "id": 19549
      },
      "writtenOn": "2022-11-18T15:39:37Z",
      "side": 1,
      "message": "This happens when you have a simulcast stream configured for three layers but it starts with just one layer being active due to bandwidth restrictions. Then, when the second layer gets activated, a keyframe is generated.\n\nYou can see that on\n  https://fippo.github.io/simulcast-playground/rid-as-mid\nif you check outbound-rtp and keyframesEncoded stats (somewhat depending on BWE)\n\nNow I don\u0027t think this is great behavior (an SFU would forward the new low/mid resolution keyframe to subscribers on existing streams) but changing it is tricky and requires an opt-in mechanism.\n\nchanged to \"for a layer that became active for the first time or after being disabled\"",
      "parentUuid": "d459a7ff_e9d52b96",
      "range": {
        "startLine": 494,
        "startChar": 35,
        "endLine": 494,
        "endChar": 44
      },
      "revId": "44407be6fb8108f66834bf1f9dc65f9082675cf5",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "57eb83ba_420887c9",
        "filename": "media/engine/simulcast_encoder_adapter.cc",
        "patchSetId": 2
      },
      "lineNbr": 494,
      "author": {
        "id": 5117
      },
      "writtenOn": "2022-11-18T16:05:22Z",
      "side": 1,
      "message": "I like this new text. Thank you.",
      "parentUuid": "9555a229_f1d3a3bb",
      "range": {
        "startLine": 494,
        "startChar": 35,
        "endLine": 494,
        "endChar": 44
      },
      "revId": "44407be6fb8108f66834bf1f9dc65f9082675cf5",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    }
  ]
}