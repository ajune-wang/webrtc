{
  "comments": [
    {
      "key": {
        "uuid": "7977952b_205f1296",
        "filename": "logging/rtc_event_log/encoder/delta_encoding.cc",
        "patchSetId": 8
      },
      "lineNbr": 47,
      "author": {
        "id": 5150
      },
      "writtenOn": "2018-10-19T21:13:05Z",
      "side": 1,
      "message": "I\u0027d like to get rid of SignedDelta because it is rather long and I\u0027m having a hard time understanding it. This propagates minor changes elsewhere in the code, so for context please start at the calls to SignedDelta().\n\nuint64_t SignedBitWidth(int64_t max_pos_magnitude, max_neg_magnitude) {\n  uint64_t bitwidth_pos \u003d UnsignedBitWidth(max_pos_magnitude);\n  uint64_t bitwidth_neg \u003d UnsignedBitWidth(max_neg_magnitude \u003e 0 ? max_neg_magnitude - 1 : 0);\n  return 1 + std::max(bitwidth_pos, bitwidth_neg);\n}",
      "range": {
        "startLine": 47,
        "startChar": 9,
        "endLine": 47,
        "endChar": 23
      },
      "revId": "07a7274bf81483d8f4ff13cbe0f4709289162d1f",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e933e285_8d7f3e60",
        "filename": "logging/rtc_event_log/encoder/delta_encoding.cc",
        "patchSetId": 8
      },
      "lineNbr": 47,
      "author": {
        "id": 5147
      },
      "writtenOn": "2018-10-23T11:21:02Z",
      "side": 1,
      "message": "I\u0027ve taken your general idea.",
      "parentUuid": "7977952b_205f1296",
      "range": {
        "startLine": 47,
        "startChar": 9,
        "endLine": 47,
        "endChar": 23
      },
      "revId": "07a7274bf81483d8f4ff13cbe0f4709289162d1f",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "09ac52cb_238eb6d5",
        "filename": "logging/rtc_event_log/encoder/delta_encoding.cc",
        "patchSetId": 8
      },
      "lineNbr": 71,
      "author": {
        "id": 5150
      },
      "writtenOn": "2018-10-19T21:13:05Z",
      "side": 1,
      "message": "This function can be removed after applying other changes below.",
      "range": {
        "startLine": 71,
        "startChar": 9,
        "endLine": 71,
        "endChar": 19
      },
      "revId": "07a7274bf81483d8f4ff13cbe0f4709289162d1f",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a8dd48ee_fce1f085",
        "filename": "logging/rtc_event_log/encoder/delta_encoding.cc",
        "patchSetId": 8
      },
      "lineNbr": 71,
      "author": {
        "id": 5147
      },
      "writtenOn": "2018-10-23T11:21:02Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "09ac52cb_238eb6d5",
      "range": {
        "startLine": 71,
        "startChar": 9,
        "endLine": 71,
        "endChar": 19
      },
      "revId": "07a7274bf81483d8f4ff13cbe0f4709289162d1f",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4dc7f320_4ada157b",
        "filename": "logging/rtc_event_log/encoder/delta_encoding.cc",
        "patchSetId": 8
      },
      "lineNbr": 79,
      "author": {
        "id": 5150
      },
      "writtenOn": "2018-10-19T21:13:05Z",
      "side": 1,
      "message": "This function can be removed after applying other changes below.",
      "range": {
        "startLine": 79,
        "startChar": 9,
        "endLine": 79,
        "endChar": 19
      },
      "revId": "07a7274bf81483d8f4ff13cbe0f4709289162d1f",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b1421a99_882a7327",
        "filename": "logging/rtc_event_log/encoder/delta_encoding.cc",
        "patchSetId": 8
      },
      "lineNbr": 79,
      "author": {
        "id": 5147
      },
      "writtenOn": "2018-10-23T11:21:02Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "4dc7f320_4ada157b",
      "range": {
        "startLine": 79,
        "startChar": 9,
        "endLine": 79,
        "endChar": 19
      },
      "revId": "07a7274bf81483d8f4ff13cbe0f4709289162d1f",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1f32ff92_933f7030",
        "filename": "logging/rtc_event_log/encoder/delta_encoding.cc",
        "patchSetId": 8
      },
      "lineNbr": 99,
      "author": {
        "id": 5150
      },
      "writtenOn": "2018-10-19T21:13:05Z",
      "side": 1,
      "message": "The int64_t might not be able to represent the delta between all unsigned numbers.\nIn particular, a sign-magnitude representation ranges from -2^63+1 to 2^63-1 which can\u0027t represent the delta between 0 and 2^63.\n\nIf you specifically want the result to behave as 2-complement, then you could just return uin64_t instead. However, I suggest removing this entirely and adding a couple of lines at each call site.",
      "range": {
        "startLine": 99,
        "startChar": 0,
        "endLine": 99,
        "endChar": 7
      },
      "revId": "07a7274bf81483d8f4ff13cbe0f4709289162d1f",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c13cc6de_bc10c03c",
        "filename": "logging/rtc_event_log/encoder/delta_encoding.cc",
        "patchSetId": 8
      },
      "lineNbr": 99,
      "author": {
        "id": 5147
      },
      "writtenOn": "2018-10-23T11:21:02Z",
      "side": 1,
      "message": "So long as two\u0027s complement is used, and not some representation with positive/negative zeros, a int64_t is sufficient (in the way we use it). But that\u0027s academic now that we\u0027ve agreed to go with your suggested change.",
      "parentUuid": "1f32ff92_933f7030",
      "range": {
        "startLine": 99,
        "startChar": 0,
        "endLine": 99,
        "endChar": 7
      },
      "revId": "07a7274bf81483d8f4ff13cbe0f4709289162d1f",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "98d599bf_ebde3508",
        "filename": "logging/rtc_event_log/encoder/delta_encoding.cc",
        "patchSetId": 8
      },
      "lineNbr": 371,
      "author": {
        "id": 5150
      },
      "writtenOn": "2018-10-19T21:13:05Z",
      "side": 1,
      "message": "nit:remove",
      "range": {
        "startLine": 370,
        "startChar": 0,
        "endLine": 371,
        "endChar": 47
      },
      "revId": "07a7274bf81483d8f4ff13cbe0f4709289162d1f",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e9f55887_22804289",
        "filename": "logging/rtc_event_log/encoder/delta_encoding.cc",
        "patchSetId": 8
      },
      "lineNbr": 371,
      "author": {
        "id": 5147
      },
      "writtenOn": "2018-10-23T11:21:02Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "98d599bf_ebde3508",
      "range": {
        "startLine": 370,
        "startChar": 0,
        "endLine": 371,
        "endChar": 47
      },
      "revId": "07a7274bf81483d8f4ff13cbe0f4709289162d1f",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7def5b9e_1ee17e98",
        "filename": "logging/rtc_event_log/encoder/delta_encoding.cc",
        "patchSetId": 8
      },
      "lineNbr": 373,
      "author": {
        "id": 5150
      },
      "writtenOn": "2018-10-19T21:13:05Z",
      "side": 1,
      "message": "SignedBitWidth(max_pos_magnitude, max_neg_magnitude);",
      "range": {
        "startLine": 372,
        "startChar": 43,
        "endLine": 373,
        "endChar": 74
      },
      "revId": "07a7274bf81483d8f4ff13cbe0f4709289162d1f",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6b2274e9_ce1065d3",
        "filename": "logging/rtc_event_log/encoder/delta_encoding.cc",
        "patchSetId": 8
      },
      "lineNbr": 373,
      "author": {
        "id": 5147
      },
      "writtenOn": "2018-10-23T11:21:02Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7def5b9e_1ee17e98",
      "range": {
        "startLine": 372,
        "startChar": 43,
        "endLine": 373,
        "endChar": 74
      },
      "revId": "07a7274bf81483d8f4ff13cbe0f4709289162d1f",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a829e0ae_8e6fc27d",
        "filename": "logging/rtc_event_log/encoder/delta_encoding.cc",
        "patchSetId": 8
      },
      "lineNbr": 414,
      "author": {
        "id": 5150
      },
      "writtenOn": "2018-10-19T21:13:05Z",
      "side": 1,
      "message": "const uint64_t forward_delta \u003d UnsignedDelta(previous, current, width);\nconst uint64_t backward_delta \u003d UnsignedDelta(current, previous, width);\nif (forward_delta \u003c backward_delta) {\n  max_pos_signed_delta \u003d std::max(forward_delta, max_pos_signed_delta);\n} else {\n  max_neg_signed_delta \u003d std::max(backward_delta, max_pos_signed_delta);\n}\ninstead of the 4 lines below.",
      "revId": "07a7274bf81483d8f4ff13cbe0f4709289162d1f",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4a70c6f1_281251e7",
        "filename": "logging/rtc_event_log/encoder/delta_encoding.cc",
        "patchSetId": 8
      },
      "lineNbr": 414,
      "author": {
        "id": 5147
      },
      "writtenOn": "2018-10-23T11:21:02Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a829e0ae_8e6fc27d",
      "revId": "07a7274bf81483d8f4ff13cbe0f4709289162d1f",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b136e877_80d9ddd6",
        "filename": "logging/rtc_event_log/encoder/delta_encoding.cc",
        "patchSetId": 8
      },
      "lineNbr": 456,
      "author": {
        "id": 5150
      },
      "writtenOn": "2018-10-19T21:13:05Z",
      "side": 1,
      "message": "This function can be removed.",
      "revId": "07a7274bf81483d8f4ff13cbe0f4709289162d1f",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "25c7410d_8a8243b6",
        "filename": "logging/rtc_event_log/encoder/delta_encoding.cc",
        "patchSetId": 8
      },
      "lineNbr": 456,
      "author": {
        "id": 5147
      },
      "writtenOn": "2018-10-23T11:21:02Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b136e877_80d9ddd6",
      "revId": "07a7274bf81483d8f4ff13cbe0f4709289162d1f",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6e674d7b_14efdefb",
        "filename": "logging/rtc_event_log/encoder/delta_encoding.cc",
        "patchSetId": 8
      },
      "lineNbr": 568,
      "author": {
        "id": 5150
      },
      "writtenOn": "2018-10-19T21:13:05Z",
      "side": 1,
      "message": "const uint64_t forward_delta \u003d UnsignedDelta(previous, current, params_.original_width_bits);\nconst uint64_t backward_delta \u003d UnsignedDelta(current, previous, params_.original_width_bits);\nif (forward_delta \u003c backward_delta) {\n  writer_-\u003eWriteBits(forward_delta, params_.delta_width_bits);\n  return;\n}\n// Generate a 2s-complement representation of -backward_delta.\n// i.e. a number x such that x + backward_delta \u003d 2^delta_width_bits.\n// Let delta_mask be 2^delta_width_bits - 1\nconst uint64_t representation \u003d delta_mask - backwards_delta + 1\nwriter_-\u003eWriteBits(representation, params_.delta_width_bits);",
      "range": {
        "startLine": 565,
        "startChar": 0,
        "endLine": 568,
        "endChar": 47
      },
      "revId": "07a7274bf81483d8f4ff13cbe0f4709289162d1f",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "133f6d83_14bc6546",
        "filename": "logging/rtc_event_log/encoder/delta_encoding.cc",
        "patchSetId": 8
      },
      "lineNbr": 568,
      "author": {
        "id": 5147
      },
      "writtenOn": "2018-10-23T11:21:02Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6e674d7b_14efdefb",
      "range": {
        "startLine": 565,
        "startChar": 0,
        "endLine": 568,
        "endChar": 47
      },
      "revId": "07a7274bf81483d8f4ff13cbe0f4709289162d1f",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7d095861_dec530d7",
        "filename": "logging/rtc_event_log/encoder/delta_encoding.cc",
        "patchSetId": 8
      },
      "lineNbr": 864,
      "author": {
        "id": 5150
      },
      "writtenOn": "2018-10-19T21:13:05Z",
      "side": 1,
      "message": "This could be precomputed, like value_mask.",
      "range": {
        "startLine": 861,
        "startChar": 2,
        "endLine": 864,
        "endChar": 71
      },
      "revId": "07a7274bf81483d8f4ff13cbe0f4709289162d1f",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5b969ca8_24be49f2",
        "filename": "logging/rtc_event_log/encoder/delta_encoding.cc",
        "patchSetId": 8
      },
      "lineNbr": 864,
      "author": {
        "id": 5147
      },
      "writtenOn": "2018-10-23T11:21:02Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7d095861_dec530d7",
      "range": {
        "startLine": 861,
        "startChar": 2,
        "endLine": 864,
        "endChar": 71
      },
      "revId": "07a7274bf81483d8f4ff13cbe0f4709289162d1f",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2dbfcf73_2b9e3705",
        "filename": "logging/rtc_event_log/encoder/delta_encoding.cc",
        "patchSetId": 8
      },
      "lineNbr": 865,
      "author": {
        "id": 5150
      },
      "writtenOn": "2018-10-19T21:13:05Z",
      "side": 1,
      "message": "Alternatively\n// delta \u003d 2^w - delta_abs and delta_mask \u003d 2^w - 1\nreturn (base + delta - delta_mask - 1) \u0026 value_mask",
      "revId": "07a7274bf81483d8f4ff13cbe0f4709289162d1f",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7c0f5152_31b48078",
        "filename": "logging/rtc_event_log/encoder/delta_encoding.cc",
        "patchSetId": 8
      },
      "lineNbr": 865,
      "author": {
        "id": 5147
      },
      "writtenOn": "2018-10-23T11:21:02Z",
      "side": 1,
      "message": "I prefer to keep it as is.",
      "parentUuid": "2dbfcf73_2b9e3705",
      "revId": "07a7274bf81483d8f4ff13cbe0f4709289162d1f",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    }
  ]
}