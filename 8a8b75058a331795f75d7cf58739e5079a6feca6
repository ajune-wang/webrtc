{
  "comments": [
    {
      "key": {
        "uuid": "2fbcbbcf_1e303689",
        "filename": "modules/audio_processing/BUILD.gn",
        "patchSetId": 6
      },
      "lineNbr": 463,
      "author": {
        "id": 5119
      },
      "writtenOn": "2018-10-29T15:35:59Z",
      "side": 1,
      "message": "(This is intentional: Some #includes requiring APM_DEBUG_DUMP to be defined are moved into audio_processing_impl.h from .cc, causing this test to require the definition as well.)",
      "range": {
        "startLine": 463,
        "startChar": 0,
        "endLine": 463,
        "endChar": 36
      },
      "revId": "8a8b75058a331795f75d7cf58739e5079a6feca6",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7dfbc487_9a507ef8",
        "filename": "modules/audio_processing/audio_processing_impl.cc",
        "patchSetId": 6
      },
      "lineNbr": 1495,
      "author": {
        "id": 5125
      },
      "writtenOn": "2018-10-29T14:56:25Z",
      "side": 1,
      "message": "Why is the abstraction of this functionality into a separate function needed? It only contains three lines and separating it into a separate function requires more code.",
      "range": {
        "startLine": 1495,
        "startChar": 2,
        "endLine": 1495,
        "endChar": 58
      },
      "revId": "8a8b75058a331795f75d7cf58739e5079a6feca6",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4fc7a008_d32cdd59",
        "filename": "modules/audio_processing/audio_processing_impl.cc",
        "patchSetId": 6
      },
      "lineNbr": 1495,
      "author": {
        "id": 5119
      },
      "writtenOn": "2018-10-29T15:35:59Z",
      "side": 1,
      "message": "The RTC_GUARDED_BY(crit_capture_) annotation on capture_submodules_ requires that whenever e.g. echo_controller is accessed, the crit_capture_ lock must be held.\n\nAs you point out, this is actually not necessary for thread safety when it comes to EchoControl::AnalyzeRender. It can safely be called without the crit_capture lock (as long as we don\u0027t reset the echo_controller unique_ptr, but that can\u0027t happen since we hold crit_render_).\n\nIf we want to use the annotation, and call EchoControl::AnalyzeRender without holding the lock, then we must make an exception to the annotations. The only tool we have to do that is to apply NO_THREAD_SAFETY_ANALYSIS to the function that calls EchoControl::AnalyzeRender. That is the purpose of the new function AnalyzeRenderStreamWithEchoController: To ignore the annotations for echo_controller, because we know better than the lock annotations in this case.\n\nI don\u0027t want to add the exception directly to ProcessRenderStreamLocked, because then it would also ignore the RTC_REQUIRES_EXCLUSIVE_LOCKS(crit_render_) on the function. The scope of NO_THREAD_SAFETY_ANALYSIS should be kept as small as possible.",
      "parentUuid": "7dfbc487_9a507ef8",
      "range": {
        "startLine": 1495,
        "startChar": 2,
        "endLine": 1495,
        "endChar": 58
      },
      "revId": "8a8b75058a331795f75d7cf58739e5079a6feca6",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a5b7f25_050df714",
        "filename": "modules/audio_processing/audio_processing_impl.cc",
        "patchSetId": 6
      },
      "lineNbr": 1495,
      "author": {
        "id": 5125
      },
      "writtenOn": "2018-10-29T18:49:31Z",
      "side": 1,
      "message": "Hmm, if the intention is to move code that does not require lock coverage into a separate method, I\u0027d prefer to have a separate method for that purpose, rather than to make it echo control specific.\n\nI\u0027m still not convinced this is the right approach though. As you point out, echo controller is thread-safe as long as the echo controller unique pointer is not reset, but I think that conditions for that likely coincide with for instance the conditions for render_buffer_. Therefore, if the target is to move code that don\u0027t need the lock into a separate method I think it would make sense to try to make the move so that it targets not the echo control module in particular but rather the general purpose of removing the need for locks on this code.",
      "parentUuid": "4fc7a008_d32cdd59",
      "range": {
        "startLine": 1495,
        "startChar": 2,
        "endLine": 1495,
        "endChar": 58
      },
      "revId": "8a8b75058a331795f75d7cf58739e5079a6feca6",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "840e2a5a_6227c0ad",
        "filename": "modules/audio_processing/audio_processing_impl.h",
        "patchSetId": 6
      },
      "lineNbr": 285,
      "author": {
        "id": 5125
      },
      "writtenOn": "2018-10-29T14:56:25Z",
      "side": 1,
      "message": "This name is very long. Please change it to a shorter name.",
      "range": {
        "startLine": 285,
        "startChar": 7,
        "endLine": 285,
        "endChar": 63
      },
      "revId": "8a8b75058a331795f75d7cf58739e5079a6feca6",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e5e7a632_8f618e02",
        "filename": "modules/audio_processing/audio_processing_impl.h",
        "patchSetId": 6
      },
      "lineNbr": 285,
      "author": {
        "id": 5119
      },
      "writtenOn": "2018-10-29T15:35:59Z",
      "side": 1,
      "message": "Sure! --\u003e AnalyzeRenderStreamWithEchoController.",
      "parentUuid": "840e2a5a_6227c0ad",
      "range": {
        "startLine": 285,
        "startChar": 7,
        "endLine": 285,
        "endChar": 63
      },
      "revId": "8a8b75058a331795f75d7cf58739e5079a6feca6",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0f650f68_fd6d21ac",
        "filename": "modules/audio_processing/audio_processing_impl.h",
        "patchSetId": 6
      },
      "lineNbr": 285,
      "author": {
        "id": 5125
      },
      "writtenOn": "2018-10-29T18:49:31Z",
      "side": 1,
      "message": "It is still very long. :-)",
      "parentUuid": "e5e7a632_8f618e02",
      "range": {
        "startLine": 285,
        "startChar": 7,
        "endLine": 285,
        "endChar": 63
      },
      "revId": "8a8b75058a331795f75d7cf58739e5079a6feca6",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "44dd5b04_f3d0956f",
        "filename": "modules/audio_processing/audio_processing_impl.h",
        "patchSetId": 6
      },
      "lineNbr": 354,
      "author": {
        "id": 5125
      },
      "writtenOn": "2018-10-29T14:56:25Z",
      "side": 1,
      "message": "I think that the code would benefit from this name being shorter.\nWhat about\ncapture_submodules_\n?",
      "range": {
        "startLine": 354,
        "startChar": 4,
        "endLine": 354,
        "endChar": 31
      },
      "revId": "8a8b75058a331795f75d7cf58739e5079a6feca6",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3f950fbe_715edb16",
        "filename": "modules/audio_processing/audio_processing_impl.h",
        "patchSetId": 6
      },
      "lineNbr": 354,
      "author": {
        "id": 5119
      },
      "writtenOn": "2018-10-29T15:35:59Z",
      "side": 1,
      "message": "Done! Note that this makes public_submodules_ less clear - those modules are also capture or render submodules.",
      "parentUuid": "44dd5b04_f3d0956f",
      "range": {
        "startLine": 354,
        "startChar": 4,
        "endLine": 354,
        "endChar": 31
      },
      "revId": "8a8b75058a331795f75d7cf58739e5079a6feca6",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8cb7ba45_b725d3fb",
        "filename": "modules/audio_processing/audio_processing_impl.h",
        "patchSetId": 6
      },
      "lineNbr": 361,
      "author": {
        "id": 5125
      },
      "writtenOn": "2018-10-29T14:56:25Z",
      "side": 1,
      "message": "as above\n\nWhat about\nrender_submodules_\n?",
      "range": {
        "startLine": 361,
        "startChar": 4,
        "endLine": 361,
        "endChar": 30
      },
      "revId": "8a8b75058a331795f75d7cf58739e5079a6feca6",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "371e2f1b_5cdd16d4",
        "filename": "modules/audio_processing/audio_processing_impl.h",
        "patchSetId": 6
      },
      "lineNbr": 361,
      "author": {
        "id": 5119
      },
      "writtenOn": "2018-10-29T15:35:59Z",
      "side": 1,
      "message": "Done! Note, as above.",
      "parentUuid": "8cb7ba45_b725d3fb",
      "range": {
        "startLine": 361,
        "startChar": 4,
        "endLine": 361,
        "endChar": 30
      },
      "revId": "8a8b75058a331795f75d7cf58739e5079a6feca6",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    }
  ]
}