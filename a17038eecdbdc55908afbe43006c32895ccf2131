{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "07e46924_0c3fe57f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 5029
      },
      "writtenOn": "2024-01-02T19:51:52Z",
      "side": 1,
      "message": "One more comment, and this change LGTM. I do believe the lack of DxgiFrameContext::Reset call would be problematic. But I cannot really tell if it would fix the flakiness you mentioned in the bug itself.\n\nAlso add Mark as the new owner of this component.\n\nThank you for the fix.",
      "revId": "a17038eecdbdc55908afbe43006c32895ccf2131",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bd7f22aa_4de6cbe5",
        "filename": "modules/desktop_capture/win/dxgi_duplicator_controller.cc",
        "patchSetId": 3
      },
      "lineNbr": 504,
      "author": {
        "id": 5029
      },
      "writtenOn": "2024-01-02T19:51:52Z",
      "side": 1,
      "message": "Sorry for the late response, I think this Setup call is not necessary. The following DoDuplicateUnlocked call will execute it anyway.\n```suggestion\n  }\n```",
      "range": {
        "startLine": 504,
        "startChar": 0,
        "endLine": 504,
        "endChar": 19
      },
      "revId": "a17038eecdbdc55908afbe43006c32895ccf2131",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7d023b07_9fd4a8b9",
        "filename": "modules/desktop_capture/win/dxgi_duplicator_controller.cc",
        "patchSetId": 3
      },
      "lineNbr": 504,
      "author": {
        "id": 17664
      },
      "writtenOn": "2024-01-04T13:59:34Z",
      "side": 1,
      "message": "There may be a problem with the current frame, So we must call it immediately.",
      "parentUuid": "bd7f22aa_4de6cbe5",
      "range": {
        "startLine": 504,
        "startChar": 0,
        "endLine": 504,
        "endChar": 19
      },
      "revId": "a17038eecdbdc55908afbe43006c32895ccf2131",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "87b28c82_065aba30",
        "filename": "modules/desktop_capture/win/dxgi_duplicator_controller.cc",
        "patchSetId": 3
      },
      "lineNbr": 504,
      "author": {
        "id": 5029
      },
      "writtenOn": "2024-01-04T17:18:58Z",
      "side": 1,
      "message": "But Setup(context) does not really do anything magic or is time related, i.e. delaying the Setup(context) call until the next Duplicate call may not have any impacts. Did I miss anything in the middle?\n\nhttps://crsrc.org/c/third_party/webrtc/modules/desktop_capture/win/dxgi_output_duplicator.cc;drc\u003de5f8ff312fe542f39c7d34b4440f18d1500b15f9;l\u003d382",
      "parentUuid": "7d023b07_9fd4a8b9",
      "range": {
        "startLine": 504,
        "startChar": 0,
        "endLine": 504,
        "endChar": 19
      },
      "revId": "a17038eecdbdc55908afbe43006c32895ccf2131",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e7dc7bda_ff3b36b3",
        "filename": "modules/desktop_capture/win/dxgi_duplicator_controller.cc",
        "patchSetId": 3
      },
      "lineNbr": 504,
      "author": {
        "id": 14134
      },
      "writtenOn": "2024-01-05T21:10:27Z",
      "side": 1,
      "message": "I am not deeply familiar with this capturer, but I think it\u0027s worth understanding better why we would need to call Setup() again here after it has already been called in DoDuplicateUnlocked(). \n\nThe other thing I don\u0027t understand about this code is the need for the fallback_frame at all.  It looks like on a target resolution change, this code in DoDuplicate() should have already set the frame size correctly.\n\nhttps://source.chromium.org/chromium/chromium/src/+/main:third_party/webrtc/modules/desktop_capture/win/dxgi_duplicator_controller.cc;drc\u003d67d90538f11c6b232dbfd716075db52aeb34fd15;l\u003d192",
      "parentUuid": "87b28c82_065aba30",
      "range": {
        "startLine": 504,
        "startChar": 0,
        "endLine": 504,
        "endChar": 19
      },
      "revId": "a17038eecdbdc55908afbe43006c32895ccf2131",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e225c2d5_86df3aa3",
        "filename": "modules/desktop_capture/win/dxgi_duplicator_controller.cc",
        "patchSetId": 3
      },
      "lineNbr": 504,
      "author": {
        "id": 5029
      },
      "writtenOn": "2024-01-05T21:52:23Z",
      "side": 1,
      "message": "The fallback frame is used when user captures only one of multiple monitors. But we still want to capture all the monitors to ensure the hardware won\u0027t return blank images.\n\nhttps://crsrc.org/c/third_party/webrtc/modules/desktop_capture/win/dxgi_duplicator_controller.cc;drc\u003d67d90538f11c6b232dbfd716075db52aeb34fd15;l\u003d427\n\n\n\nTo the root cause of the flickering, I recall the TODO here: https://crsrc.org/c/third_party/webrtc/modules/desktop_capture/win/dxgi_duplicator_controller.cc;drc\u003d67d90538f11c6b232dbfd716075db52aeb34fd15;l\u003d427\n\nSo likely the root cause is still unknown, but the right approach is to reset the updated_region as what the Setup does in https://crsrc.org/c/third_party/webrtc/modules/desktop_capture/win/dxgi_output_duplicator.cc;drc\u003d67d90538f11c6b232dbfd716075db52aeb34fd15;l\u003d385.",
      "parentUuid": "e7dc7bda_ff3b36b3",
      "range": {
        "startLine": 504,
        "startChar": 0,
        "endLine": 504,
        "endChar": 19
      },
      "revId": "a17038eecdbdc55908afbe43006c32895ccf2131",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a877ff77_b085b96b",
        "filename": "modules/desktop_capture/win/dxgi_duplicator_controller.cc",
        "patchSetId": 3
      },
      "lineNbr": 504,
      "author": {
        "id": 17664
      },
      "writtenOn": "2024-01-08T03:39:20Z",
      "side": 1,
      "message": "When \u0027context-\u003eReset()\u0027 called, \u0027DxgiOutputDuplicator::Unregister\u0027 will erase \u0027context\u0027, So if we don\u0027t call \u0027Setup\u0027, the next frame(DoDuplicateOne will be called after EnsureFrameCaptured) may be messed up?",
      "parentUuid": "e225c2d5_86df3aa3",
      "range": {
        "startLine": 504,
        "startChar": 0,
        "endLine": 504,
        "endChar": 19
      },
      "revId": "a17038eecdbdc55908afbe43006c32895ccf2131",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    }
  ]
}