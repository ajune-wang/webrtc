{
  "comments": [
    {
      "key": {
        "uuid": "8c83a231_eab4b5ee",
        "filename": "modules/audio_processing/audio_processing_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 376,
      "author": {
        "id": 5119
      },
      "writtenOn": "2019-11-15T16:04:47Z",
      "side": 1,
      "message": "Nice!",
      "range": {
        "startLine": 376,
        "startChar": 0,
        "endLine": 376,
        "endChar": 54
      },
      "revId": "58fd6724d8b74ef6cc0d6d92ad150c296df25c2b",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "44d88660_42770a16",
        "filename": "modules/audio_processing/audio_processing_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 376,
      "author": {
        "id": 5125
      },
      "writtenOn": "2019-11-18T07:53:11Z",
      "side": 1,
      "message": ":-)",
      "parentUuid": "8c83a231_eab4b5ee",
      "range": {
        "startLine": 376,
        "startChar": 0,
        "endLine": 376,
        "endChar": 54
      },
      "revId": "58fd6724d8b74ef6cc0d6d92ad150c296df25c2b",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cf130588_ecd1de3b",
        "filename": "modules/audio_processing/audio_processing_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 485,
      "author": {
        "id": 5119
      },
      "writtenOn": "2019-11-15T16:04:47Z",
      "side": 1,
      "message": "What do you think about creating submodules_.agc_manager in the APM constructor, and deleting:\nconstants_.agc_startup_min_volume\nconstants_.agc_clipped_level_min\nconstants_.use_experimental_agc\nconstants_.use_experimental_agc_agc2_level_estimation\nconstants_.use_experimental_agc_agc2_digital_adaptive\n\nThey are essentially only accessed here. The tests for use_experimental_agc can be replaced by testing directly if agc_manager is non-nullptr, thus removing one possible illegal state (APM assumes use_experimental_agc and !!agc_manager are always both false or both true).",
      "range": {
        "startLine": 479,
        "startChar": 0,
        "endLine": 485,
        "endChar": 5
      },
      "revId": "58fd6724d8b74ef6cc0d6d92ad150c296df25c2b",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e23c67a5_95fd514d",
        "filename": "modules/audio_processing/audio_processing_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 485,
      "author": {
        "id": 5125
      },
      "writtenOn": "2019-11-18T07:53:11Z",
      "side": 1,
      "message": "Awesome suggestion!\nDone.",
      "parentUuid": "cf130588_ecd1de3b",
      "range": {
        "startLine": 479,
        "startChar": 0,
        "endLine": 485,
        "endChar": 5
      },
      "revId": "58fd6724d8b74ef6cc0d6d92ad150c296df25c2b",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "58562961_65b5f793",
        "filename": "modules/audio_processing/audio_processing_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 692,
      "author": {
        "id": 5119
      },
      "writtenOn": "2019-11-15T16:04:47Z",
      "side": 1,
      "message": "There are several places like this, where the AgcManagerDirect overrides GainControlImpl.\n\nWhat do you think about moving ownership of the gain controller into AgcManagerDirect, and have  AgcManagerDirect implement the GainControl interface?\n\nAPM is freed of the \"which AGC to use\" logic, it only resets submodules_.gain_control with the right type on reinitialization.\nAgcManager does not need the new_compression_to_set_ state (and shared responsibility for the gain_control as a function parameter).",
      "range": {
        "startLine": 691,
        "startChar": 0,
        "endLine": 692,
        "endChar": 40
      },
      "revId": "58fd6724d8b74ef6cc0d6d92ad150c296df25c2b",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bd022bdf_7f8a625a",
        "filename": "modules/audio_processing/audio_processing_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 692,
      "author": {
        "id": 5125
      },
      "writtenOn": "2019-11-18T07:53:11Z",
      "side": 1,
      "message": "I think that is a great suggestion! \n\nI think this is still slightly tricky to achieve, but I think we should strive to do that. I would prefer to do it separately from the multi-channel work.\n\nThe reason that I think it is tricky is that the GainControl interface is for both digital and analog AGC, while the AGC manager only is for analog AGC.\n\nThis means that if AGC manager is off, the GainControlImpl handles both analog and digital AGC, and if it is on it handles digital AGC.\n\n\nI think we should solve this by moving all the analog AGC code from GainControlImpl into AGC manager direct. But I would prefer to do that in a separate CL as that is a quite big change.",
      "parentUuid": "58562961_65b5f793",
      "range": {
        "startLine": 691,
        "startChar": 0,
        "endLine": 692,
        "endChar": 40
      },
      "revId": "58fd6724d8b74ef6cc0d6d92ad150c296df25c2b",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b17ae83a_5ae52cde",
        "filename": "modules/audio_processing/audio_processing_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 692,
      "author": {
        "id": 5119
      },
      "writtenOn": "2019-11-19T16:24:02Z",
      "side": 1,
      "message": "Noting it as future work sgtm, this CL is still an improvement.\n\nI see. My suggestion is then be to let AgcManager be both for analog and digital AGC, just a different type of AGC module. Essentially: You choose between using AGC with a GainControlImpl, and using AGC with a AgcManagerDirect. They both implement the GainControl interface. It just so happens that AgcManagerDirect uses a GainControlImpl in its implementation to do its digital AGC handling.",
      "parentUuid": "bd022bdf_7f8a625a",
      "range": {
        "startLine": 691,
        "startChar": 0,
        "endLine": 692,
        "endChar": 40
      },
      "revId": "58fd6724d8b74ef6cc0d6d92ad150c296df25c2b",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c12c4e94_160510ac",
        "filename": "modules/audio_processing/audio_processing_impl.cc",
        "patchSetId": 4
      },
      "lineNbr": 692,
      "author": {
        "id": 5125
      },
      "writtenOn": "2019-11-19T19:34:30Z",
      "side": 1,
      "message": "That would make sense. Also, it would make sense to before that simplify the media constraints for the AGC in Chrome, as the current implementation is a bit tied to that.\n\nFor instance, if the experimental_agc could be made permanent, the analog agc code in the gain_control submodule could be deprecated.",
      "parentUuid": "b17ae83a_5ae52cde",
      "range": {
        "startLine": 691,
        "startChar": 0,
        "endLine": 692,
        "endChar": 40
      },
      "revId": "58fd6724d8b74ef6cc0d6d92ad150c296df25c2b",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    }
  ]
}