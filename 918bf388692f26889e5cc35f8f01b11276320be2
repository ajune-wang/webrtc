{
  "comments": [
    {
      "key": {
        "uuid": "116c71bd_0cc03cdc",
        "filename": "api/video/video_frame_buffer.h",
        "patchSetId": 1
      },
      "lineNbr": 72,
      "author": {
        "id": 5234
      },
      "writtenOn": "2019-04-25T13:42:32Z",
      "side": 1,
      "message": "I don\u0027t quite understand this. What does \"trivially convertible mean\"? One can call ToI420, and expect that it is cheap (no large allocation or copy)? Or can one call GetI420()?\n\nFor the chrome usecase, it sounds to me like the right way is to have an implementation of I420BufferInterface backed by shared memory, not using kNative. Any reason why that won\u0027t work? (And I don\u0027t find any class named \"WebrtcFrameBufferAdapter\" in chromium).",
      "range": {
        "startLine": 68,
        "startChar": 0,
        "endLine": 72,
        "endChar": 13
      },
      "revId": "918bf388692f26889e5cc35f8f01b11276320be2",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e748e222_6ba37ac8",
        "filename": "api/video/video_frame_buffer.h",
        "patchSetId": 1
      },
      "lineNbr": 72,
      "author": {
        "id": 5117
      },
      "writtenOn": "2019-04-25T13:51:58Z",
      "side": 1,
      "message": "Sorry, it\u0027s named WebrtcVideoFrameAdapter.\n\nIt\u0027s inherited from VideoFrameBuffer, and has kNative type. It can\u0027t have kI420 type as the chrome encoder should be able to somehow distinguish resized or cropped, created by webrtc buffers from original, backed by the shared memory.\n\nThe trivially convertible here means that pixel data stays unchanged during conversion.\nThis is needed when we convert to I420 for software encoders. There we can leave update_rect unchanged only if the pixel data is unchanged.\n\nWill this new comment make it clearer?\n  // Signals if the underlying pixel format is trivially convertible to I420,\n  // i.e. pixel data remains unchanged.\n  // One example of such buffer is WebrtcVideoFrameAdapter - it\u0027s essentially\n  // a I420 buffer, but backed by a chrome specific shared memory buffer and\n  // therefore marked as kNative, so in-chrome encoders could avoid extra\n  // copying if it\u0027s passed by webrtc unchanged.",
      "parentUuid": "116c71bd_0cc03cdc",
      "range": {
        "startLine": 68,
        "startChar": 0,
        "endLine": 72,
        "endChar": 13
      },
      "revId": "918bf388692f26889e5cc35f8f01b11276320be2",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d49f12db_603ed1fb",
        "filename": "api/video/video_frame_buffer.h",
        "patchSetId": 1
      },
      "lineNbr": 72,
      "author": {
        "id": 5234
      },
      "writtenOn": "2019-04-25T14:22:19Z",
      "side": 1,
      "message": "\u003e Sorry, it\u0027s named WebrtcVideoFrameAdapter.\n\u003e \n\u003e It\u0027s inherited from VideoFrameBuffer, and has kNative type. It can\u0027t have kI420 type as the chrome encoder should be able to somehow distinguish resized or cropped, created by webrtc buffers from original, backed by the shared memory.\n\nI don\u0027t see why. Can\u0027t the type() method be implemented like\n\n  if (frame_-\u003ehas_texture())\n    return Type::kNative;\n  else if (frame_-\u003eformat() \u003d\u003d media::PIXEL_FORMAT_I420A)\n    return Type::I420A;\n  else\n    return Type::kI420;\n\nTo support GetI420(), when appropriate, it would need to own whatever it returns a pointer to (it could simple be |this|, with a private inherit). Not sure what\u0027s the best way, but it should be doable.\n\n\u003e Will this new comment make it clearer?\n\u003e   // Signals if the underlying pixel format is trivially convertible to I420,\n\u003e   // i.e. pixel data remains unchanged.\n\u003e   // One example of such buffer is WebrtcVideoFrameAdapter - it\u0027s essentially\n\u003e   // a I420 buffer, but backed by a chrome specific shared memory buffer and\n\u003e   // therefore marked as kNative, so in-chrome encoders could avoid extra\n\u003e   // copying if it\u0027s passed by webrtc unchanged.\n\nPlease make clear that \"convertible\" refers to the ToI420 method. And name of the class also has a capital R in WebRtc.",
      "parentUuid": "e748e222_6ba37ac8",
      "range": {
        "startLine": 68,
        "startChar": 0,
        "endLine": 72,
        "endChar": 13
      },
      "revId": "918bf388692f26889e5cc35f8f01b11276320be2",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6544cd05_71340ab3",
        "filename": "api/video/video_frame_buffer.h",
        "patchSetId": 1
      },
      "lineNbr": 72,
      "author": {
        "id": 5117
      },
      "writtenOn": "2019-04-25T14:28:44Z",
      "side": 1,
      "message": "\u003e Can\u0027t the type() method be implemented like\n\nThat was my first idea also, but it breaks, e.g. this code:\nhttps://cs.chromium.org/chromium/src/content/renderer/media/webrtc/rtc_video_encoder.cc?sq\u003dpackage:chromium\u0026dr\u003dCSs\u0026g\u003d0\u0026l\u003d650\n\nThe type() must be kNative for these frames.",
      "parentUuid": "d49f12db_603ed1fb",
      "range": {
        "startLine": 68,
        "startChar": 0,
        "endLine": 72,
        "endChar": 13
      },
      "revId": "918bf388692f26889e5cc35f8f01b11276320be2",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1a29fe50_12e53853",
        "filename": "api/video/video_frame_buffer.h",
        "patchSetId": 1
      },
      "lineNbr": 72,
      "author": {
        "id": 5234
      },
      "writtenOn": "2019-04-26T06:47:50Z",
      "side": 1,
      "message": "I see. Ok for the time being, then. \n\nDo you think it\u0027s reasonable to switch to type kI420 and GetI420() (for the case that the frame actually is backed by I420 data in memory) longer term? If so, please file a bug and write a TODO item referencing it.\n\nI\u0027d like to see the updated docs before it lgtm.",
      "parentUuid": "6544cd05_71340ab3",
      "range": {
        "startLine": 68,
        "startChar": 0,
        "endLine": 72,
        "endChar": 13
      },
      "revId": "918bf388692f26889e5cc35f8f01b11276320be2",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    }
  ]
}