{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "47a320bc_55ea9e0a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 18
      },
      "lineNbr": 0,
      "author": {
        "id": 9741
      },
      "writtenOn": "2023-12-19T04:25:14Z",
      "side": 1,
      "message": "Thanks Henrik and Markus!! Please take another look.\n\nHi Harald, could you help to review this CL? thanks!",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9956d14b_1f99f76c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 18
      },
      "lineNbr": 0,
      "author": {
        "id": 9515
      },
      "writtenOn": "2023-12-19T12:21:40Z",
      "side": 1,
      "message": "I think this looks okay now, thanks Zhaoliang.",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d6465212_5292554d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 18
      },
      "lineNbr": 0,
      "author": {
        "id": 5634
      },
      "writtenOn": "2023-12-19T21:56:01Z",
      "side": 1,
      "message": "This doesn\u0027t seem ready for submission to me.\n\nI grew more confused as to the threading model the more I looked at it. That\u0027s not a good thing.",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b2d8f345_2532bfaa",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 18
      },
      "lineNbr": 0,
      "author": {
        "id": 9515
      },
      "writtenOn": "2023-12-19T23:53:34Z",
      "side": 1,
      "message": "What you probably need to know is that the FCA is primarily operated \u0026 destroyed on the encode sequence, and the metronome needs be operated solely from the worker thread. In one of the earlier patchsets we figured it was simpler to bind the lifetime of VSyncEncodeAdapterMode to the worker thread than keeping it on the encoding sequence.",
      "parentUuid": "d6465212_5292554d",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4a476726_d9302658",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 18
      },
      "lineNbr": 0,
      "author": {
        "id": 5142
      },
      "writtenOn": "2023-12-20T14:05:37Z",
      "side": 1,
      "message": "I only have nits. Redesign of existing patterns is out of scope of this CL. +1",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bdfe293d_a4714bb6",
        "filename": "video/frame_cadence_adapter.cc",
        "patchSetId": 18
      },
      "lineNbr": 238,
      "author": {
        "id": 5634
      },
      "writtenOn": "2023-12-19T21:56:01Z",
      "side": 1,
      "message": "Nit: align -\u003e aligned",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6e541233_0ca7926c",
        "filename": "video/frame_cadence_adapter.cc",
        "patchSetId": 18
      },
      "lineNbr": 238,
      "author": {
        "id": 9741
      },
      "writtenOn": "2023-12-21T02:58:04Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "bdfe293d_a4714bb6",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a0887914_16c170a1",
        "filename": "video/frame_cadence_adapter.cc",
        "patchSetId": 18
      },
      "lineNbr": 263,
      "author": {
        "id": 5634
      },
      "writtenOn": "2023-12-19T21:56:01Z",
      "side": 1,
      "message": "New code not exercised by tests?",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0ba50ebc_2ea0b3dc",
        "filename": "video/frame_cadence_adapter.cc",
        "patchSetId": 18
      },
      "lineNbr": 263,
      "author": {
        "id": 5142
      },
      "writtenOn": "2023-12-20T14:05:37Z",
      "side": 1,
      "message": "I wonder if a future refactoring CL could avoid us having to implement this in multiple AdapterMode, but I feel such redesign is out of scope of this CL",
      "parentUuid": "a0887914_16c170a1",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "76e258b4_beb8174b",
        "filename": "video/frame_cadence_adapter.cc",
        "patchSetId": 18
      },
      "lineNbr": 263,
      "author": {
        "id": 9741
      },
      "writtenOn": "2024-01-04T02:43:46Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "0ba50ebc_2ea0b3dc",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "844fc13f_b54c3755",
        "filename": "video/frame_cadence_adapter.cc",
        "patchSetId": 18
      },
      "lineNbr": 365,
      "author": {
        "id": 5634
      },
      "writtenOn": "2023-12-19T21:56:01Z",
      "side": 1,
      "message": "What thread guards the vsync_encode_adapter_?",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "37c8e194_b1bf4009",
        "filename": "video/frame_cadence_adapter.cc",
        "patchSetId": 18
      },
      "lineNbr": 365,
      "author": {
        "id": 9741
      },
      "writtenOn": "2023-12-21T02:58:04Z",
      "side": 1,
      "message": "The vsync_encode_adapter_ would be called from both worker queue and encode queue, but all metronome related memembers are guarded by worker sequence, and others are all guarded by encode queue, so I think it\u0027s safe and vsync_encode_adapter_ is destroyed on worker queue by post task from encode queue on the FCAI::dtor.",
      "parentUuid": "844fc13f_b54c3755",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a654c2f3_00eb476a",
        "filename": "video/frame_cadence_adapter.cc",
        "patchSetId": 18
      },
      "lineNbr": 365,
      "author": {
        "id": 9741
      },
      "writtenOn": "2024-01-04T02:43:46Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "37c8e194_b1bf4009",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "99c9676e_7d9fe314",
        "filename": "video/frame_cadence_adapter.cc",
        "patchSetId": 18
      },
      "lineNbr": 366,
      "author": {
        "id": 5634
      },
      "writtenOn": "2023-12-19T21:56:01Z",
      "side": 1,
      "message": "Nit: needs happen -\u003e needs to happen",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ace524a9_d017ad68",
        "filename": "video/frame_cadence_adapter.cc",
        "patchSetId": 18
      },
      "lineNbr": 366,
      "author": {
        "id": 9741
      },
      "writtenOn": "2023-12-21T02:58:04Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "99c9676e_7d9fe314",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "38fcd8af_2a98c839",
        "filename": "video/frame_cadence_adapter.cc",
        "patchSetId": 18
      },
      "lineNbr": 367,
      "author": {
        "id": 5634
      },
      "writtenOn": "2023-12-19T21:56:01Z",
      "side": 1,
      "message": "This seems to be an odd design. Having three members, two optional and one being a pointer, of which only one can be valid at any given time (can they all be missing? Not clear!)\n\nWould be more natural to have a single std::unique_ptr pointing to the current adapter mode object, and deal with the thread requirement by other means.\n\nBut that redesign may be beyond the scope of this CL.",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dfebcef4_9736b957",
        "filename": "video/frame_cadence_adapter.cc",
        "patchSetId": 18
      },
      "lineNbr": 367,
      "author": {
        "id": 9515
      },
      "writtenOn": "2023-12-19T23:53:34Z",
      "side": 1,
      "message": "Either passthrough or vsync modes exist after Initialize. On zero-hertz activation, the zero-hertz mode adapter is created. It\u0027s destroyed again if zero-hertz is deactivated later.",
      "parentUuid": "38fcd8af_2a98c839",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d9e09c02_a1911835",
        "filename": "video/frame_cadence_adapter.cc",
        "patchSetId": 18
      },
      "lineNbr": 367,
      "author": {
        "id": 5142
      },
      "writtenOn": "2023-12-20T14:05:37Z",
      "side": 1,
      "message": "I think redesign is out of scope for this CL which I think fits nicely with patterns already established in this file, but if we can clarify this with a comment that would be good.",
      "parentUuid": "dfebcef4_9736b957",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fcc41d1a_3924366b",
        "filename": "video/frame_cadence_adapter.cc",
        "patchSetId": 18
      },
      "lineNbr": 367,
      "author": {
        "id": 9741
      },
      "writtenOn": "2024-01-04T02:43:46Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "d9e09c02_a1911835",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "da0fadf5_fb7a8562",
        "filename": "video/frame_cadence_adapter.cc",
        "patchSetId": 18
      },
      "lineNbr": 372,
      "author": {
        "id": 5634
      },
      "writtenOn": "2023-12-19T21:56:01Z",
      "side": 1,
      "message": "This is confusing. The comment says that it\u0027s the parameters that say which adapter mode has been set, while there\u0027s a pointer that points to the current adapter mode. Are they set at the same time, or at different times?",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6356c6dd_602762ed",
        "filename": "video/frame_cadence_adapter.cc",
        "patchSetId": 18
      },
      "lineNbr": 372,
      "author": {
        "id": 9741
      },
      "writtenOn": "2023-12-21T02:58:04Z",
      "side": 1,
      "message": "VSync adapter would be set to `current_adapter_mode_` if `metronome_` is valid otherwise passthrough adapter would be set, this happens on FCA::Initialize. And if zero-hertz is enabled, then `zero_hertz_adapter_` would be set to `current_adapter_mode_` at `MaybeReconfigureAdapters`.",
      "parentUuid": "da0fadf5_fb7a8562",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5a3b2ef2_8b548b5d",
        "filename": "video/frame_cadence_adapter.cc",
        "patchSetId": 18
      },
      "lineNbr": 372,
      "author": {
        "id": 9741
      },
      "writtenOn": "2024-01-04T02:43:46Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "6356c6dd_602762ed",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "857074d3_7bd094b5",
        "filename": "video/frame_cadence_adapter.cc",
        "patchSetId": 18
      },
      "lineNbr": 375,
      "author": {
        "id": 5634
      },
      "writtenOn": "2023-12-19T21:56:01Z",
      "side": 1,
      "message": "What thread should guard the metronome?",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8d827a96_e17941f2",
        "filename": "video/frame_cadence_adapter.cc",
        "patchSetId": 18
      },
      "lineNbr": 375,
      "author": {
        "id": 5142
      },
      "writtenOn": "2023-12-20T14:05:37Z",
      "side": 1,
      "message": "The metronome object outlives the peer connection (owned by pc factory) so we don\u0027t need to worry about UAF and the ptr is const. Calling its methods is worker thread only though.",
      "parentUuid": "857074d3_7bd094b5",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "16f83f82_15e3ff59",
        "filename": "video/frame_cadence_adapter.cc",
        "patchSetId": 18
      },
      "lineNbr": 375,
      "author": {
        "id": 9741
      },
      "writtenOn": "2024-01-04T02:43:46Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "8d827a96_e17941f2",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2cb27fbe_d67245f1",
        "filename": "video/frame_cadence_adapter.cc",
        "patchSetId": 18
      },
      "lineNbr": 799,
      "author": {
        "id": 9515
      },
      "writtenOn": "2023-12-19T23:53:34Z",
      "side": 1,
      "message": "Oh, missed this: the passthrough adapter doesn\u0027t need to be created under vsyncencoding. Best if you pull up the creation code of the vsync adapter from ConfigureCurrentAdapterWithoutZeroHertz to this method.",
      "range": {
        "startLine": 799,
        "startChar": 2,
        "endLine": 799,
        "endChar": 22
      },
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "dccd0a6d_1ea57958",
        "filename": "video/frame_cadence_adapter.cc",
        "patchSetId": 18
      },
      "lineNbr": 799,
      "author": {
        "id": 9741
      },
      "writtenOn": "2023-12-21T02:58:04Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "2cb27fbe_d67245f1",
      "range": {
        "startLine": 799,
        "startChar": 2,
        "endLine": 799,
        "endChar": 22
      },
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "454e7a2b_753202ac",
        "filename": "video/frame_cadence_adapter.cc",
        "patchSetId": 18
      },
      "lineNbr": 939,
      "author": {
        "id": 9515
      },
      "writtenOn": "2023-12-19T12:21:40Z",
      "side": 1,
      "message": "Nit: I\u0027d move this piece to ::Initialize if it only happens from there.",
      "range": {
        "startLine": 938,
        "startChar": 3,
        "endLine": 939,
        "endChar": 80
      },
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "42f5957e_1d0a7f80",
        "filename": "video/frame_cadence_adapter.cc",
        "patchSetId": 18
      },
      "lineNbr": 939,
      "author": {
        "id": 9741
      },
      "writtenOn": "2023-12-21T02:58:04Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "454e7a2b_753202ac",
      "range": {
        "startLine": 938,
        "startChar": 3,
        "endLine": 939,
        "endChar": 80
      },
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ac3f9a9a_b778a37c",
        "filename": "video/frame_cadence_adapter_unittest.cc",
        "patchSetId": 18
      },
      "lineNbr": 643,
      "author": {
        "id": 5142
      },
      "writtenOn": "2023-12-20T14:05:37Z",
      "side": 1,
      "message": "nit: The test might be more readable if we advance by 3 milliseconds here for a total of 30+3 \u003d 33 ms since start of test, since the tick period is 33 ms. (Unless the simulated time requires MORE than 33 ms to have passed, but I think it should tick ON the exact millisecond?)\n\nIf you really want to test the timing, you can go to 32 ms, expect no frames, and then go 1 ms more, and expect frame.",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b0e3acd0_8e5a7bc8",
        "filename": "video/frame_cadence_adapter_unittest.cc",
        "patchSetId": 18
      },
      "lineNbr": 643,
      "author": {
        "id": 9741
      },
      "writtenOn": "2023-12-21T02:58:04Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ac3f9a9a_b778a37c",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e59320b9_3f002a75",
        "filename": "video/frame_cadence_adapter_unittest.cc",
        "patchSetId": 18
      },
      "lineNbr": 655,
      "author": {
        "id": 5142
      },
      "writtenOn": "2023-12-20T14:05:37Z",
      "side": 1,
      "message": "nit: Again, why 36 and not 33 ms?",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fa2114d1_4a7170bc",
        "filename": "video/frame_cadence_adapter_unittest.cc",
        "patchSetId": 18
      },
      "lineNbr": 655,
      "author": {
        "id": 9741
      },
      "writtenOn": "2023-12-21T02:58:04Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e59320b9_3f002a75",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0b11ece4_da4dad64",
        "filename": "video/video_send_stream.cc",
        "patchSetId": 18
      },
      "lineNbr": 126,
      "author": {
        "id": 5634
      },
      "writtenOn": "2023-12-19T21:56:01Z",
      "side": 1,
      "message": "On what circumstance is the FrameCadenceAdapter created on a different thread than the worker queue?\nOn what circumstance is it destroyed on a different thread than the worker queue?",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9419fe5f_397c7c68",
        "filename": "video/video_send_stream.cc",
        "patchSetId": 18
      },
      "lineNbr": 126,
      "author": {
        "id": 9515
      },
      "writtenOn": "2023-12-19T23:53:34Z",
      "side": 1,
      "message": "A. [Never](https://source.chromium.org/chromium/chromium/src/+/main:third_party/webrtc/video/video_stream_encoder.cc;l\u003d711;drc\u003d8e78783dc1f7007bad46d657c9f332614e240fd8;bpv\u003d1;bpt\u003d1).\nB. Always the encode sequence.",
      "parentUuid": "0b11ece4_da4dad64",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ff1939ca_aba66d05",
        "filename": "video/video_send_stream.cc",
        "patchSetId": 18
      },
      "lineNbr": 126,
      "author": {
        "id": 9741
      },
      "writtenOn": "2024-01-04T02:43:46Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "9419fe5f_397c7c68",
      "revId": "d1f639469c0e8c2668d2564ea039b7685551e6f3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    }
  ]
}