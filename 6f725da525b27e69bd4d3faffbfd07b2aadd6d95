{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "42928e5b_0e60feab",
        "filename": "modules/video_coding/timing/jitter_estimator.cc",
        "patchSetId": 7
      },
      "lineNbr": 183,
      "author": {
        "id": 5527
      },
      "writtenOn": "2022-09-13T12:03:38Z",
      "side": 1,
      "message": "You always erase from both, so why not insert in both?",
      "range": {
        "startLine": 178,
        "startChar": 0,
        "endLine": 183,
        "endChar": 5
      },
      "revId": "6f725da525b27e69bd4d3faffbfd07b2aadd6d95",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "855493c4_63ca53cf",
        "filename": "modules/video_coding/timing/jitter_estimator.cc",
        "patchSetId": 7
      },
      "lineNbr": 183,
      "author": {
        "id": 5023
      },
      "writtenOn": "2022-09-13T13:29:49Z",
      "side": 1,
      "message": "I considered adding conditional checks for the `Erase`s too, but it felt a bit verbose since those operations are almost trivial when nothing has been inserted.\n\nAnyway, now that I\u0027m using the `MedianMovingAverage` for the `avg` filter, the possibility for this asymmetry is gone.",
      "parentUuid": "42928e5b_0e60feab",
      "range": {
        "startLine": 178,
        "startChar": 0,
        "endLine": 183,
        "endChar": 5
      },
      "revId": "6f725da525b27e69bd4d3faffbfd07b2aadd6d95",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "19f2ed17_b30bd4f6",
        "filename": "modules/video_coding/timing/jitter_estimator.cc",
        "patchSetId": 7
      },
      "lineNbr": 208,
      "author": {
        "id": 5527
      },
      "writtenOn": "2022-09-13T12:03:38Z",
      "side": 1,
      "message": "GetAvgFrameSizeEstimateBytes?",
      "range": {
        "startLine": 208,
        "startChar": 6,
        "endLine": 208,
        "endChar": 27
      },
      "revId": "6f725da525b27e69bd4d3faffbfd07b2aadd6d95",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a241ce72_27b78a9f",
        "filename": "modules/video_coding/timing/jitter_estimator.cc",
        "patchSetId": 7
      },
      "lineNbr": 208,
      "author": {
        "id": 5023
      },
      "writtenOn": "2022-09-13T13:29:49Z",
      "side": 1,
      "message": "No, here we want the arithmetic average since we are implicitly doing a normal CDF table lookup.\n\nHaving said that, `avg_frame_size_bytes_` is not an arithmetically moving average (FIR), but rather an exponentially moving average (IIR), so maybe my interpretation of a \"normal CDF table lookup\" is not fully correct. Still, I don\u0027t think we should use the median here.",
      "parentUuid": "19f2ed17_b30bd4f6",
      "range": {
        "startLine": 208,
        "startChar": 6,
        "endLine": 208,
        "endChar": 27
      },
      "revId": "6f725da525b27e69bd4d3faffbfd07b2aadd6d95",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9997546b_13567a9b",
        "filename": "modules/video_coding/timing/jitter_estimator.cc",
        "patchSetId": 7
      },
      "lineNbr": 208,
      "author": {
        "id": 5527
      },
      "writtenOn": "2022-09-13T15:52:26Z",
      "side": 1,
      "message": "Maybe I\u0027m wrong in thinking ways of determining avg frame size is kind of arbitrary, so both should work. Anyhow, please add a comment why we use `avg_frame_size_bytes_` here.",
      "parentUuid": "a241ce72_27b78a9f",
      "range": {
        "startLine": 208,
        "startChar": 6,
        "endLine": 208,
        "endChar": 27
      },
      "revId": "6f725da525b27e69bd4d3faffbfd07b2aadd6d95",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0a2331d7_bc2e6152",
        "filename": "modules/video_coding/timing/jitter_estimator.cc",
        "patchSetId": 7
      },
      "lineNbr": 208,
      "author": {
        "id": 5023
      },
      "writtenOn": "2022-09-14T10:17:48Z",
      "side": 1,
      "message": "In terms of being an outlier rejection heuristic, yes, both would work. There\u0027s two reasons I don\u0027t think we should do that, however:\n1) `sample_mean + n*sample_stddev` is a common form in statistics for outlier detection ([example](https://en.wikipedia.org/wiki/68%E2%80%9395%E2%80%9399.7_rule)), whereas I have never seen `sample_median + n*sample_stddev`. At least to me, doing this calculation feels like a \"dimensionality error\", conceptually (but not dimensionally) similar to [this](https://source.chromium.org/chromium/chromium/src/+/main:third_party/webrtc/modules/video_coding/timing/frame_delay_variation_kalman_filter.cc;l\u003d85-86;drc\u003d665875b0d846827d2c3a330f3a7a9e76a884219c). Again, this is caveated by the fact that `avg_frame_size_bytes_` is not a true sample mean though...\n2) Switching to `sample_median + n*sample_stddev` would change the impact of `GetNumStddevSizeOutlier()`, meaning that we would couple the feature in this CL with the already existing `num_stddev_delay_outlier` override. With such a coupling, we would practically have to set both field trials at the same time. We may want to do that anyways, but at least now we are not forced to.\n\nI\u0027ll add a comment about this.",
      "parentUuid": "9997546b_13567a9b",
      "range": {
        "startLine": 208,
        "startChar": 6,
        "endLine": 208,
        "endChar": 27
      },
      "revId": "6f725da525b27e69bd4d3faffbfd07b2aadd6d95",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bc85ab1e_d4d5aaca",
        "filename": "modules/video_coding/timing/jitter_estimator.cc",
        "patchSetId": 7
      },
      "lineNbr": 268,
      "author": {
        "id": 5527
      },
      "writtenOn": "2022-09-13T12:03:38Z",
      "side": 1,
      "message": "My preference for easier to understand code: When you want to use the \"average frame size\" regardless of how you calculate it, check the condition and pick which source to use where you use it. For example:\n\n      double avg_frame_size_bytes \u003d config_.avg_frame_size_median ?\n          avg_frame_size_median_bytes_.GetPercentileValue() : avg_frame_size_bytes_\n\n      bool size_is_positive_outlier \u003d\n          frame_size.bytes() \u003e\n          avg_frame_size_bytes +\n              GetNumStddevSizeOutlier() * sqrt(var_frame_size_bytes2_);\n\nRight now `avg_frame_size_bytes_` is like a global variable and you have to read the rest of the code to understand this function.\n\nSame is true for `GetMaxFrameSizeEstimateBytes` ofc...",
      "range": {
        "startLine": 268,
        "startChar": 2,
        "endLine": 268,
        "endChar": 31
      },
      "revId": "6f725da525b27e69bd4d3faffbfd07b2aadd6d95",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "769b4d2a_95969c12",
        "filename": "modules/video_coding/timing/jitter_estimator.cc",
        "patchSetId": 7
      },
      "lineNbr": 268,
      "author": {
        "id": 5023
      },
      "writtenOn": "2022-09-13T13:29:49Z",
      "side": 1,
      "message": "Yeah, I don\u0027t disagree about `avg_frame_size_bytes_` being a global whose purpose is not directly clear. (See prior comment where we still need to use it.)\n\nI put the conditional in this function to make it symmetric to how `GetMaxFrameSizeEstimateBytes` is implemented. However, `GetAvgFrameSizeEstimateBytes` is only called in a single spot, so I\u0027ll move the check over there and remove the function.",
      "parentUuid": "bc85ab1e_d4d5aaca",
      "range": {
        "startLine": 268,
        "startChar": 2,
        "endLine": 268,
        "endChar": 31
      },
      "revId": "6f725da525b27e69bd4d3faffbfd07b2aadd6d95",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f5ff81f8_0c77ac62",
        "filename": "modules/video_coding/timing/jitter_estimator.h",
        "patchSetId": 7
      },
      "lineNbr": 178,
      "author": {
        "id": 5527
      },
      "writtenOn": "2022-09-13T12:03:38Z",
      "side": 1,
      "message": "There is a MediaFilter class, but eh...",
      "range": {
        "startLine": 178,
        "startChar": 2,
        "endLine": 178,
        "endChar": 18
      },
      "revId": "6f725da525b27e69bd4d3faffbfd07b2aadd6d95",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "181eb4ea_c0981b17",
        "filename": "modules/video_coding/timing/jitter_estimator.h",
        "patchSetId": 7
      },
      "lineNbr": 178,
      "author": {
        "id": 5023
      },
      "writtenOn": "2022-09-13T13:29:49Z",
      "side": 1,
      "message": "Ah, I hadn\u0027t seen that one! I\u0027ll move the \"avg\" to that right away, and make a TODO to make it configurable to take a percentile parameter. I can do that simplification next week.",
      "parentUuid": "f5ff81f8_0c77ac62",
      "range": {
        "startLine": 178,
        "startChar": 2,
        "endLine": 178,
        "endChar": 18
      },
      "revId": "6f725da525b27e69bd4d3faffbfd07b2aadd6d95",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "da25845a_a097bf48",
        "filename": "modules/video_coding/timing/jitter_estimator.h",
        "patchSetId": 7
      },
      "lineNbr": 178,
      "author": {
        "id": 5023
      },
      "writtenOn": "2022-09-13T13:45:36Z",
      "side": 1,
      "message": "Something like this: https://webrtc-review.googlesource.com/c/src/+/275311. Still needs tests etc.",
      "parentUuid": "181eb4ea_c0981b17",
      "range": {
        "startLine": 178,
        "startChar": 2,
        "endLine": 178,
        "endChar": 18
      },
      "revId": "6f725da525b27e69bd4d3faffbfd07b2aadd6d95",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "744b0687_2386a404",
        "filename": "modules/video_coding/timing/jitter_estimator.h",
        "patchSetId": 7
      },
      "lineNbr": 178,
      "author": {
        "id": 5527
      },
      "writtenOn": "2022-09-13T15:52:26Z",
      "side": 1,
      "message": "Nice!",
      "parentUuid": "da25845a_a097bf48",
      "range": {
        "startLine": 178,
        "startChar": 2,
        "endLine": 178,
        "endChar": 18
      },
      "revId": "6f725da525b27e69bd4d3faffbfd07b2aadd6d95",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    }
  ]
}