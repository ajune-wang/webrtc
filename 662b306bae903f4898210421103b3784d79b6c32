{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "937a7d18_af18e4de",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 6720
      },
      "writtenOn": "2021-03-12T15:05:27Z",
      "side": 1,
      "message": "One drive-by concern regarding the SetAlive() method (which was recently added).\nThere might be subtle side effects that we could introduce by using it.",
      "revId": "662b306bae903f4898210421103b3784d79b6c32",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c04382cd_0dc37e12",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 5234
      },
      "writtenOn": "2021-03-12T15:39:28Z",
      "side": 1,
      "message": "I appreciate advice on how to replace the flag in a thread safe (but preferably lockless) way.",
      "revId": "662b306bae903f4898210421103b3784d79b6c32",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "142f8c15_f5e59b5c",
        "filename": "sdk/android/src/jni/android_network_monitor.cc",
        "patchSetId": 7
      },
      "lineNbr": 253,
      "author": {
        "id": 6720
      },
      "writtenOn": "2021-03-12T15:05:27Z",
      "side": 1,
      "message": "This could have side effects. It\u0027s probably better to create a new flag. There might be pending operations for the previous start/stop period we might want to not overlap with the state change",
      "revId": "662b306bae903f4898210421103b3784d79b6c32",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "10b758de_915726e4",
        "filename": "sdk/android/src/jni/android_network_monitor.cc",
        "patchSetId": 7
      },
      "lineNbr": 253,
      "author": {
        "id": 5234
      },
      "writtenOn": "2021-03-12T15:39:28Z",
      "side": 1,
      "message": "I considered creating a new flag, and I think it was Danil that pointed out we then get a potential data race on safety_flag_ pointer. We replace the pointer here, on the network thread, and the pointer is read by some arbitrary java thread, where they post tasks to the network thread.\n\nIt would hope that Java_NetworkMonitor_stopMonitoring guarantees that we will get no concurrent reads on the java thread, but I we\u0027d at least need to tell the compiler about that, and maybe use some memory barrier.\n\nWhat would you suggest?",
      "parentUuid": "142f8c15_f5e59b5c",
      "revId": "662b306bae903f4898210421103b3784d79b6c32",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c03832c3_bb756c95",
        "filename": "sdk/android/src/jni/android_network_monitor.cc",
        "patchSetId": 7
      },
      "lineNbr": 253,
      "author": {
        "id": 5508
      },
      "writtenOn": "2021-03-12T16:15:47Z",
      "side": 1,
      "message": "The reference counting for the pointer itself, is thread safe.\nIt\u0027s the |alive()| flag that must be set/checked on the same thread.\n\nIf the member variable is created/cleared in a context (thread/tq) when we know that there\u0027s no chance of a race (pre start / post stop), then we don\u0027t have to worry about pending tasks for that same context that may hold a reference to the object that we\u0027re about to mark as \u0027not alive\u0027.  They\u0027ll still hold a reference, they won\u0027t actually run, but they won\u0027t uaf either since they\u0027re not using the class member variable to check the flag.",
      "parentUuid": "10b758de_915726e4",
      "revId": "662b306bae903f4898210421103b3784d79b6c32",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a5027cb9_142a17c6",
        "filename": "sdk/android/src/jni/android_network_monitor.cc",
        "patchSetId": 7
      },
      "lineNbr": 253,
      "author": {
        "id": 5234
      },
      "writtenOn": "2021-03-15T15:42:17Z",
      "side": 1,
      "message": "Trying this out as cl https://webrtc-review.googlesource.com/c/src/+/211863",
      "parentUuid": "c03832c3_bb756c95",
      "revId": "662b306bae903f4898210421103b3784d79b6c32",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    }
  ]
}