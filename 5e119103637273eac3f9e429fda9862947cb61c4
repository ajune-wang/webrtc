{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "1bbbb556_87389440",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 5527
      },
      "writtenOn": "2020-10-14T11:37:52Z",
      "side": 1,
      "message": "Thank you for contributing to WebRTC :)\n\nI don\u0027t understand how the bug trigger exactly, could you please add a unit test to packet_buffer_unittest.cc to show how an incomplete frame would be handed out?",
      "revId": "5e119103637273eac3f9e429fda9862947cb61c4",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d4869ee2_5b16eadd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 14471
      },
      "writtenOn": "2020-10-14T12:51:35Z",
      "side": 1,
      "message": "Thanks for your reply:\nwhen the I frame use Multi Slice coding,packet mode is stap-a, for example there six slice 1,2,3,4,5,6 \nthe rtp packet may use 1,2 for first stap-a seq number 1000\n3,4 for second seq number 1001\n5,6 for third seq number 1002\nthus the I frame seq number is 1000   1002  1003\neach packet is stap-a\n\nwhen 1002 lost, 1003 is arrived, buffer_[1003]-\u003eis_first_packet_in_frame() \u003d true,buffer_[1003]-\u003eis_last_packet_in_frame() \u003d true also, buffer_[1002] \u003d\u003d nullptr,so it break,due to this is key frames,the incomplete would be handed out",
      "parentUuid": "1bbbb556_87389440",
      "revId": "5e119103637273eac3f9e429fda9862947cb61c4",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2c28d25e_c0d0c1d6",
        "filename": "modules/video_coding/packet_buffer.cc",
        "patchSetId": 3
      },
      "lineNbr": 333,
      "author": {
        "id": 5527
      },
      "writtenOn": "2020-10-14T15:15:34Z",
      "side": 1,
      "message": "Given that current_index is start_index before it was decremented, it means that we already used current_index to look into the buffer_, so this is always true right?",
      "range": {
        "startLine": 333,
        "startChar": 16,
        "endLine": 333,
        "endChar": 49
      },
      "revId": "5e119103637273eac3f9e429fda9862947cb61c4",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "70443b58_5aafd5a6",
        "filename": "modules/video_coding/packet_buffer.cc",
        "patchSetId": 3
      },
      "lineNbr": 333,
      "author": {
        "id": 14471
      },
      "writtenOn": "2020-10-15T02:37:36Z",
      "side": 1,
      "message": "yes,this is always true,can remove this condition.",
      "parentUuid": "2c28d25e_c0d0c1d6",
      "range": {
        "startLine": 333,
        "startChar": 16,
        "endLine": 333,
        "endChar": 49
      },
      "revId": "5e119103637273eac3f9e429fda9862947cb61c4",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c31e4730_354637fa",
        "filename": "modules/video_coding/packet_buffer.cc",
        "patchSetId": 3
      },
      "lineNbr": 334,
      "author": {
        "id": 5527
      },
      "writtenOn": "2020-10-14T11:37:52Z",
      "side": 1,
      "message": "You can\u0027t rely on |is_first_packet_in_frame| to return the correct value for H264.",
      "range": {
        "startLine": 334,
        "startChar": 42,
        "endLine": 334,
        "endChar": 66
      },
      "revId": "5e119103637273eac3f9e429fda9862947cb61c4",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "20d793e0_4c2b5711",
        "filename": "modules/video_coding/packet_buffer.cc",
        "patchSetId": 3
      },
      "lineNbr": 334,
      "author": {
        "id": 14471
      },
      "writtenOn": "2020-10-14T12:51:35Z",
      "side": 1,
      "message": "yes,you are right,buf if is_first_packet_in_frame is false,it must not be the begin of the packet,is right?",
      "parentUuid": "c31e4730_354637fa",
      "range": {
        "startLine": 334,
        "startChar": 42,
        "endLine": 334,
        "endChar": 66
      },
      "revId": "5e119103637273eac3f9e429fda9862947cb61c4",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e32ca155_01443fac",
        "filename": "modules/video_coding/packet_buffer.cc",
        "patchSetId": 3
      },
      "lineNbr": 334,
      "author": {
        "id": 5527
      },
      "writtenOn": "2020-10-14T15:15:34Z",
      "side": 1,
      "message": "If it returns false then I think you can trust it to be false, but I\u0027m not sure. The problem is  that it might return true when it in fact should be false.",
      "parentUuid": "20d793e0_4c2b5711",
      "range": {
        "startLine": 334,
        "startChar": 42,
        "endLine": 334,
        "endChar": 66
      },
      "revId": "5e119103637273eac3f9e429fda9862947cb61c4",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0935c706_4e512307",
        "filename": "modules/video_coding/packet_buffer.cc",
        "patchSetId": 3
      },
      "lineNbr": 334,
      "author": {
        "id": 14471
      },
      "writtenOn": "2020-10-15T02:37:36Z",
      "side": 1,
      "message": "I known that, fu-a mode if return true that means it begin of the packet, stap-a mode return true,it may should be false in fact. I use the !is_first_packet_in_frame() so that judgment it must not the begin of the packet,so it is a incomplete key frames,I think this is right,do you think so?",
      "parentUuid": "e32ca155_01443fac",
      "range": {
        "startLine": 334,
        "startChar": 42,
        "endLine": 334,
        "endChar": 66
      },
      "revId": "5e119103637273eac3f9e429fda9862947cb61c4",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d4bab41e_763efc69",
        "filename": "modules/video_coding/packet_buffer.cc",
        "patchSetId": 3
      },
      "lineNbr": 334,
      "author": {
        "id": 14471
      },
      "writtenOn": "2020-10-15T03:37:07Z",
      "side": 1,
      "message": "it be the same with the singleNalu mode,a multi slice can use lots of singleNalu packets,echo singleNalu packetes is_first_packet_in_frame() \u003d true,but is_last_packet \u003d rtp_packet.Marker",
      "parentUuid": "0935c706_4e512307",
      "range": {
        "startLine": 334,
        "startChar": 42,
        "endLine": 334,
        "endChar": 66
      },
      "revId": "5e119103637273eac3f9e429fda9862947cb61c4",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "38a6107c_2d98c952",
        "filename": "modules/video_coding/packet_buffer.cc",
        "patchSetId": 3
      },
      "lineNbr": 335,
      "author": {
        "id": 5527
      },
      "writtenOn": "2020-10-14T15:15:34Z",
      "side": 1,
      "message": "When receiving a keyframe we can\u0027t consider missing packets, RTP is not guaranteed delivery.\n\nWhat if 100 packets are lost, and we decide to restart the stream with an IDR, there will be a big gap and a lot of packets in missing_packets_.",
      "range": {
        "startLine": 335,
        "startChar": 17,
        "endLine": 335,
        "endChar": 42
      },
      "revId": "5e119103637273eac3f9e429fda9862947cb61c4",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a0eed848_a13e77c2",
        "filename": "modules/video_coding/packet_buffer.cc",
        "patchSetId": 3
      },
      "lineNbr": 335,
      "author": {
        "id": 14471
      },
      "writtenOn": "2020-10-15T02:37:36Z",
      "side": 1,
      "message": "this condition has two reasons:\n1. if it not received p frame packets before,it means that the first packet is key frame, thus buffer_[start_index] is nullptr,and if missing_packets_ is empty,it is a complete key frame.\n2. if it received p frame pakcets before,buffer_[start_index] is nullptr, missing_packet_ not be empty,it means that:\n2.1 this key frame is incomplete,it shoule set is_incomplete_frame \u003d true\n2.2 the p frame last seq number is lost(if not,buffer_[start_index]-\u003etimestamp !\u003d frame_timestamp should be true). this situation is inevitable,because we can\u0027t judment whether this lost packet is belong to the key frame in stap-a mode. so I think this key frame is incomplete,if it has a big gap,it may have no frames to handed out, do you have any idea?\n\nthus I use !missing_packets_.empty() to set is_incomplete_frame \u003d true,it has the same effect with missing_packets_.upper_bound(current_index) !\u003d missing_packets_.begin()",
      "parentUuid": "38a6107c_2d98c952",
      "range": {
        "startLine": 335,
        "startChar": 17,
        "endLine": 335,
        "endChar": 42
      },
      "revId": "5e119103637273eac3f9e429fda9862947cb61c4",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cd663c81_39b2c870",
        "filename": "modules/video_coding/packet_buffer.cc",
        "patchSetId": 3
      },
      "lineNbr": 335,
      "author": {
        "id": 5527
      },
      "writtenOn": "2020-10-15T13:48:05Z",
      "side": 1,
      "message": "Sorry, I don\u0027t quite understand.\n\nLets say we have small frames, so one RTP packet \u003d one frame.\n\nThe way I see it:\n\npacket 100: p frame\npacket 101: \u003clost\u003e\npacket 102: i frame\n\nnow !missing_packets_.empty() will evaluate to true, so now you say that the i frame in 102 is incomplete.",
      "parentUuid": "a0eed848_a13e77c2",
      "range": {
        "startLine": 335,
        "startChar": 17,
        "endLine": 335,
        "endChar": 42
      },
      "revId": "5e119103637273eac3f9e429fda9862947cb61c4",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "34617963_c2a8981e",
        "filename": "modules/video_coding/packet_buffer.cc",
        "patchSetId": 3
      },
      "lineNbr": 335,
      "author": {
        "id": 14471
      },
      "writtenOn": "2020-10-16T02:07:04Z",
      "side": 1,
      "message": "because 101 is lost,buffer_[101] \u003d nullptr,we don\u0027t know 101 packet whether is belong to 102(in singleNalu or stap-a mode,the frame may has lots of singleNalu or stap-a in fact),we just use buffer_[101]-\u003etimestamp !\u003d buffer_[102]-\u003etimestamp so that there is a different frames, so this a problem.",
      "parentUuid": "cd663c81_39b2c870",
      "range": {
        "startLine": 335,
        "startChar": 17,
        "endLine": 335,
        "endChar": 42
      },
      "revId": "5e119103637273eac3f9e429fda9862947cb61c4",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c58a8fdd_b3fa957c",
        "filename": "modules/video_coding/packet_buffer.cc",
        "patchSetId": 3
      },
      "lineNbr": 335,
      "author": {
        "id": 14471
      },
      "writtenOn": "2020-10-20T12:35:21Z",
      "side": 1,
      "message": "hello philip,have you any idea? I think it would rather misjudgment than incomplete key frames, because this experience is too bad.",
      "parentUuid": "34617963_c2a8981e",
      "range": {
        "startLine": 335,
        "startChar": 17,
        "endLine": 335,
        "endChar": 42
      },
      "revId": "5e119103637273eac3f9e429fda9862947cb61c4",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e805f4d0_6589e921",
        "filename": "modules/video_coding/packet_buffer.cc",
        "patchSetId": 3
      },
      "lineNbr": 379,
      "author": {
        "id": 5527
      },
      "writtenOn": "2020-10-14T11:37:52Z",
      "side": 1,
      "message": "I feel like we are trying to duplicate logic here. We already track missing packets to avoid handing out incomplete H264 frames.",
      "range": {
        "startLine": 377,
        "startChar": 12,
        "endLine": 379,
        "endChar": 64
      },
      "revId": "5e119103637273eac3f9e429fda9862947cb61c4",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "91806acc_fe866ec1",
        "filename": "modules/video_coding/packet_buffer.cc",
        "patchSetId": 3
      },
      "lineNbr": 379,
      "author": {
        "id": 14471
      },
      "writtenOn": "2020-10-14T12:51:35Z",
      "side": 1,
      "message": "here we only judgment the p frames before, the incomplete key frames skiped.",
      "parentUuid": "e805f4d0_6589e921",
      "range": {
        "startLine": 377,
        "startChar": 12,
        "endLine": 379,
        "endChar": 64
      },
      "revId": "5e119103637273eac3f9e429fda9862947cb61c4",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d4b661ea_dd7a54da",
        "filename": "modules/video_coding/packet_buffer.cc",
        "patchSetId": 3
      },
      "lineNbr": 379,
      "author": {
        "id": 5527
      },
      "writtenOn": "2020-10-14T15:15:34Z",
      "side": 1,
      "message": "Right, now I get it.",
      "parentUuid": "91806acc_fe866ec1",
      "range": {
        "startLine": 377,
        "startChar": 12,
        "endLine": 379,
        "endChar": 64
      },
      "revId": "5e119103637273eac3f9e429fda9862947cb61c4",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "eec48762_695bfe0c",
        "filename": "modules/video_coding/packet_buffer.cc",
        "patchSetId": 3
      },
      "lineNbr": 379,
      "author": {
        "id": 14471
      },
      "writtenOn": "2020-10-15T02:37:36Z",
      "side": 1,
      "message": "thanks agree with me!",
      "parentUuid": "d4b661ea_dd7a54da",
      "range": {
        "startLine": 377,
        "startChar": 12,
        "endLine": 379,
        "endChar": 64
      },
      "revId": "5e119103637273eac3f9e429fda9862947cb61c4",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    }
  ]
}