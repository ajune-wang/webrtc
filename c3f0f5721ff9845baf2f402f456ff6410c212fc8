{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "31b0be4c_bf16a49c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 7529
      },
      "writtenOn": "2023-08-15T21:49:32Z",
      "side": 1,
      "message": "Writing a test for this case is a bit tricky since there\u0027s no API for set_use_rtx(false) and since this is not an officially supported use case, but perhaps we should add one anyway - Or some field trial.",
      "revId": "c3f0f5721ff9845baf2f402f456ff6410c212fc8",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "25067e1e_60852575",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 5634
      },
      "writtenOn": "2023-08-16T04:59:31Z",
      "side": 1,
      "message": "can you add a test?",
      "revId": "c3f0f5721ff9845baf2f402f456ff6410c212fc8",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7a431fcc_d4f3dc64",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 5634
      },
      "writtenOn": "2023-08-16T06:26:21Z",
      "side": 1,
      "message": "An unit test should be reasonable to write - just (??) inject (??) a client that hardcodes use_rtx to false and call GetRtpSenderCapabilities (and ReceiverCapabilities for good meaure), and check that RTX codecs don\u0027t occur in the output.\n\n(would be nice to have a test that checks the use_rtx\u003dtrue case too)",
      "parentUuid": "25067e1e_60852575",
      "revId": "c3f0f5721ff9845baf2f402f456ff6410c212fc8",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3630b0c8_63a85fd5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 7529
      },
      "writtenOn": "2023-08-16T21:07:35Z",
      "side": 1,
      "message": "Updating the CL with a test. The test case is not particularly pretty since it needs to duplicate quite a bit of the initialization logic from create_peerconnection_factory.cc in order to inject a custom ConnectionContext.\n\nAn alternative approach that would simplify the test is to expose disable_rtx as a parameter in the PeerConnectionFactory::Options struct. WDYT?",
      "parentUuid": "7a431fcc_d4f3dc64",
      "revId": "c3f0f5721ff9845baf2f402f456ff6410c212fc8",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "945aa92c_8e0473c2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 5634
      },
      "writtenOn": "2023-08-16T21:21:02Z",
      "side": 1,
      "message": "Adding use_rtx with a default value of true (I don\u0027t want to have disable_rtx in one place and use_rtx in another) to the PeerConnectionFactory::Options struct sounds good to me.\n\nI found this comment: \n\n  // Note: There is lots of code that wants to know whether or not we\n  // use RTX, but so far, no code has been found that sets it to false.\n  // Kept in the API in order to ease introduction if we want to resurrect\n  // the functionality.\n  bool use_rtx() { return true; }\n  \nInteresting that you found code that forced it false!\n  \nA custom ConnectionContext object seems like a Bad Idea architecturally to me; this is very much an implementation detail, not something we want to be injected from outside. (I ripped it out of PeerConnectionFactory a year or two back, in order to split between the factory (only accessed when creating a PC) and the context (accessed throughout the lifetime of the PC).",
      "parentUuid": "3630b0c8_63a85fd5",
      "revId": "c3f0f5721ff9845baf2f402f456ff6410c212fc8",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5f2cd56e_2f6adf20",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 7529
      },
      "writtenOn": "2023-08-16T21:26:22Z",
      "side": 1,
      "message": "Sounds good, I will add a param to PeerConnectionFactory::Options instead.\n\n\u003e Interesting that you found code that forced it false!\n\nTo be clear, this was the case only in Meta-internal code. In the public repo there are no use cases I\u0027m aware of that force it to false.",
      "parentUuid": "945aa92c_8e0473c2",
      "revId": "c3f0f5721ff9845baf2f402f456ff6410c212fc8",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7258b0ae_e187ab54",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 7529
      },
      "writtenOn": "2023-08-16T22:05:21Z",
      "side": 1,
      "message": "Looking more at it, using PeerConnectionFactoryInterface::Options will not work. Several other classes (RtpTransceiver, MediaSessionDescriptionFactory) also read use_rtx() from ConnectionContext without having access to the PCF options. And ConnectionContext is constructed in PeerConnectionFactory::Create, before we can call PeerConnectionFactory::SetOptions.\n\nSo if we don\u0027t allow ConnectionContext to have a mutable set_use_rtx method, we\u0027re forced to pass down this bool param to the PeerConnectionFactory::Create method. But it doesn\u0027t really fit inside the PeerConnectionFactoryDependencies struct since it\u0027s a config option, not a dependency, so it ends up looking not very elegant.\n\nAlternatively, I can add field trial...",
      "parentUuid": "5f2cd56e_2f6adf20",
      "revId": "c3f0f5721ff9845baf2f402f456ff6410c212fc8",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1a2ddcbd_be98d0e0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 5634
      },
      "writtenOn": "2023-08-17T04:56:37Z",
      "side": 1,
      "message": "Misspoke!\n\nI was thinking of PeerConnectionFactoryDependencies, which is the global control for construction of contexts.\n\nQuestion: Do we ever want a situation where some PeerConnections have RTX and other PeerConnections (constructed from the same factory) don\u0027t have it?\n\nDo we ever want a PeerConnection to be able to change its use_rtx over time?\n\n(It\u0027s in theory possible to have multiple factories with different ConnectionContexts, but that\u0027s a config that hasn\u0027t been exercised in production AFAIK, so there might be dragons here.)\n\nThe net-net seems to be that varying use_rtx is a new feature, and we should design it before bothering to fix the present dependency on it always being true.",
      "parentUuid": "7258b0ae_e187ab54",
      "revId": "c3f0f5721ff9845baf2f402f456ff6410c212fc8",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "377d9802_0545a7ae",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 7529
      },
      "writtenOn": "2023-08-17T16:27:47Z",
      "side": 1,
      "message": "\u003e Question: Do we ever want a situation where some PeerConnections have RTX and other PeerConnections (constructed from the same factory) don\u0027t have it?\n\u003e Do we ever want a PeerConnection to be able to change its use_rtx over time?\n\nBoth of those use cases should already be possible via the setCodecPreferences API. From the spec: \"This method allows applications to disable the negotiation of specific codecs (including RTX/RED/FEC).\". Separately from this change, I can test the API and see if I find any issues with controlling RTX in that way.\n\nSo for the purposes of unit testing this change, having a const config on the entire PeerConnectionFactory would be adequate. \n\nThough given the existence of setCodecPreferences, leaving ConnectionContext::use_rtx() as something not controllable from outside would also be reasonable. But I\u0027d still like the 1-line bug fixed - even if not testable, it is obviously more correct than the current code.",
      "parentUuid": "1a2ddcbd_be98d0e0",
      "revId": "c3f0f5721ff9845baf2f402f456ff6410c212fc8",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c3976093_a6884d93",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 5634
      },
      "writtenOn": "2023-08-22T08:07:21Z",
      "side": 1,
      "message": "Should have deleted use_rtx() when I had the chance :-)\n\nI agree that the CL fixes an inconsistency, and is now tested (albeit awkwardly), so I think we should submit it. Separately, if we find that you can get done what you want to get done by manipulating setCodecPreferences, I think we should delete use_rtx entirely. I\u0027ll file a bug on that.",
      "parentUuid": "377d9802_0545a7ae",
      "revId": "c3f0f5721ff9845baf2f402f456ff6410c212fc8",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f98fc6c2_3e00c1b2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 7529
      },
      "writtenOn": "2023-08-22T16:28:14Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "c3976093_a6884d93",
      "revId": "c3f0f5721ff9845baf2f402f456ff6410c212fc8",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    }
  ]
}