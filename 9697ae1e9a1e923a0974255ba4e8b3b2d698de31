{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "da170bdf_29b6cc7d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 8046
      },
      "writtenOn": "2020-10-23T09:03:48Z",
      "side": 1,
      "message": "Hi,\n\nmay I friendly ask you to look into this? You shouldn\u0027t need to re-review 99% of the code as it hasn\u0027t change since this was merged two times already. I just changed the way we keep XdgDesktopPortalBase alive, which is explained in the comment above and I raised a question there to which I don\u0027t know the answer yet.",
      "revId": "9697ae1e9a1e923a0974255ba4e8b3b2d698de31",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8fedacf3_b52a071e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 5087
      },
      "writtenOn": "2020-10-23T09:40:34Z",
      "side": 1,
      "message": "From a build config point of view I have one comment (see below).\n\nI think the review should come from wez@ according to comments on: https://webrtc-review.googlesource.com/c/src/+/160649.",
      "revId": "9697ae1e9a1e923a0974255ba4e8b3b2d698de31",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "59bd7a2f_981d4266",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 5064
      },
      "writtenOn": "2020-10-23T14:26:12Z",
      "side": 1,
      "message": "Hi Jan,\n\nI\u0027m sorry, but I still don\u0027t understand how this CL relates to the goals described in the CL description. ðŸ˜ž\n\nIIUC the goal is to use the XDG desktop media picker, rather than showing the Chrome (or other WebRTC embedder) one and then the XDG one?\n\nIf that is correct then why do we need to have a single XdgDesktopPortal instance, with requests identified by Id?  Can\u0027t we just have the DesktopMediaPicker instance returned by the DesktopMediaPickerFactory::CreatePicker() call own an XdgDesktopPortal instance?  CreatePicker() can construct the XdgDesktopPortal and \"start\" the request, and then stop the request when the DesktopMediaPicker goes out of scope?\n",
      "revId": "9697ae1e9a1e923a0974255ba4e8b3b2d698de31",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "393549ef_90a32d7b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 8046
      },
      "writtenOn": "2020-10-23T15:31:17Z",
      "side": 1,
      "message": "My fault. The description hasn\u0027t been updated for a while and the current change description didn\u0027t correspond to the actual changes.\n\nLet me explain this change more deeply.\n\nCurrent situation\n------------------\n1) Chromium wants to share a screen/window and a preview dialog is created.\n2) In case of Linux Wayland session, two PipeWire capturers (ScreenCapturer and WindowCapturer) are created making call to xdg-desktop-portal, each will present a dialog to user letting him to choose a screen or a window. This is because on Wayland nobody can access screen content without asking the user first. User selects what he wants to share and this content can be visible now in the Chrome preview dialog.\n3) User confirms the selection again in the preview dialog and the PipeWire capturer is destroyed with the preview dialog.\n4) A new PipeWire capturer is created, which again creates a new xdg-desktop-portal request which means another portal dialog. Once users selects what he wants to share then he finally gets the requested content on the web page itself.\n\nWe want to avoid 4) as it is not necessary to show the portal dialog again.\n\nFor this reason in this request I made XdgDesktopPortalBase class separated from the capturer so it doesn\u0027t get destroyed and I made it as singleton (before when you rejected the change it was stored within DesktopCaptureOptions on side of Chromium). I added API to pass an ID so calls made by XdgDesktopPortalBase can be re-used. When ID is not specified, it should behave as it behaves now (portal request will be closed automatically), because we don\u0027t want to break browsers who don\u0027t use advantage of this new API (for example Firefox). It is also necessary that the ID is specified by the browser, because usually two capturers are created simultaneously (one for screen sharing and one for window sharing) and not using same ID for both, it would again lead to two portal requests.\n\nWith this change and the one for Chromium it will be this way:\n---------------------------------------------------------------\n1) Chromium wants to share a screen/window and a preview dialog is created.\n2) Using same ID for both capturers created by the preview dialog we will make only one request which means only one dialog where user selects what he allows to be shared in the portal dialog.\n3) User then selects content to be shared and opened on the web page in the preview dialog. Now the preview dialog will be destroyed also with the capturer, but this time we keep XdgDesktopPortalBase alive to be re-used.\n4) With XdgDesktopPortalBase having the previous portal call opened, we can pass ID to this request and obtain it again. This will avoid another portal call (dialog) and we can immediataly share our content on the web page itself.",
      "parentUuid": "59bd7a2f_981d4266",
      "revId": "9697ae1e9a1e923a0974255ba4e8b3b2d698de31",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3d441fab_02dd6557",
        "filename": "modules/desktop_capture/BUILD.gn",
        "patchSetId": 3
      },
      "lineNbr": 544,
      "author": {
        "id": 5087
      },
      "writtenOn": "2020-10-23T09:40:34Z",
      "side": 1,
      "message": "I forgot if we need a \"\u0026\u0026 !is_chromecast\" here (see https://webrtc-review.googlesource.com/c/src/+/187348), or if this new version of the CL takes that into account in another way.\n\nAside from that, from a build system point of view this seems fine since lines 79 and 148 are taking into account previous forward fixes.",
      "range": {
        "startLine": 544,
        "startChar": 22,
        "endLine": 544,
        "endChar": 23
      },
      "revId": "9697ae1e9a1e923a0974255ba4e8b3b2d698de31",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    }
  ]
}