{
  "comments": [
    {
      "key": {
        "uuid": "655c3c21_01902d95",
        "filename": "test/pc/e2e/analyzer/video/quality_analyzing_video_decoder.cc",
        "patchSetId": 3
      },
      "lineNbr": 82,
      "author": {
        "id": 5117
      },
      "writtenOn": "2019-01-15T14:46:24Z",
      "side": 1,
      "message": "just replace with |this|\nremove analyzing_callback_ member.",
      "range": {
        "startLine": 82,
        "startChar": 51,
        "endLine": 82,
        "endChar": 76
      },
      "revId": "98982868bb9f08c61cf0ae037987f0d4e30ea7d3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cd4cf9eb_5b732b90",
        "filename": "test/pc/e2e/analyzer/video/quality_analyzing_video_decoder.cc",
        "patchSetId": 3
      },
      "lineNbr": 82,
      "author": {
        "id": 6337
      },
      "writtenOn": "2019-01-16T09:48:06Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "655c3c21_01902d95",
      "range": {
        "startLine": 82,
        "startChar": 51,
        "endLine": 82,
        "endChar": 76
      },
      "revId": "98982868bb9f08c61cf0ae037987f0d4e30ea7d3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "68630d7e_444cdab0",
        "filename": "test/pc/e2e/analyzer/video/quality_analyzing_video_decoder.cc",
        "patchSetId": 3
      },
      "lineNbr": 87,
      "author": {
        "id": 5117
      },
      "writtenOn": "2019-01-15T14:46:24Z",
      "side": 1,
      "message": "Nit: maybe clear timestamp_to_frame_id_ and decoding_images_ here",
      "revId": "98982868bb9f08c61cf0ae037987f0d4e30ea7d3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "990e38e7_680796a5",
        "filename": "test/pc/e2e/analyzer/video/quality_analyzing_video_decoder.cc",
        "patchSetId": 3
      },
      "lineNbr": 87,
      "author": {
        "id": 6337
      },
      "writtenOn": "2019-01-16T09:48:06Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "68630d7e_444cdab0",
      "revId": "98982868bb9f08c61cf0ae037987f0d4e30ea7d3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1518eac2_e8b886da",
        "filename": "test/pc/e2e/analyzer/video/quality_analyzing_video_decoder.cc",
        "patchSetId": 3
      },
      "lineNbr": 96,
      "author": {
        "id": 5117
      },
      "writtenOn": "2019-01-15T14:46:24Z",
      "side": 1,
      "message": "Nit:\nBetter idea may be to return here something like \"AnalyzingDecoder(\"+delegate_-\u003eImplementationName()+\")\". To optimize you better generate this string in the constructor and return .c_str() member of it here.",
      "revId": "98982868bb9f08c61cf0ae037987f0d4e30ea7d3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6bd2258b_a9b89203",
        "filename": "test/pc/e2e/analyzer/video/quality_analyzing_video_decoder.cc",
        "patchSetId": 3
      },
      "lineNbr": 96,
      "author": {
        "id": 6337
      },
      "writtenOn": "2019-01-16T09:48:06Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "1518eac2_e8b886da",
      "revId": "98982868bb9f08c61cf0ae037987f0d4e30ea7d3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c1a2efc6_91b4dc38",
        "filename": "test/pc/e2e/analyzer/video/quality_analyzing_video_decoder.cc",
        "patchSetId": 3
      },
      "lineNbr": 143,
      "author": {
        "id": 5117
      },
      "writtenOn": "2019-01-15T14:46:24Z",
      "side": 1,
      "message": "This really irritates me. I can\u0027t find the guideline right now, but I think using a member lock from another class is a bad practice.\n\nEither make QualityAnalyzingVideoDecoder inherit DecodedImageCallback and merge two classes.\n\nOr add SetCallback() method to QualityAnalyzingVideoDecoder::DecoderCallback, move delegate_callback field to DecoderCallback class and add a lock there. Also, move private DecoderCallback::OnFrameDecoded() to QualityAnalyzingVideoDecoder, so it could access all the members directly. Alternatively, you can move all the state into DecoderCallback, and call some new method on callback class from QualityAnalyzingVideoDecoder::Decode() to populate the maps.\n\n\nSee, e.g. here: https://cs.chromium.org/chromium/src/third_party/webrtc/modules/video_coding/generic_encoder.cc\n\nGenericDecoder passes all the required information to callback instance before decoding is done by delegate decoder. Then callback has internal lock, and does what it needs with the state.",
      "range": {
        "startLine": 143,
        "startChar": 22,
        "endLine": 143,
        "endChar": 38
      },
      "revId": "98982868bb9f08c61cf0ae037987f0d4e30ea7d3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "913c6f26_3c4f3e25",
        "filename": "test/pc/e2e/analyzer/video/quality_analyzing_video_decoder.cc",
        "patchSetId": 3
      },
      "lineNbr": 143,
      "author": {
        "id": 6337
      },
      "writtenOn": "2019-01-16T09:48:06Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c1a2efc6_91b4dc38",
      "range": {
        "startLine": 143,
        "startChar": 22,
        "endLine": 143,
        "endChar": 38
      },
      "revId": "98982868bb9f08c61cf0ae037987f0d4e30ea7d3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6133954a_c71a2e5b",
        "filename": "test/pc/e2e/analyzer/video/quality_analyzing_video_decoder.h",
        "patchSetId": 3
      },
      "lineNbr": 41,
      "author": {
        "id": 5117
      },
      "writtenOn": "2019-01-15T14:46:24Z",
      "side": 1,
      "message": "will make a call to\nor\nwill call",
      "range": {
        "startLine": 41,
        "startChar": 21,
        "endLine": 41,
        "endChar": 30
      },
      "revId": "98982868bb9f08c61cf0ae037987f0d4e30ea7d3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "396d8ab7_1b83bfd6",
        "filename": "test/pc/e2e/analyzer/video/quality_analyzing_video_decoder.h",
        "patchSetId": 3
      },
      "lineNbr": 41,
      "author": {
        "id": 6337
      },
      "writtenOn": "2019-01-16T09:48:06Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6133954a_c71a2e5b",
      "range": {
        "startLine": 41,
        "startChar": 21,
        "endLine": 41,
        "endChar": 30
      },
      "revId": "98982868bb9f08c61cf0ae037987f0d4e30ea7d3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b85bd4cd_c88f01ad",
        "filename": "test/pc/e2e/analyzer/video/quality_analyzing_video_decoder.h",
        "patchSetId": 3
      },
      "lineNbr": 48,
      "author": {
        "id": 5117
      },
      "writtenOn": "2019-01-15T14:46:24Z",
      "side": 1,
      "message": "at",
      "range": {
        "startLine": 48,
        "startChar": 64,
        "endLine": 48,
        "endChar": 66
      },
      "revId": "98982868bb9f08c61cf0ae037987f0d4e30ea7d3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "919bddb7_4c0c068e",
        "filename": "test/pc/e2e/analyzer/video/quality_analyzing_video_decoder.h",
        "patchSetId": 3
      },
      "lineNbr": 48,
      "author": {
        "id": 6337
      },
      "writtenOn": "2019-01-16T09:48:06Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b85bd4cd_c88f01ad",
      "range": {
        "startLine": 48,
        "startChar": 64,
        "endLine": 48,
        "endChar": 66
      },
      "revId": "98982868bb9f08c61cf0ae037987f0d4e30ea7d3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5e4d5c0d_8196fe51",
        "filename": "test/pc/e2e/analyzer/video/quality_analyzing_video_decoder.h",
        "patchSetId": 3
      },
      "lineNbr": 107,
      "author": {
        "id": 5117
      },
      "writtenOn": "2019-01-15T14:46:24Z",
      "side": 1,
      "message": "being decoded\nor \ndecoded",
      "range": {
        "startLine": 107,
        "startChar": 22,
        "endLine": 107,
        "endChar": 30
      },
      "revId": "98982868bb9f08c61cf0ae037987f0d4e30ea7d3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ff26ec7d_7bbd1bec",
        "filename": "test/pc/e2e/analyzer/video/quality_analyzing_video_decoder.h",
        "patchSetId": 3
      },
      "lineNbr": 107,
      "author": {
        "id": 6337
      },
      "writtenOn": "2019-01-16T09:48:06Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "5e4d5c0d_8196fe51",
      "range": {
        "startLine": 107,
        "startChar": 22,
        "endLine": 107,
        "endChar": 30
      },
      "revId": "98982868bb9f08c61cf0ae037987f0d4e30ea7d3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "dac099fd_d5cadc21",
        "filename": "test/pc/e2e/analyzer/video/quality_analyzing_video_decoder.h",
        "patchSetId": 3
      },
      "lineNbr": 111,
      "author": {
        "id": 5117
      },
      "writtenOn": "2019-01-15T14:46:24Z",
      "side": 1,
      "message": "I feel there\u0027s an issue brewing here. In the future we are going to change the decoding stack so, in vp9 svc, case decoder would receive 3 separate encoded images for each spatial layer, all with the same id/timestamp.\n\nPlease add a spatial layer to the key here",
      "range": {
        "startLine": 111,
        "startChar": 7,
        "endLine": 111,
        "endChar": 34
      },
      "revId": "98982868bb9f08c61cf0ae037987f0d4e30ea7d3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1a00ce7d_fdc0e489",
        "filename": "test/pc/e2e/analyzer/video/quality_analyzing_video_decoder.h",
        "patchSetId": 3
      },
      "lineNbr": 111,
      "author": {
        "id": 5117
      },
      "writtenOn": "2019-01-16T10:31:57Z",
      "side": 1,
      "message": "This is still an issue. You need to store all of possibly 3 encoded images with the same timestamp/id in this map. But the returned decoded VideoFrame doesn\u0027t have any spatial layer info. You can assume that EncodedImages are consumed in order of increasing SL, so you can remove them in order for each decoded callback call. Or you can remove all 3 images one you receive VideoFrame with the next id or later timestamp.",
      "parentUuid": "dac099fd_d5cadc21",
      "range": {
        "startLine": 111,
        "startChar": 7,
        "endLine": 111,
        "endChar": 34
      },
      "revId": "98982868bb9f08c61cf0ae037987f0d4e30ea7d3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5ad33dd9_07fcb076",
        "filename": "test/pc/e2e/analyzer/video/quality_analyzing_video_decoder.h",
        "patchSetId": 3
      },
      "lineNbr": 111,
      "author": {
        "id": 6337
      },
      "writtenOn": "2019-01-23T11:53:15Z",
      "side": 1,
      "message": "So as I understand decoder will never receive multiple encoded images for same video frame in sequential Decode(...) calls right now. So here we can keep single encoded image per frame id.\n\nSpatial layers right now will be merged before decoder and them merged image will be passed to the decoder. \n\nIn the future, when decode will support decoding multiple encoded images for single frame, this part will require update.",
      "parentUuid": "1a00ce7d_fdc0e489",
      "range": {
        "startLine": 111,
        "startChar": 7,
        "endLine": 111,
        "endChar": 34
      },
      "revId": "98982868bb9f08c61cf0ae037987f0d4e30ea7d3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "096ffd42_d249d8ec",
        "filename": "test/pc/e2e/analyzer/video/quality_analyzing_video_encoder.cc",
        "patchSetId": 3
      },
      "lineNbr": 115,
      "author": {
        "id": 5117
      },
      "writtenOn": "2019-01-15T14:46:24Z",
      "side": 1,
      "message": "This is a tricky thing. You can get up-to 3 OnEncodedImage with the same timestamp for a single Encode() call for svc/simulcast case.\n\nSee generic_encoder.cc, there I had to do almost the same thing as you (I stored encode start instead of frame id): https://cs.chromium.org/chromium/src/third_party/webrtc/modules/video_coding/generic_encoder.cc?sq\u003dpackage:chromium\u0026dr\u0026g\u003d0\u0026l\u003d216\n\nThere I had to get number of simulcast streams from the codec settings. Then I had separate list for each spatial layer/simulcast stream. \n\nAnd there\u0027s another problem here: you will need to parse set bitrate to understand if some layers are disabled. Because in that case callback will not be called for these layers for each Encode().",
      "range": {
        "startLine": 115,
        "startChar": 3,
        "endLine": 115,
        "endChar": 47
      },
      "revId": "98982868bb9f08c61cf0ae037987f0d4e30ea7d3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6f1209c0_1f59d9d6",
        "filename": "test/pc/e2e/analyzer/video/quality_analyzing_video_encoder.cc",
        "patchSetId": 3
      },
      "lineNbr": 115,
      "author": {
        "id": 6337
      },
      "writtenOn": "2019-01-23T11:53:15Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "096ffd42_d249d8ec",
      "range": {
        "startLine": 115,
        "startChar": 3,
        "endLine": 115,
        "endChar": 47
      },
      "revId": "98982868bb9f08c61cf0ae037987f0d4e30ea7d3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e25779ac_ae30817c",
        "filename": "test/pc/e2e/analyzer/video/quality_analyzing_video_encoder.h",
        "patchSetId": 3
      },
      "lineNbr": 46,
      "author": {
        "id": 5117
      },
      "writtenOn": "2019-01-15T14:46:24Z",
      "side": 1,
      "message": "at",
      "range": {
        "startLine": 46,
        "startChar": 64,
        "endLine": 46,
        "endChar": 66
      },
      "revId": "98982868bb9f08c61cf0ae037987f0d4e30ea7d3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cec52d25_a6ef43c4",
        "filename": "test/pc/e2e/analyzer/video/quality_analyzing_video_encoder.h",
        "patchSetId": 3
      },
      "lineNbr": 46,
      "author": {
        "id": 6337
      },
      "writtenOn": "2019-01-16T09:48:06Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e25779ac_ae30817c",
      "range": {
        "startLine": 46,
        "startChar": 64,
        "endLine": 46,
        "endChar": 66
      },
      "revId": "98982868bb9f08c61cf0ae037987f0d4e30ea7d3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "166dba8c_b5490a50",
        "filename": "test/pc/e2e/analyzer/video/quality_analyzing_video_encoder.h",
        "patchSetId": 3
      },
      "lineNbr": 86,
      "author": {
        "id": 5117
      },
      "writtenOn": "2019-01-15T14:46:24Z",
      "side": 1,
      "message": "The same problem here. Please either (1) merge callback with the encoder, or (2) move all the state to the callback (add there OnDecode() method then). Or (3) move all the processing to Encoder class and in the callback just bridge the calls.\n\nHaving a class, which works mostly with private members of another class just doesn\u0027t sit right with me.\n\nI think the second alternative is the best solution.\n\nSee generic_decoder.cc and generic_encoder.cc - they both use the second alternative.\n\nThe first alternative is multiple inheritance and some people discourage it. The third alternative is just first alternative disguised, actually.",
      "range": {
        "startLine": 72,
        "startChar": 0,
        "endLine": 86,
        "endChar": 4
      },
      "revId": "98982868bb9f08c61cf0ae037987f0d4e30ea7d3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "412e911a_c70b7508",
        "filename": "test/pc/e2e/analyzer/video/quality_analyzing_video_encoder.h",
        "patchSetId": 3
      },
      "lineNbr": 86,
      "author": {
        "id": 6337
      },
      "writtenOn": "2019-01-23T11:53:15Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "166dba8c_b5490a50",
      "range": {
        "startLine": 72,
        "startChar": 0,
        "endLine": 86,
        "endChar": 4
      },
      "revId": "98982868bb9f08c61cf0ae037987f0d4e30ea7d3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    }
  ]
}