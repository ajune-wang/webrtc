{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "c6db487f_b035cde7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 5053
      },
      "writtenOn": "2022-07-26T19:49:30Z",
      "side": 1,
      "message": "Seems ok to me, but I\u0027d appreciate a second opinion given that TrackMediaInfoMap uses a nontrivial amount of storage.",
      "revId": "213409a08c773db9048c5da795808a1f326e78d4",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "834fa63f_f356be0d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 5142
      },
      "writtenOn": "2022-07-27T05:47:28Z",
      "side": 1,
      "message": "Alright, Mirko care to give a second opinion?\n\nThis change makes TrackMediaInfoMap absl::optional\u003c\u003e instead of std::unique_ptr\u003c\u003e in RtpTransceiverStatsInfo which is used in std::vector\u003cRtpTransceiverStatsInfo\u003e transceiver_stats_infos_ where we have one info per transceiver. The map is never \"missing\", except during the initialization of the RtpTransceiverStatsInfo which requires tasks on different threads, so the difference is that the map becomes part of the storage for RtpTransceiverStatsInfo rather than being pointed to.\n\nWe also make the TrackMediaInfoMap\u0027s cricket::[Voice/Video]MediaInfo absl::optional\u003c\u003e instead of std::unique_ptr\u003c\u003e. These are structs containing a couple of std::vector\u003c\u003es and std::map\u003c\u003es. In PrepareTransceiverStatsInfosAndCallStats_s_w_n() these structs get std::move()\u0027d a couple of times as for the TrackMediaInfoMap to take ownership of them.",
      "parentUuid": "c6db487f_b035cde7",
      "revId": "213409a08c773db9048c5da795808a1f326e78d4",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "47a3b7c5_0197680f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 5087
      },
      "writtenOn": "2022-07-27T09:02:10Z",
      "side": 1,
      "message": "Yes, this LGTM.\n\nWe are not moving anything from the heap to the stack (well, we delegate this to std::vector) but it seems fine to make TrackMediaInfoMap more local to RtpTransceiverStatsInfo and avoid to jump to another memory location.",
      "parentUuid": "834fa63f_f356be0d",
      "revId": "213409a08c773db9048c5da795808a1f326e78d4",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b5fad816_347a2955",
        "filename": "pc/rtc_stats_collector.h",
        "patchSetId": 4
      },
      "lineNbr": 165,
      "author": {
        "id": 5234
      },
      "writtenOn": "2022-07-27T08:33:30Z",
      "side": 1,
      "message": "Do we need the distinction between an absent map and en empty map?",
      "range": {
        "startLine": 165,
        "startChar": 4,
        "endLine": 165,
        "endChar": 37
      },
      "revId": "213409a08c773db9048c5da795808a1f326e78d4",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c0ca35fc_f013c3b6",
        "filename": "pc/rtc_stats_collector.h",
        "patchSetId": 4
      },
      "lineNbr": 165,
      "author": {
        "id": 5142
      },
      "writtenOn": "2022-07-27T08:57:19Z",
      "side": 1,
      "message": "I think not - update: I got rid of this optional now by giving map an Initialize() method. The only reason it was ever nullopt was just temporarily before having been initialized.",
      "parentUuid": "b5fad816_347a2955",
      "range": {
        "startLine": 165,
        "startChar": 4,
        "endLine": 165,
        "endChar": 37
      },
      "revId": "213409a08c773db9048c5da795808a1f326e78d4",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    }
  ]
}