{
  "comments": [
    {
      "key": {
        "uuid": "df42d54e_31bd9226",
        "filename": "audio/channel_send.cc",
        "patchSetId": 22
      },
      "lineNbr": 1162,
      "author": {
        "id": 5077
      },
      "writtenOn": "2018-11-16T16:11:14Z",
      "side": 1,
      "message": "on which thread are we being called here? can we add a thread check to document?",
      "revId": "f1a0b10b08a3de520be180f6a92a4733e79fabf8",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a9c6cbe9_45f83ed6",
        "filename": "audio/channel_send.cc",
        "patchSetId": 22
      },
      "lineNbr": 1162,
      "author": {
        "id": 7704
      },
      "writtenOn": "2018-11-16T16:45:46Z",
      "side": 1,
      "message": "Good question. We are called on the network thread.\n\nI didn\u0027t add the check because channel_send.cc does not have a reference to the network thread... I believe ReceivedRTCPPacket is also called on the network thread.\n\nBut I am confused, the comment in AudioSendStream mentions that it is called on the worker thread, but should be on network thread, and the check verifies that it\u0027s a worker thread.\n\nSo which one should it be?\n\n\u0027bool AudioSendStream::DeliverRtcp(const uint8_t* packet, size_t length) {\n  // TODO(solenberg): Tests call this function on a network thread, libjingle\n  // calls on the worker thread. We should move towards always using a network\n  // thread. Then this check can be enabled.\n  // RTC_DCHECK(!worker_thread_checker_.CalledOnValidThread());",
      "parentUuid": "df42d54e_31bd9226",
      "revId": "f1a0b10b08a3de520be180f6a92a4733e79fabf8",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "46938b02_8ef3fd9c",
        "filename": "audio/channel_send.cc",
        "patchSetId": 22
      },
      "lineNbr": 1162,
      "author": {
        "id": 5039
      },
      "writtenOn": "2018-11-16T16:51:20Z",
      "side": 1,
      "message": "AFAIK everything in media/ and below is called on the libjingle worker thread (unless dealing with a specific module thread, for example). I don\u0027t think anything is called from the network thread today.",
      "parentUuid": "a9c6cbe9_45f83ed6",
      "revId": "f1a0b10b08a3de520be180f6a92a4733e79fabf8",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "524688c0_94f7f8c6",
        "filename": "audio/channel_send.cc",
        "patchSetId": 22
      },
      "lineNbr": 1162,
      "author": {
        "id": 7704
      },
      "writtenOn": "2018-11-16T17:27:32Z",
      "side": 1,
      "message": "yeah, it looks like call.cc calls it from worker thread. I initially added a sequence checker instead of a DCHECK.\n\n\nvoid ChannelSend::OnReceivedRtt(int64_t rtt_ms) {\n  RTC_DCHECK_CALLED_SEQUENTIALLY(\u0026on_received_rtt_sequence_checker_);\n\n\nvoid ChannelSend::SetBitRate(int bitrate_bps, int64_t probing_interval_ms) {\n  RTC_DCHECK_CALLED_SEQUENTIALLY(\u0026on_received_rtt_sequence_checker_);\n\n\nbut ... it started firing. It looks like there is a race on these two.\n\nLuckily, ModifyEncoder() is thread safe.\n\n\nSo I didn\u0027t add any checks.",
      "parentUuid": "46938b02_8ef3fd9c",
      "revId": "f1a0b10b08a3de520be180f6a92a4733e79fabf8",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6d3dce3d_5ebca473",
        "filename": "audio/channel_send.h",
        "patchSetId": 22
      },
      "lineNbr": 244,
      "author": {
        "id": 5077
      },
      "writtenOn": "2018-11-16T16:11:14Z",
      "side": 1,
      "message": "Is the end goal to create an RTP version of media transport? Special casing throughout the codebase doesn\u0027t sound appealing...\n\nOh, there\u0027s a comment in the .cc which explains that. :) Perhaps change this comment as well?",
      "revId": "f1a0b10b08a3de520be180f6a92a4733e79fabf8",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "80d64696_6767aadc",
        "filename": "audio/channel_send.h",
        "patchSetId": 22
      },
      "lineNbr": 244,
      "author": {
        "id": 7704
      },
      "writtenOn": "2018-11-16T16:45:46Z",
      "side": 1,
      "message": "There is a plan for that. Updated the comment here as well.",
      "parentUuid": "6d3dce3d_5ebca473",
      "revId": "f1a0b10b08a3de520be180f6a92a4733e79fabf8",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "16f3d6dd_24e7dfef",
        "filename": "pc/channel.cc",
        "patchSetId": 22
      },
      "lineNbr": 184,
      "author": {
        "id": 5077
      },
      "writtenOn": "2018-11-16T16:11:14Z",
      "side": 1,
      "message": "like this!",
      "revId": "f1a0b10b08a3de520be180f6a92a4733e79fabf8",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b14ea970_3b43f0c6",
        "filename": "pc/channel.cc",
        "patchSetId": 22
      },
      "lineNbr": 184,
      "author": {
        "id": 7704
      },
      "writtenOn": "2018-11-16T17:27:32Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "16f3d6dd_24e7dfef",
      "revId": "f1a0b10b08a3de520be180f6a92a4733e79fabf8",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "310b55f7_c6d2786b",
        "filename": "pc/channel.cc",
        "patchSetId": 22
      },
      "lineNbr": 790,
      "author": {
        "id": 5077
      },
      "writtenOn": "2018-11-16T16:11:14Z",
      "side": 1,
      "message": "nit: new line",
      "revId": "f1a0b10b08a3de520be180f6a92a4733e79fabf8",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8c32e410_d0e2088d",
        "filename": "pc/channel.cc",
        "patchSetId": 22
      },
      "lineNbr": 790,
      "author": {
        "id": 7704
      },
      "writtenOn": "2018-11-16T17:27:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "310b55f7_c6d2786b",
      "revId": "f1a0b10b08a3de520be180f6a92a4733e79fabf8",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    }
  ]
}