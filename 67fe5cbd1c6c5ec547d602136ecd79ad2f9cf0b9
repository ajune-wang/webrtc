{
  "comments": [
    {
      "key": {
        "uuid": "c5dc7403_df03fb3b",
        "filename": "call/adaptation/resource_adaptation_processor.cc",
        "patchSetId": 4
      },
      "lineNbr": 158,
      "author": {
        "id": 5142
      },
      "writtenOn": "2020-04-08T12:56:54Z",
      "side": 1,
      "message": "Self-review: Add resource_adaptation_processor_unittest.cc coverage.",
      "revId": "67fe5cbd1c6c5ec547d602136ecd79ad2f9cf0b9",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "640bcf91_dfe21d38",
        "filename": "call/adaptation/resource_adaptation_processor.cc",
        "patchSetId": 4
      },
      "lineNbr": 158,
      "author": {
        "id": 8683
      },
      "writtenOn": "2020-04-16T09:20:44Z",
      "side": 1,
      "message": "Why do we do clearing? Why not let the resources themselves determine that when they next measure?",
      "range": {
        "startLine": 157,
        "startChar": 0,
        "endLine": 158,
        "endChar": 32
      },
      "revId": "67fe5cbd1c6c5ec547d602136ecd79ad2f9cf0b9",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3869f43d_e6d0a1c2",
        "filename": "call/adaptation/resource_adaptation_processor.cc",
        "patchSetId": 4
      },
      "lineNbr": 158,
      "author": {
        "id": 5142
      },
      "writtenOn": "2020-04-20T09:02:15Z",
      "side": 1,
      "message": "Hmm I think in the end, something like this should be resource-specific.\n\nFor now I\u0027m trying to reconcile how the model describes itself and how the current version of the processor operates.\n\nToday, adaptation logic due to resources is only triggered based on OnResourceUsageMeasured(). If we don\u0027t get another usage measurement, we\u0027re not going to re-run the adaptation logic.\n\nThis is probably a bug: Maybe we\u0027re not adapting due to kAwaitingPreviousAdaptation, or maybe we\u0027re not adapting due to kLimitReached but then another stream is added that we might be able to adapt. But with the current implementation, there is no way to re-run the adaptation logic without waiting for another resource usage measurement.\n\nUntil we resolve this for real (like re-run resource usage measurements at certain intervals or in response to callbacks like \"new fps observed\" or \"new stream added\"), I would rather clear the usage states too often than too seldom, to reflect the fact that we are currently depending on new measurements and don\u0027t really care what the usage states are in-between measurements.\n\n---\n\nTo make this clear, I update the CL to unconditionally clear all resources usage states at the beginning of the method and added a TODO describing the problem.",
      "parentUuid": "640bcf91_dfe21d38",
      "range": {
        "startLine": 157,
        "startChar": 0,
        "endLine": 158,
        "endChar": 32
      },
      "revId": "67fe5cbd1c6c5ec547d602136ecd79ad2f9cf0b9",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "00261579_dd4186df",
        "filename": "call/adaptation/resource_adaptation_processor.cc",
        "patchSetId": 4
      },
      "lineNbr": 158,
      "author": {
        "id": 5142
      },
      "writtenOn": "2020-04-20T09:03:46Z",
      "side": 1,
      "message": "Resolving this for realsies might require another small design doc",
      "parentUuid": "3869f43d_e6d0a1c2",
      "range": {
        "startLine": 157,
        "startChar": 0,
        "endLine": 158,
        "endChar": 32
      },
      "revId": "67fe5cbd1c6c5ec547d602136ecd79ad2f9cf0b9",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bbd89bd5_cb44ce5e",
        "filename": "call/adaptation/resource_adaptation_processor.cc",
        "patchSetId": 4
      },
      "lineNbr": 158,
      "author": {
        "id": 8683
      },
      "writtenOn": "2020-04-20T09:26:35Z",
      "side": 1,
      "message": "I think this is still problematic, especially because we support multiple listeners. Order matters here - if this listener gets called first then it will clear the value before the other listeners have a chance to read it. \n\nThere could also be threading concerns soon - a resource has just measured an overuse value, but we tell them to clear it just after they have queued a measurement update. We will can overwrite the value before the others use it.\n\nResource 1 queue: Measure ---------    Clear\nResource 2 queue: ------  Measure      Clear\nListener queue:   ------- OnMeasure(1) -- OnMeasure(2)\n\nIn this case the measurement made in Resource 2 was cleared from OnMeasure for Resource 1. \n\nThe queuing issue is long term, but I think this current solution of clearing can only work if we can remove multiple listeners. Can we do that for now? \n\nIf we can\u0027t remove multiple list, perhaps the clearing can happen in the Resource by default, after it has signaled to all listeners in the protected OnResourceUsageMeasured.",
      "parentUuid": "00261579_dd4186df",
      "range": {
        "startLine": 157,
        "startChar": 0,
        "endLine": 158,
        "endChar": 32
      },
      "revId": "67fe5cbd1c6c5ec547d602136ecd79ad2f9cf0b9",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "735763ed_4a19faff",
        "filename": "call/adaptation/resource_unittest.cc",
        "patchSetId": 4
      },
      "lineNbr": 29,
      "author": {
        "id": 5142
      },
      "writtenOn": "2020-04-08T12:56:54Z",
      "side": 1,
      "message": "Self-review: Add resource_unittest.cc coverage.",
      "revId": "67fe5cbd1c6c5ec547d602136ecd79ad2f9cf0b9",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    }
  ]
}