{
  "comments": [
    {
      "key": {
        "uuid": "25b3211e_b1c05753",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 10,
      "author": {
        "id": 5234
      },
      "writtenOn": "2019-03-27T15:28:44Z",
      "side": 1,
      "message": "treated",
      "range": {
        "startLine": 10,
        "startChar": 52,
        "endLine": 10,
        "endChar": 59
      },
      "revId": "a3261afe988bd363c0c2ab6d968637e0fe3bc5b3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4c33413a_5140e84a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 10,
      "author": {
        "id": 5117
      },
      "writtenOn": "2019-03-28T10:12:30Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "25b3211e_b1c05753",
      "range": {
        "startLine": 10,
        "startChar": 52,
        "endLine": 10,
        "endChar": 59
      },
      "revId": "a3261afe988bd363c0c2ab6d968637e0fe3bc5b3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4adcd5b2_8f2966f1",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 15,
      "author": {
        "id": 5234
      },
      "writtenOn": "2019-03-27T15:28:44Z",
      "side": 1,
      "message": "differentiate",
      "range": {
        "startLine": 15,
        "startChar": 8,
        "endLine": 15,
        "endChar": 21
      },
      "revId": "a3261afe988bd363c0c2ab6d968637e0fe3bc5b3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dc580854_6e2366a7",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 15,
      "author": {
        "id": 5117
      },
      "writtenOn": "2019-03-28T10:12:30Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "4adcd5b2_8f2966f1",
      "range": {
        "startLine": 15,
        "startChar": 8,
        "endLine": 15,
        "endChar": 21
      },
      "revId": "a3261afe988bd363c0c2ab6d968637e0fe3bc5b3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "be21b334_22063139",
        "filename": "call/rtp_video_sender.cc",
        "patchSetId": 3
      },
      "lineNbr": 454,
      "author": {
        "id": 5234
      },
      "writtenOn": "2019-03-27T15:28:44Z",
      "side": 1,
      "message": "I had expected this to be true for svc.",
      "range": {
        "startLine": 454,
        "startChar": 8,
        "endLine": 454,
        "endChar": 32
      },
      "revId": "a3261afe988bd363c0c2ab6d968637e0fe3bc5b3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e2691924_3efa6c5e",
        "filename": "call/rtp_video_sender.cc",
        "patchSetId": 3
      },
      "lineNbr": 454,
      "author": {
        "id": 5117
      },
      "writtenOn": "2019-03-28T10:12:30Z",
      "side": 1,
      "message": "It\u0027s not. That\u0027s the problem. rtp_streams_ are created here:\nhttps://cs.chromium.org/chromium/src/third_party/webrtc/call/rtp_video_sender.cc?l\u003d130\n\naccording to the number of passed SSRCs. And for SVC 3 ssrcs are always passed in sdp, that\u0027s the only solution we found to pass it.\n\nI tried to filter out ssrcs in WebrtcVideoEngine, but it didn\u0027t work out - there\u0027re multiple ways ssrcs are passed to different parts of webrtc and it\u0027s impossible to modify it at some places.",
      "parentUuid": "be21b334_22063139",
      "range": {
        "startLine": 454,
        "startChar": 8,
        "endLine": 454,
        "endChar": 32
      },
      "revId": "a3261afe988bd363c0c2ab6d968637e0fe3bc5b3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ed42c1ec_c38b6fc2",
        "filename": "call/video_send_stream.h",
        "patchSetId": 3
      },
      "lineNbr": 154,
      "author": {
        "id": 5234
      },
      "writtenOn": "2019-03-27T15:28:44Z",
      "side": 1,
      "message": "This is a bit vague. I take it it\u0027s intended to distinguish between simulcast (multiple \"spatial layers\", each sent on a separate ssrc) and svc (multiple spatial layers, all sent on the same ssrc).\n\nI think that info belongs in RtpConfig member, above.\n\nBut isn\u0027t it enough to look at rtp.ssrcs.size()? That should be one for svc, and \u003e 1 for simulcast. Unless I\u0027m misunderstanding something.",
      "range": {
        "startLine": 154,
        "startChar": 4,
        "endLine": 154,
        "endChar": 53
      },
      "revId": "a3261afe988bd363c0c2ab6d968637e0fe3bc5b3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "df9e0f60_72e85666",
        "filename": "call/video_send_stream.h",
        "patchSetId": 3
      },
      "lineNbr": 154,
      "author": {
        "id": 5117
      },
      "writtenOn": "2019-03-28T10:12:30Z",
      "side": 1,
      "message": "This is to distinguish between svc/simulcast. I can rename it to bool is_svc_, would that be better?\n\nAs i stated already in other comment, no, rtp.ssrcs.size() is always 3 for svc.",
      "parentUuid": "ed42c1ec_c38b6fc2",
      "range": {
        "startLine": 154,
        "startChar": 4,
        "endLine": 154,
        "endChar": 53
      },
      "revId": "a3261afe988bd363c0c2ab6d968637e0fe3bc5b3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5f8b5c86_2e68b739",
        "filename": "call/video_send_stream.h",
        "patchSetId": 3
      },
      "lineNbr": 154,
      "author": {
        "id": 5234
      },
      "writtenOn": "2019-03-28T10:30:48Z",
      "side": 1,
      "message": "Using bool is_svc_ is ok for the immediate fix. Or keep num_streams_, but replace the ambiguous \"VideoStreams\" by something that clarifies what \"stream\" means in this context.\n\nIf I\u0027ve understood your other comment correctly, is_svc_ \u003d\u003d true or num_streams_ \u003d 1 means roughly \"if multiple ssrcs are configured (rtp.ssrcs.size() \u003e 1), ignore all but the first one\".\n\nI still think it would make sense to move this setting it to the Rtp config. As I see it, an encoder may produce different multiple layers with several different flavors of layering, and this setting configures how the RtpVideoSender maps those layers onto rtp streams. But I won\u0027t insist on this cl.\n\nDo you foresee any need to be able to switch between simulcast and svc mid-stream, e.g, switching from an encoder supporting svc to one that doesn\u0027t, or vice versa? Then one might want to do that without changing the RtpConfig.",
      "parentUuid": "df9e0f60_72e85666",
      "range": {
        "startLine": 154,
        "startChar": 4,
        "endLine": 154,
        "endChar": 53
      },
      "revId": "a3261afe988bd363c0c2ab6d968637e0fe3bc5b3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8c3e4e5a_37d8d361",
        "filename": "call/video_send_stream.h",
        "patchSetId": 3
      },
      "lineNbr": 154,
      "author": {
        "id": 5117
      },
      "writtenOn": "2019-03-28T10:35:21Z",
      "side": 1,
      "message": "Actually, if we switch between vp9 and vp8 mid-call, which could happen, we will need to switch between simulcast/svc.",
      "parentUuid": "5f8b5c86_2e68b739",
      "range": {
        "startLine": 154,
        "startChar": 4,
        "endLine": 154,
        "endChar": 53
      },
      "revId": "a3261afe988bd363c0c2ab6d968637e0fe3bc5b3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3d390cb8_97a99b1f",
        "filename": "call/video_send_stream.h",
        "patchSetId": 3
      },
      "lineNbr": 154,
      "author": {
        "id": 5234
      },
      "writtenOn": "2019-03-28T10:54:42Z",
      "side": 1,
      "message": "\u003e Actually, if we switch between vp9 and vp8 mid-call, which could happen, we will need to switch between simulcast/svc.\n\nBut on this level, we still recreate the VideoSendStream, so we could tweak rtp config.\n\nIf we could do the switch without creating a new RtpVideoSender, an is_svc_ flag would be more necessary.",
      "parentUuid": "8c3e4e5a_37d8d361",
      "range": {
        "startLine": 154,
        "startChar": 4,
        "endLine": 154,
        "endChar": 53
      },
      "revId": "a3261afe988bd363c0c2ab6d968637e0fe3bc5b3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "885ba9b2_c35606b4",
        "filename": "call/video_send_stream.h",
        "patchSetId": 3
      },
      "lineNbr": 154,
      "author": {
        "id": 5117
      },
      "writtenOn": "2019-03-28T13:53:26Z",
      "side": 1,
      "message": "Tweaking rtp config doesn\u0027t work from the box. There\u0027re some interconnections I can\u0027t find yet.\nRenamed to is_svc flag.",
      "parentUuid": "3d390cb8_97a99b1f",
      "range": {
        "startLine": 154,
        "startChar": 4,
        "endLine": 154,
        "endChar": 53
      },
      "revId": "a3261afe988bd363c0c2ab6d968637e0fe3bc5b3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4773b97f_7649736b",
        "filename": "media/engine/webrtc_video_engine.cc",
        "patchSetId": 3
      },
      "lineNbr": 2304,
      "author": {
        "id": 5234
      },
      "writtenOn": "2019-03-28T10:54:42Z",
      "side": 1,
      "message": "Not sure this is a better way, but would it work if you instead do\n\nif (parameters_.encoder_config.number_of_streams \u003c config.rtp.ssrcs.size()) {\n  // Don\u0027t use more ssrcs than we have streams. Matters when switching between\n  // svc and simulcast mid-stream.\n  config.rtp.ssrcs.set_size(parameters_.encoder_config.number_of_streams);\n}\n\n?\n\nIf you don\u0027t like this way, then I think I\u0027d prefer an is_svc_ flag.",
      "range": {
        "startLine": 2304,
        "startChar": 0,
        "endLine": 2304,
        "endChar": 68
      },
      "revId": "a3261afe988bd363c0c2ab6d968637e0fe3bc5b3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "001760e1_446fb784",
        "filename": "media/engine/webrtc_video_engine.cc",
        "patchSetId": 3
      },
      "lineNbr": 2304,
      "author": {
        "id": 5117
      },
      "writtenOn": "2019-03-28T13:53:26Z",
      "side": 1,
      "message": "I tried that. But there are some more paths how original 3 ssrcs are propagated. This leads to inconsistency then rtpVideoSender would (correctly) create only one rtp_stream, but e.g. videostreamencoder would still ask to disable/enable 3 streams. This leads to RTC_CHECKS and crashes. I plan to do that in a follow up CL, but it will take much longer and i need this asap to merge this to m74.",
      "parentUuid": "4773b97f_7649736b",
      "range": {
        "startLine": 2304,
        "startChar": 0,
        "endLine": 2304,
        "endChar": 68
      },
      "revId": "a3261afe988bd363c0c2ab6d968637e0fe3bc5b3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    }
  ]
}