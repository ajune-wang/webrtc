{
  "comments": [
    {
      "key": {
        "uuid": "8046b0c7_913956ee",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 5607
      },
      "writtenOn": "2020-09-14T12:44:41Z",
      "side": 1,
      "message": "Thanks for making a fix for this issue! See some comments below.",
      "revId": "d4f9beca890d94565b1b7ce7a8cdbc5db80065b7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f9981f38_4d408381",
        "filename": "video/rtp_streams_synchronizer.cc",
        "patchSetId": 4
      },
      "lineNbr": 92,
      "author": {
        "id": 5607
      },
      "writtenOn": "2020-09-14T12:44:41Z",
      "side": 1,
      "message": "nit: last_audio_receive_time_ms",
      "range": {
        "startLine": 92,
        "startChar": 10,
        "endLine": 92,
        "endChar": 31
      },
      "revId": "d4f9beca890d94565b1b7ce7a8cdbc5db80065b7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0b8501c9_2f39e3e9",
        "filename": "video/rtp_streams_synchronizer.cc",
        "patchSetId": 4
      },
      "lineNbr": 92,
      "author": {
        "id": 8760
      },
      "writtenOn": "2020-09-14T15:16:33Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f9981f38_4d408381",
      "range": {
        "startLine": 92,
        "startChar": 10,
        "endLine": 92,
        "endChar": 31
      },
      "revId": "d4f9beca890d94565b1b7ce7a8cdbc5db80065b7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "292daf77_d91fad43",
        "filename": "video/stream_synchronization_unittest.cc",
        "patchSetId": 4
      },
      "lineNbr": 403,
      "author": {
        "id": 5607
      },
      "writtenOn": "2020-09-14T12:44:41Z",
      "side": 1,
      "message": "nit: Please end comments with a \u0027.\u0027 (also applies to comments below).",
      "range": {
        "startLine": 403,
        "startChar": 5,
        "endLine": 403,
        "endChar": 71
      },
      "revId": "d4f9beca890d94565b1b7ce7a8cdbc5db80065b7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a735cc84_c7eaa463",
        "filename": "video/stream_synchronization_unittest.cc",
        "patchSetId": 4
      },
      "lineNbr": 403,
      "author": {
        "id": 8760
      },
      "writtenOn": "2020-09-14T15:16:33Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "292daf77_d91fad43",
      "range": {
        "startLine": 403,
        "startChar": 5,
        "endLine": 403,
        "endChar": 71
      },
      "revId": "d4f9beca890d94565b1b7ce7a8cdbc5db80065b7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1c242dff_adc9c995",
        "filename": "video/stream_synchronization_unittest.cc",
        "patchSetId": 4
      },
      "lineNbr": 417,
      "author": {
        "id": 5607
      },
      "writtenOn": "2020-09-14T12:44:41Z",
      "side": 1,
      "message": "nit: Please start comments with a capital (also applies to comments below).",
      "range": {
        "startLine": 417,
        "startChar": 5,
        "endLine": 417,
        "endChar": 6
      },
      "revId": "d4f9beca890d94565b1b7ce7a8cdbc5db80065b7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f77e9d3a_3ed83e05",
        "filename": "video/stream_synchronization_unittest.cc",
        "patchSetId": 4
      },
      "lineNbr": 417,
      "author": {
        "id": 8760
      },
      "writtenOn": "2020-09-14T15:16:33Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "1c242dff_adc9c995",
      "range": {
        "startLine": 417,
        "startChar": 5,
        "endLine": 417,
        "endChar": 6
      },
      "revId": "d4f9beca890d94565b1b7ce7a8cdbc5db80065b7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "703250e1_2e14c6d1",
        "filename": "video/stream_synchronization_unittest.cc",
        "patchSetId": 4
      },
      "lineNbr": 419,
      "author": {
        "id": 5607
      },
      "writtenOn": "2020-09-14T12:44:41Z",
      "side": 1,
      "message": "In practice the max audio delay that is accepted by NetEq is 3000 ms, higher delays will be ignored.",
      "range": {
        "startLine": 419,
        "startChar": 31,
        "endLine": 419,
        "endChar": 71
      },
      "revId": "d4f9beca890d94565b1b7ce7a8cdbc5db80065b7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "87ec562d_81f2bb0d",
        "filename": "video/stream_synchronization_unittest.cc",
        "patchSetId": 4
      },
      "lineNbr": 419,
      "author": {
        "id": 8760
      },
      "writtenOn": "2020-09-14T15:16:33Z",
      "side": 1,
      "message": "Ivo, can you please tell us where this is enforced. Is this because of the max packet size in Neteq being 200 and with 20ms packet duration, it will be 4sec max delay in NetEQ? For our product we are using 60ms audio packets and are seeing large delays some times, though its difficult to confirm, but I think we are seeing more than 3sec delays. I personally feel there should be a way to limit the max NetEQ delay to absolute time, like 3sec regardless of packet duration. That would help a lot.",
      "parentUuid": "703250e1_2e14c6d1",
      "range": {
        "startLine": 419,
        "startChar": 31,
        "endLine": 419,
        "endChar": 71
      },
      "revId": "d4f9beca890d94565b1b7ce7a8cdbc5db80065b7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4d6d02e4_b551c9ea",
        "filename": "video/stream_synchronization_unittest.cc",
        "patchSetId": 4
      },
      "lineNbr": 438,
      "author": {
        "id": 5607
      },
      "writtenOn": "2020-09-14T12:44:41Z",
      "side": 1,
      "message": "Maybe I\u0027m misunderstanding something, but isn\u0027t this exactly what this CL is trying to prevent?",
      "range": {
        "startLine": 436,
        "startChar": 0,
        "endLine": 438,
        "endChar": 0
      },
      "revId": "d4f9beca890d94565b1b7ce7a8cdbc5db80065b7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b799e5fc_e404a9d5",
        "filename": "video/stream_synchronization_unittest.cc",
        "patchSetId": 4
      },
      "lineNbr": 438,
      "author": {
        "id": 8760
      },
      "writtenOn": "2020-09-14T15:16:33Z",
      "side": 1,
      "message": "You are absolutely right; this test is just exposing the issue with StreamSynchronization class. This class is used by higher level rtp_video_stream_receiver.cc which uses NetEQ, audio, video components along with StreamSynchronization to figure out the delays. \nThe main issue happens because StreamSynchronization\u0027s audio delay is never updated and its mostly how NetEQ works: NetEQ does not update delay till packets are flowing in. \nThe fix is at higher level, where we stop calling StreamSynchronization when audio stops flowing in.\n\nSince rtp_video_stream_receiver deals with so many different components, I guess it was not easy to unit test at that level, hence no unit tests for that class.\n\nI tried to simulate the issue via unit test; if this is ever fixed in StreamSynchronization, maybe caller don\u0027t need to handle this case.",
      "parentUuid": "4d6d02e4_b551c9ea",
      "range": {
        "startLine": 436,
        "startChar": 0,
        "endLine": 438,
        "endChar": 0
      },
      "revId": "d4f9beca890d94565b1b7ce7a8cdbc5db80065b7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    }
  ]
}