{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "d79457ea_841b4814",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 5234
      },
      "writtenOn": "2022-06-29T09:40:57Z",
      "side": 1,
      "message": "This attempts to wire up L2T3 and S2T3, but I need some help to actually define the proper dependency templates.\n\nUnclear to me why the failing tests are affected, \n\n  ScalabilityModeOff/Vp9Test.NonFlexMode/L2T3_WithoutIdentifier\n  ScalabilityModeOff/Vp9Test.NonFlexMode/S2T3_WithoutIdentifier\n  \nAs far as I see, they don\u0027t set the scalability mode, but it looks like they fail because the \"structure\" for the new modes are invalid. Perhaps because of the conversion back from detailed settings to mode?\n\n# Fatal error in: ../../modules/rtp_rtcp/source/rtp_sender_video.cc, line 253\n# last system error: 1\n# Check failed: video_structure-\u003enum_decode_targets \u003e 0 (0 vs. 0)",
      "revId": "21a7eb054bdf1eac7bfd2accb01bbe60c53ce1a9",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9cb44816_8d72924d",
        "filename": "modules/video_coding/svc/scalability_structure_full_svc.cc",
        "patchSetId": 1
      },
      "lineNbr": 359,
      "author": {
        "id": 5019
      },
      "writtenOn": "2022-06-29T10:44:23Z",
      "side": 1,
      "message": "6 \u003d num_spatial_layers * num_temporal_layers",
      "range": {
        "startLine": 359,
        "startChar": 33,
        "endLine": 359,
        "endChar": 34
      },
      "revId": "21a7eb054bdf1eac7bfd2accb01bbe60c53ce1a9",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b298bc0f_9c9acc31",
        "filename": "modules/video_coding/svc/scalability_structure_full_svc.cc",
        "patchSetId": 1
      },
      "lineNbr": 361,
      "author": {
        "id": 5019
      },
      "writtenOn": "2022-06-29T10:44:23Z",
      "side": 1,
      "message": "num_chains \u003d num_spatial_layers\ndecode_target_protected_by_chain \u003d {0, 0, 0, 1, 1, 1}",
      "range": {
        "startLine": 360,
        "startChar": 25,
        "endLine": 361,
        "endChar": 57
      },
      "revId": "21a7eb054bdf1eac7bfd2accb01bbe60c53ce1a9",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ce237d95_42fd5053",
        "filename": "modules/video_coding/svc/scalability_structure_full_svc.cc",
        "patchSetId": 1
      },
      "lineNbr": 363,
      "author": {
        "id": 5019
      },
      "writtenOn": "2022-06-29T10:44:23Z",
      "side": 1,
      "message": "there should be 10 templates (take a look at L3T3 structure, throw away S(2) templates,\nfor dtis throw away decode targets mapping to S2 (i.e. last 3 chars).\nchain diffs and frame diffs might be a bit more complicted to update, but may be not:\nfor frame diffs replace 3x values with 2x value for diffs - those correspond to temporal dependencies\nfor chain diffs can use the same trick - order templates in order of the frames they arrive, sort separately.",
      "range": {
        "startLine": 363,
        "startChar": 2,
        "endLine": 363,
        "endChar": 22
      },
      "revId": "21a7eb054bdf1eac7bfd2accb01bbe60c53ce1a9",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1f618411_005a8210",
        "filename": "modules/video_coding/svc/scalability_structure_full_svc.cc",
        "patchSetId": 1
      },
      "lineNbr": 363,
      "author": {
        "id": 5234
      },
      "writtenOn": "2022-06-29T14:26:47Z",
      "side": 1,
      "message": "I\u0027ve given this a try. Dropped S2, dropped final 3 chars of Dtis, updates frame diffs. I didn\u0027t get how to do the chain diffs. Also not sure about the order (the t[x] index), I kept them unchanged from L3T3, and at least they cover the range 0...9.\n\nI don\u0027t really understand this (I have a very fuzzy understanding of intended frame dependencies, and even less clue about how it\u0027s represented in these template objects). For docs, should one start with reading the dependency descriptor spec?",
      "parentUuid": "ce237d95_42fd5053",
      "range": {
        "startLine": 363,
        "startChar": 2,
        "endLine": 363,
        "endChar": 22
      },
      "revId": "21a7eb054bdf1eac7bfd2accb01bbe60c53ce1a9",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "da2bddd1_5e4c08af",
        "filename": "modules/video_coding/svc/scalability_structure_full_svc.cc",
        "patchSetId": 1
      },
      "lineNbr": 363,
      "author": {
        "id": 5019
      },
      "writtenOn": "2022-06-29T15:14:55Z",
      "side": 1,
      "message": "yes, DD spec can be a good document to check, examples in particular:\nhttps://aomediacodec.github.io/av1-rtp-spec/#a1011-decode-targets-decode-target-indications-and-chains\n\nIt should be easier to see frame diffs and chain diffs with a diagram: https://www.w3.org/TR/webrtc-svc/#L2T3*\n\nlook at first 10 frames (first 5 pictures, each consists of S0 and S1 frames).\ndraw frame ids on them in order:\n\n   4\n / |  6\n2--+-/|\n|  |  |\n|  3  |  ....\n| /   5\n1----/\n\n\nnow, FrameDiffs should be easy to calculate, e.g. frame_id\u003d6 depends directly on frame_id\u003d2 and frame_id\u003d5, so its framediffs would be {6-2, 6-5} \u003d {4, 1} [order doesn\u0027t matter from frame diffs]\n\nchain diffs are bit more complicated - check last T0 frame per spatial id.\ne.g. for frame_id\u003d6 these frames are frame_id\u003d1 and frame_id\u003d2, so \nchain_diffs \u003d {5, 4} [order does matter for chain diffs]\n\nyou may write fdiffs/chain_diffs for more than 10 frames, but you would notice that template for frame#11 exactly matches template for frame#3\n\nThere are also tests that validate structures for consistency.\ncheck scalability_structure_unittest.cc and add new modes for testing",
      "parentUuid": "1f618411_005a8210",
      "range": {
        "startLine": 363,
        "startChar": 2,
        "endLine": 363,
        "endChar": 22
      },
      "revId": "21a7eb054bdf1eac7bfd2accb01bbe60c53ce1a9",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    }
  ]
}