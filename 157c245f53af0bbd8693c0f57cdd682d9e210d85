{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "66c3fef6_575da641",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5508
      },
      "writtenOn": "2024-03-19T07:54:13Z",
      "side": 1,
      "message": "Can you file a bug for this and also add a test that verifies the right frame rates are matched? (as per the CL description)",
      "revId": "157c245f53af0bbd8693c0f57cdd682d9e210d85",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "68bb0af5_db0f3130",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5091
      },
      "writtenOn": "2024-03-19T09:19:35Z",
      "side": 1,
      "message": "Removed myself as Reviewer since I don\u0027t know this functionality or background well enough to provide qualified comments.",
      "revId": "157c245f53af0bbd8693c0f57cdd682d9e210d85",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f7750e78_bffdd3e8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 3333013
      },
      "writtenOn": "2024-06-03T07:01:40Z",
      "side": 1,
      "message": "I\u0027m sorry, but I don\u0027t quite understand what you mean. Could you please specify what exactly I need to do? Do you want me to paste the test data here?",
      "parentUuid": "66c3fef6_575da641",
      "revId": "157c245f53af0bbd8693c0f57cdd682d9e210d85",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2e3328a5_421539b7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 3333013
      },
      "writtenOn": "2024-06-03T08:23:12Z",
      "side": 1,
      "message": "I\u0027m not sure if this is what you want. If necessary, I can conduct other tests.\n\n ## Where to add the log:\n `Camera1Session.java` line 174 - 183\n \n ```java\n  private static CaptureFormat findClosestCaptureFormat(\n      Camera.Parameters parameters, int width, int height, int framerate) {\n    // Find closest supported format for `width` x `height` @ `framerate`.\n    final List\u003cCaptureFormat.FramerateRange\u003e supportedFramerates \u003d\n        Camera1Enumerator.convertFramerates(parameters.getSupportedPreviewFpsRange());\n    // log add by Liam Keh\n    Logging.d(TAG, \"Desired capture fps: \" + framerate);\n    Logging.d(TAG, \"Available fps ranges: \" + supportedFramerates);\n\n    final CaptureFormat.FramerateRange fpsRange \u003d\n        CameraEnumerationAndroid.getClosestSupportedFramerateRange(supportedFramerates, framerate);\n    // log add by Liam Keh\n    Logging.d(TAG, \"getClosestSupportedFramerateRange:\" + fpsRange);\n    \n    final Size previewSize \u003d CameraEnumerationAndroid.getClosestSupportedSize(\n        Camera1Enumerator.convertSizes(parameters.getSupportedPreviewSizes()), width, height);\n    CameraEnumerationAndroid.reportCameraResolution(camera1ResolutionHistogram, previewSize);\n\n    return new CaptureFormat(previewSize.width, previewSize.height, fpsRange);\n  }\n  ```\n\n## Testing the logic before modifying the code:\n```java\nint diff(CaptureFormat.FramerateRange range) {\n    final int minFpsError \u003d progressivePenalty(\n        range.min, MIN_FPS_THRESHOLD, MIN_FPS_LOW_VALUE_WEIGHT, MIN_FPS_HIGH_VALUE_WEIGHT);\n    final int maxFpsError \u003d progressivePenalty(Math.abs(requestedFps * 1000 - range.max),\n        MAX_FPS_DIFF_THRESHOLD, MAX_FPS_LOW_DIFF_WEIGHT, MAX_FPS_HIGH_DIFF_WEIGHT);\n    return minFpsError + maxFpsError;\n}\n```\n\n## Log\n### Test Device: HUAWEI Mate 40 Pro\n\n```bash\n2024-06-03 15:46:48.383 31762-32759/com.webrtc.demo E/org.webrtc.Logging: Camera1Session: Desired capture fps: 15\n2024-06-03 15:46:48.384 31762-32759/com.webrtc.demo E/org.webrtc.Logging: Camera1Session: Available fps ranges: [[12.0:15.0], [15.0:15.0], [14.0:20.0], [20.0:20.0], [24.0:24.0], [14.0:25.0], [25.0:25.0], [14.0:30.0], [30.0:30.0]]\n2024-06-03 15:46:48.385 31762-32759/com.webrtc.demo E/org.webrtc.Logging: Camera1Session: getClosestSupportedFramerateRange:[12.0:15.0]\n```\n\nThe device Available fps : [[12.0:15.0], [15.0:15.0], [14.0:20.0], [20.0:20.0], [24.0:24.0], [14.0:25.0], [25.0:25.0], [14.0:30.0], [30.0:30.0]]\nand desired capture fps is 15, but it was match to [12.0:15.0]. It should be [15.0:15.0].\n\n### Test device: OPPO Find X3\n\n```bash\n2024-06-03 16:09:18.876 21051-29909/com.boss.vdomain E/org.webrtc.Logging: Camera1Session: Desired capture fps: 15\n2024-06-03 16:09:18.876 21051-29909/com.boss.vdomain E/org.webrtc.Logging: Camera1Session: Available fps ranges: [[10.0:15.0], [15.0:15.0], [15.0:20.0], [20.0:20.0], [10.0:30.0], [20.0:30.0], [30.0:30.0]]\n2024-06-03 16:09:18.877 21051-29909/com.boss.vdomain E/org.webrtc.Logging: Camera1Session: getClosestSupportedFramerateRange:[10.0:15.0]\n```\n\nFramerate range was match to [10.0:15.0]. It should be [15.0:15.0].\n\n---\n\n## Testing the logic after modifying the code:\n \n```java\nint diff(CaptureFormat.FramerateRange range) {\n    final int minFpsError \u003d progressivePenalty(Math.abs(requestedFps * 1000 - range.min),\n        MIN_FPS_THRESHOLD, MIN_FPS_LOW_VALUE_WEIGHT, MIN_FPS_HIGH_VALUE_WEIGHT);\n    final int maxFpsError \u003d progressivePenalty(Math.abs(requestedFps * 1000 - range.max),\n        MAX_FPS_DIFF_THRESHOLD, MAX_FPS_LOW_DIFF_WEIGHT, MAX_FPS_HIGH_DIFF_WEIGHT);\n    return minFpsError + maxFpsError;\n}\n```\n\n## Log\n\n### Test Device: HUAWEI Mate 40 Pro\n\n```bash\n2024-06-03 15:51:46.918 2239-3058/com.webrtc.demo E/org.webrtc.Logging: Camera1Session: Desired capture fps: 15\n2024-06-03 15:51:46.918 2239-3058/com.webrtc.demo E/org.webrtc.Logging: Camera1Session: Available fps ranges: [[12.0:15.0], [15.0:15.0], [14.0:20.0], [20.0:20.0], [24.0:24.0], [14.0:25.0], [25.0:25.0], [14.0:30.0], [30.0:30.0]]\n2024-06-03 15:51:46.918 2239-3058/com.webrtc.demo E/org.webrtc.Logging: Camera1Session: getClosestSupportedFramerateRange:[15.0:15.0]\n```\n\nIt was match to the right fps range: [15.0:15.0]\n\n \n### Test device: OPPO Find X3\n```bash\n2024-06-03 16:05:32.513 16298-29436/com.boss.vdomain E/org.webrtc.Logging: Camera1Session: Desired capture fps: 15\n2024-06-03 16:05:32.513 16298-29436/com.boss.vdomain E/org.webrtc.Logging: Camera1Session: Available fps ranges: [[10.0:15.0], [15.0:15.0], [15.0:20.0], [20.0:20.0], [10.0:30.0], [20.0:30.0], [30.0:30.0]]\n2024-06-03 16:05:32.514 16298-29436/com.boss.vdomain E/org.webrtc.Logging: Camera1Session: getClosestSupportedFramerateRange:[15.0:15.0]\n```\n\nIt was match to the right fps range: [15.0:15.0]",
      "parentUuid": "f7750e78_bffdd3e8",
      "revId": "157c245f53af0bbd8693c0f57cdd682d9e210d85",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "afb5ee13_e1f00356",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5508
      },
      "writtenOn": "2024-06-03T10:07:18Z",
      "side": 1,
      "message": "Thanks for the details.  I was referring to this part of the CL description:\n\n\"Fix Android camera error of obtaining FramerateRange closest to the set frame rate.\"\n\nI understood this as the CL was addressing a failure (i.e. error) but now I understand it\u0027s improving the matching to the desired framerate.\n\nNevertheless, I think it would be a good idea to file a bug on https://bugs.webrtc.org/ that describes what the problem is.\nThen mark this CL with a \"Bug: \u003cbug id\u003e\" line at the bottom of the CL description.\n\nMagnus - can you take a look?",
      "parentUuid": "2e3328a5_421539b7",
      "revId": "157c245f53af0bbd8693c0f57cdd682d9e210d85",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3ba5bb02_1a62773c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 3333013
      },
      "writtenOn": "2024-06-03T10:40:08Z",
      "side": 1,
      "message": "Sure, I have filed a bug. You can find the link here: https://issues.webrtc.org/issues/344491313.",
      "parentUuid": "afb5ee13_e1f00356",
      "revId": "157c245f53af0bbd8693c0f57cdd682d9e210d85",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    }
  ]
}