{
  "comments": [
    {
      "key": {
        "uuid": "52e81e31_5c442b4c",
        "filename": "rtc_base/bitrateallocationstrategy.cc",
        "patchSetId": 3
      },
      "lineNbr": 26,
      "author": {
        "id": 5087
      },
      "writtenOn": "2018-10-16T14:25:28Z",
      "side": 1,
      "message": "What error do you get if you remove the #ifndef?\n\nfield_trial::FindFullName is defined in Chromium (https://cs.chromium.org/chromium/src/third_party/webrtc_overrides/field_trial.cc?l\u003d11).",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 26,
        "endChar": 45
      },
      "revId": "636c9f983e088dafa0905eba1098e403788a1dfe",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3f6979bf_f1300a47",
        "filename": "rtc_base/bitrateallocationstrategy.cc",
        "patchSetId": 3
      },
      "lineNbr": 26,
      "author": {
        "id": 5087
      },
      "writtenOn": "2018-10-16T14:26:45Z",
      "side": 1,
      "message": "Here is it:\n\n[1273/10303] LINK ./capture_unittests\n  FAILED: capture_unittests \n  export DEVELOPER_DIR\u003d/b/s/w/ir/cache/builder/src/build/mac_files/Xcode.app;  TOOL_VERSION\u003d1539265388 ../../build/toolchain/mac/linker_driver.py ../../third_party/llvm-build/Release+Asserts/bin/clang++  -stdlib\u003dlibc++ -arch x86_64 -segprot PROTECTED_MEMORY rw r -Werror -isysroot ../../build/mac_files/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.12.sdk -mmacosx-version-min\u003d10.9.0 -Wl,-ObjC -L../../build/mac_files/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.12.sdk/usr/lib -o \"./capture_unittests\" -Wl,-filelist,\"./capture_unittests.rsp\"  -framework Cocoa -framework Foundation -framework IOKit -framework Security -framework SystemConfiguration -framework AVFoundation -framework CoreFoundation -framework CoreGraphics -framework CoreMedia -framework CoreVideo -framework ApplicationServices -framework AppKit -lbsm -framework AudioToolbox -framework AudioUnit -framework CoreAudio -framework CoreText -framework IOSurface -framework Carbon -framework OpenGL -framework Quartz -framework VideoToolbox -framework Accelerate -framework QuartzCore -framework CFNetwork -framework CoreServices -lresolv -lsandbox -framework DiskArbitration\n  Undefined symbols for architecture x86_64:\n    \"webrtc::field_trial::FindFullName(std::__1::basic_string\u003cchar, std::__1::char_traits\u003cchar\u003e, std::__1::allocator\u003cchar\u003e \u003e const\u0026)\", referenced from:\n        webrtc::AudioPriorityConfig::AudioPriorityConfig() in bitrateallocationstrategy.o\n  ld: symbol(s) not found for architecture x86_64\n  clang: error: linker command failed with exit code 1 (use -v to see invocation)\n  Traceback (most recent call last):\n    File \"../../build/toolchain/mac/linker_driver.py\", line 229, in \u003cmodule\u003e\n      Main(sys.argv)\n    File \"../../build/toolchain/mac/linker_driver.py\", line 79, in Main\n      subprocess.check_call(compiler_driver_args)\n    File \"/b/s/w/ir/cipd_bin_packages/lib/python2.7/subprocess.py\", line 186, in check_call\n      raise CalledProcessError(retcode, cmd)",
      "parentUuid": "52e81e31_5c442b4c",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 26,
        "endChar": 45
      },
      "revId": "636c9f983e088dafa0905eba1098e403788a1dfe",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "57fe3c7f_8ebb3de4",
        "filename": "rtc_base/bitrateallocationstrategy.cc",
        "patchSetId": 3
      },
      "lineNbr": 26,
      "author": {
        "id": 5087
      },
      "writtenOn": "2018-10-16T14:33:59Z",
      "side": 1,
      "message": "Mmmh, it seems the Chromium test binary needs to depend on https://cs.chromium.org/chromium/src/third_party/webrtc_overrides/BUILD.gn?l\u003d123-130\u0026rcl\u003d58b27e683493b046ec4aee4747e3fbf598a57df7.\n\nIt is difficult to enforce with the build system since it is a dependency on the definition.\nIn theory, Chromium should always depend on //third_party/webrtc_overrides:field_trial but for some reasons in this case it is not depending on it.",
      "parentUuid": "3f6979bf_f1300a47",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 26,
        "endChar": 45
      },
      "revId": "636c9f983e088dafa0905eba1098e403788a1dfe",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1ef35320_a53c9933",
        "filename": "rtc_base/bitrateallocationstrategy.cc",
        "patchSetId": 3
      },
      "lineNbr": 26,
      "author": {
        "id": 5087
      },
      "writtenOn": "2018-10-16T14:50:10Z",
      "side": 1,
      "message": "It only fails on the Mac build.\n\nI need to test on macOS but if there is a path between capture_unittests and WebRTC internals (I suspect desktop_capture), then somewhere in that path there should be a dependency on //third_party/webrtc_overrides.\n\nHere is the command I will run to debug:\n$ gn path out/Debug //media/capture:capture_unittests //third_party/webrtc/modules/desktop_capture:desktop_capture\n\nI will be back on this later.",
      "parentUuid": "57fe3c7f_8ebb3de4",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 26,
        "endChar": 45
      },
      "revId": "636c9f983e088dafa0905eba1098e403788a1dfe",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6fe97c9e_f1afdcb2",
        "filename": "rtc_base/bitrateallocationstrategy.cc",
        "patchSetId": 3
      },
      "lineNbr": 26,
      "author": {
        "id": 5087
      },
      "writtenOn": "2018-10-16T15:00:48Z",
      "side": 1,
      "message": "$ gn path out/Debug //media/capture:capture_unittests //third_party/webrtc/rtc_base:rtc_base_approved\n//media/capture:capture_unittests --[private]--\u003e\n//media:test_support --[public]--\u003e\n//media/gpu:test_support --[private]--\u003e\n//media/gpu:gpu --[public]--\u003e\n//third_party/webrtc/common_video:common_video --[private]--\u003e\n//third_party/webrtc/api/video:encoded_image --[private]--\u003e\n//third_party/webrtc/rtc_base:rtc_base_approved\n\nIt comes from here: https://cs.chromium.org/chromium/src/media/gpu/BUILD.gn?l\u003d140\u0026rcl\u003da55414af4fda5ae7f62781925783ee6728d0c341.\n\nThese kind of issues will go away with the component build. I will try to fix tomorrow.",
      "parentUuid": "1ef35320_a53c9933",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 26,
        "endChar": 45
      },
      "revId": "636c9f983e088dafa0905eba1098e403788a1dfe",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "593b4c1a_fa026972",
        "filename": "rtc_base/bitrateallocationstrategy.cc",
        "patchSetId": 3
      },
      "lineNbr": 26,
      "author": {
        "id": 5087
      },
      "writtenOn": "2018-10-17T07:48:24Z",
      "side": 1,
      "message": "This will fix: https://chromium-review.googlesource.com/c/chromium/src/+/1286410.\n\nPlease remove the #ifndef.",
      "parentUuid": "6fe97c9e_f1afdcb2",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 26,
        "endChar": 45
      },
      "revId": "636c9f983e088dafa0905eba1098e403788a1dfe",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    }
  ]
}