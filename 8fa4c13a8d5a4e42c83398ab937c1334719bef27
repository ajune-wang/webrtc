{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "798f3e6f_8187c5f1",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 16,
      "author": {
        "id": 18474
      },
      "writtenOn": "2023-03-22T16:55:05Z",
      "side": 1,
      "message": "So to clarify; we\u0027re now saying that if the compositor doesn\u0027t support the renogtiation process we just fall back to MemFD? And the current state is that if they didn\u0027t support renogiation they were just broken?",
      "range": {
        "startLine": 14,
        "startChar": 46,
        "endLine": 16,
        "endChar": 9
      },
      "revId": "8fa4c13a8d5a4e42c83398ab937c1334719bef27",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d7bf2fb9_0a711886",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 16,
      "author": {
        "id": 8046
      },
      "writtenOn": "2023-03-22T17:24:01Z",
      "side": 1,
      "message": "We are saying that we don\u0027t support DmaBufs used by old compositors that don\u0027t implemented it according to: https://gitlab.freedesktop.org/pipewire/pipewire/-/blob/master/doc/dma-buf.dox\n\nTo make it short, we require DmaBufs modifiers to be announced by the server in order to use DmaBufs. We didn\u0027t require it before to support old compositors that didn\u0027t implement this new DmaBuf negotiation process. Also compositors that don\u0027t use this will definitely not support renegotiation as this is something PipeWire introduced with the new DmaBuf negotiation process. Not supporting renegotiation means that if we fail to import DmaBufs (without a modifier) provided by an old compositor, we will never recover (or fallback to anything else), because there is no way to renegotiate, while when we use MemFD buffers (even though there are less effecient), we are at least making sure it will work all the time.",
      "parentUuid": "798f3e6f_8187c5f1",
      "range": {
        "startLine": 14,
        "startChar": 46,
        "endLine": 16,
        "endChar": 9
      },
      "revId": "8fa4c13a8d5a4e42c83398ab937c1334719bef27",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "eadaaab4_b44b4c73",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 16,
      "author": {
        "id": 18474
      },
      "writtenOn": "2023-03-22T17:31:23Z",
      "side": 1,
      "message": "Got it. So after this change if we fail to import DmaBufs we will fallback to MemFD buffers and previously we did not.",
      "parentUuid": "d7bf2fb9_0a711886",
      "range": {
        "startLine": 14,
        "startChar": 46,
        "endLine": 16,
        "endChar": 9
      },
      "revId": "8fa4c13a8d5a4e42c83398ab937c1334719bef27",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9f64ddb6_fb5dc0f0",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 16,
      "author": {
        "id": 8046
      },
      "writtenOn": "2023-03-22T19:37:43Z",
      "side": 1,
      "message": "I\u0027m sorry, I\u0027m sometimes bad at explaining things. \n\nIn the past we would either settle on DmaBufs or MemFD buffers, not having an option to fallback in case we fail for some reason. This was not even supported by PipeWire before. Now, with the new DmaBuf support where modifiers are mandatory, we have a way to try something else, because it\u0027s part of the process where we try one of the modifiers, drop it if we fail and try another one or fallback to MemFD buffers in case we run out of modifiers. \n\nThis change avoids using DmaBufs in the first case, where only one or the other buffer type can be used without having option to renegotiate, because this will not be supported by the compositor. I believe it\u0027s better to use less efficient, but reliable screen sharing rather than trying to use more efficient buffers that have no guarantee to work. This also has a potential benefit for modern compositors, because  advertising DmaBuf support without modifiers might be confusing for potentially buggy implementation on their side.",
      "parentUuid": "eadaaab4_b44b4c73",
      "range": {
        "startLine": 14,
        "startChar": 46,
        "endLine": 16,
        "endChar": 9
      },
      "revId": "8fa4c13a8d5a4e42c83398ab937c1334719bef27",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b1d31737_833eb52d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 18,
      "author": {
        "id": 18474
      },
      "writtenOn": "2023-03-22T16:55:05Z",
      "side": 1,
      "message": "We should file new bugs for the individual issues we\u0027re fixing now that it\u0027s shipped for better tracking.",
      "range": {
        "startLine": 18,
        "startChar": 5,
        "endLine": 18,
        "endChar": 17
      },
      "revId": "8fa4c13a8d5a4e42c83398ab937c1334719bef27",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "76b35868_fdbf33d0",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 18,
      "author": {
        "id": 8046
      },
      "writtenOn": "2023-03-22T17:24:01Z",
      "side": 1,
      "message": "Yes, we should, I was me just being lazy ðŸ˜Š\n\nI\u0027ll open a new one.",
      "parentUuid": "b1d31737_833eb52d",
      "range": {
        "startLine": 18,
        "startChar": 5,
        "endLine": 18,
        "endChar": 17
      },
      "revId": "8fa4c13a8d5a4e42c83398ab937c1334719bef27",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5c7cd95c_9aa3d430",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 18474
      },
      "writtenOn": "2023-03-22T16:55:05Z",
      "side": 1,
      "message": "LGTM, but want some clarity on the commit description",
      "revId": "8fa4c13a8d5a4e42c83398ab937c1334719bef27",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    }
  ]
}