{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "1f5a9989_9c6b62d4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 5634
      },
      "writtenOn": "2020-12-07T10:36:20Z",
      "side": 1,
      "message": "I don\u0027t think this is a right solution for stats. WDYT about moving the array-building functions\ninside the worker-thread section of rtc_stats_collector?\n\n(Differentiating between the thread-jumping and non-jumping media_channel() function would require making changes to the API interface class, unlike in the other CL. Still considering that.)\n",
      "revId": "87b24b85a647aef8ec83f85366f325de845d09e3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7ed923cc_2ce1c5b3",
        "filename": "pc/channel.h",
        "patchSetId": 1
      },
      "lineNbr": 187,
      "author": {
        "id": 5142
      },
      "writtenOn": "2020-12-07T11:01:03Z",
      "side": 1,
      "message": "What is the plan here? To me it looks like we are increasing the number of thread jumps without actually providing safety.\n\nIf the channel really is to only be used on the worker thread, then doing a block-invoke to get the pointer, only to leak the raw pointer to a non-worker thread where it is de-referenced, isn\u0027t doing much good.\n\nIf on the other hand there is something about the existing calling places to media_channel() that implicitly ensures that the media_channel() is safe to use - for example maybe we are currently on the signaling thread and so we KNOW that we are currently not coordinating the destruction of any media channels - then perhaps there is no need to block the thread here anyway. And in light of the many performance and threading issues, I would be very hesitant to add blocking-invokes without race conditions identified.\n\nIn order to proceed with this code review, can you explain what the life-time is of the media channel and why this block-invoke is a good thing? I am currently operating under the assumption that media channels are created or destroyed by blocking-invokes from the signaling thread, which means that the signaling thread could potentially grab the raw pointer safely without block-invoke. It\u0027s ugly to have code make assumptions about life-time like this, but blocking-invokes are expensive.\n\nPlease clarify maybe my understanding is incorrect.",
      "revId": "87b24b85a647aef8ec83f85366f325de845d09e3",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    }
  ]
}