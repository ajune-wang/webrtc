{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "fe9997c2_cbe36c1e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 3350241
      },
      "writtenOn": "2024-09-04T22:36:38Z",
      "side": 1,
      "message": "davidben: one code question below (and I need a second +1).\n\nLooks like Chrome in general removed 1024 bit RSA key support in 2017 already which should make it easy to justify the removal in WebRTCs generateCertificate.",
      "revId": "d829f347745dbe79ddca6091226459adf5169cc7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dd48e4fe_3add8f82",
        "filename": "rtc_base/openssl_stream_adapter.cc",
        "patchSetId": 11
      },
      "lineNbr": 1213,
      "author": {
        "id": 5602
      },
      "writtenOn": "2024-09-04T22:58:52Z",
      "side": 1,
      "message": "I mean, this works, but it\u0027s kind of weird that all the other ifdefs use the `TLS1_CK_` constant while this uses the `TLS1_RFC` constant.\n\n```suggestion\n#elif defined(TLS1_CK_ECDHE_ECDSA_WITH_CHACHA20_POLY1305)  // OpenSSL.\n```\n\nAlso, ugh, why did OpenSSL go against the IANA naming convention here? The actual name of the cipher suite is ..._CHACHA20_POLY1305_SHA256, because they put the PRF hashes in.\n\nI mean, I could go define the other one in BoringSSL for OpenSSL compatibility. Probably should. (To that end, that\u0027s why I\u0027m suggesting `#elif`. Otherwise, if BoringSSL defines both, this code will get confused.)",
      "range": {
        "startLine": 1212,
        "startChar": 0,
        "endLine": 1213,
        "endChar": 63
      },
      "revId": "d829f347745dbe79ddca6091226459adf5169cc7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3255f6af_cc1ddb97",
        "filename": "rtc_base/openssl_stream_adapter.cc",
        "patchSetId": 11
      },
      "lineNbr": 1213,
      "author": {
        "id": 3350241
      },
      "writtenOn": "2024-09-05T17:11:48Z",
      "side": 1,
      "message": "manually applied",
      "parentUuid": "dd48e4fe_3add8f82",
      "range": {
        "startLine": 1212,
        "startChar": 0,
        "endLine": 1213,
        "endChar": 63
      },
      "revId": "d829f347745dbe79ddca6091226459adf5169cc7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c7fba1c5_9ccbcd3a",
        "filename": "rtc_base/openssl_stream_adapter.cc",
        "patchSetId": 11
      },
      "lineNbr": 1228,
      "author": {
        "id": 5602
      },
      "writtenOn": "2024-09-04T22:58:52Z",
      "side": 1,
      "message": "```suggestion\n#elif defined(TLS1_CK_ECDHE_ECDSA_WITH_CHACHA20_POLY1305)  // OpenSSL.\n```\n\nditto.",
      "range": {
        "startLine": 1227,
        "startChar": 0,
        "endLine": 1228,
        "endChar": 62
      },
      "revId": "d829f347745dbe79ddca6091226459adf5169cc7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "638f307d_b69309b5",
        "filename": "rtc_base/openssl_stream_adapter.cc",
        "patchSetId": 11
      },
      "lineNbr": 1228,
      "author": {
        "id": 3350241
      },
      "writtenOn": "2024-09-05T17:11:48Z",
      "side": 1,
      "message": "manually applied",
      "parentUuid": "c7fba1c5_9ccbcd3a",
      "range": {
        "startLine": 1227,
        "startChar": 0,
        "endLine": 1228,
        "endChar": 62
      },
      "revId": "d829f347745dbe79ddca6091226459adf5169cc7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e84dbbc4_3c25938c",
        "filename": "rtc_base/openssl_stream_adapter.cc",
        "patchSetId": 11
      },
      "lineNbr": 1234,
      "author": {
        "id": 5602
      },
      "writtenOn": "2024-09-05T15:35:59Z",
      "side": 1,
      "message": "Better yet, delete all this code and replace it with `SSL_CIPHER_get_auth_nid`.\n\nAlthough there\u0027s a deeper problem here which is that RSA vs ECDSA is much, much more complicated than looking at the cipher suite. In fact this code is already incompatible with (D)TLS 1.3, which you all will need to move to for postquantum. (We\u0027re working on DTLS 1.3 implementation for BoringSSL right now.) (D)TLS 1.3 uses the signature algorithms to negotiate the certificate type.\n\nThough I also see no callers for this, so I\u0027m a little confused what this is for. Is this public API? That may be a problem as this public API will be unsalvageable.\n\nFor dispatching between RSA and ECDSA, BoringSSL has the SSL_CREDENTIAL API:\nhttps://commondatastorage.googleapis.com/chromium-boringssl-docs/ssl.h.html#Credentials\n\nThis API doesn\u0027t exist in OpenSSL, however. OpenSSL has some very weird behavior (that BoringSSL does not have, as it\u0027s kinda broken will things like intermediates and OCSP staples) where you can install one RSA key and one ECDSA key because the APIs to configure things secretly go into different slots. But it\u0027s super buggy because it\u0027s very easy to mix up additional information like the intermediates.",
      "revId": "d829f347745dbe79ddca6091226459adf5169cc7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "64314e79_de981b95",
        "filename": "rtc_base/openssl_stream_adapter.cc",
        "patchSetId": 11
      },
      "lineNbr": 1234,
      "author": {
        "id": 3350241
      },
      "writtenOn": "2024-09-05T17:11:48Z",
      "side": 1,
      "message": "Even better, delete all this code!\n\nI do not see why WebRTC would restrict the TLS cipher suites in either IETF or W3C specs, it should (and hopefully does) just reference them and then hope the TLS libraries do the right thing.\n\nWill do as a separate CL since there are a few of unit tests that reference it.",
      "parentUuid": "e84dbbc4_3c25938c",
      "revId": "d829f347745dbe79ddca6091226459adf5169cc7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e804ea58_b6dacd57",
        "filename": "rtc_base/openssl_stream_adapter.cc",
        "patchSetId": 11
      },
      "lineNbr": 1234,
      "author": {
        "id": 5602
      },
      "writtenOn": "2024-09-05T17:21:26Z",
      "side": 1,
      "message": "Ah yeah, I see this is just used in tests. I assumed this was an API for picking RSA vs ECDSA certificates. Yeah, deleting it entirely sounds great!",
      "parentUuid": "64314e79_de981b95",
      "revId": "d829f347745dbe79ddca6091226459adf5169cc7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e115233f_30d84500",
        "filename": "rtc_base/ssl_stream_adapter_unittest.cc",
        "patchSetId": 11
      },
      "lineNbr": 1173,
      "author": {
        "id": 3350241
      },
      "writtenOn": "2024-09-04T22:36:38Z",
      "side": 1,
      "message": "davidben: maybe you know a better define for this than \"we are using BoringSSL\".",
      "revId": "d829f347745dbe79ddca6091226459adf5169cc7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "aaaeda44_2cbbd84b",
        "filename": "rtc_base/ssl_stream_adapter_unittest.cc",
        "patchSetId": 11
      },
      "lineNbr": 1173,
      "author": {
        "id": 5602
      },
      "writtenOn": "2024-09-04T22:58:52Z",
      "side": 1,
      "message": "Er, what\u0027s the context here? SHA-1 and SHA-224 are also implemented in OpenSSL...",
      "parentUuid": "e115233f_30d84500",
      "revId": "d829f347745dbe79ddca6091226459adf5169cc7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a9d854ee_a1114ba4",
        "filename": "rtc_base/ssl_stream_adapter_unittest.cc",
        "patchSetId": 11
      },
      "lineNbr": 1173,
      "author": {
        "id": 3350241
      },
      "writtenOn": "2024-09-05T17:11:48Z",
      "side": 1,
      "message": "These two break in OpenSSL because OpenSSL 3.x deprecates SHA1 for cert signatures. On some Linux distributions (Ubuntu; not Fedora; different \"security levels\" I thnk). Yet  SHA_DIGEST_LENGTH and SHA224_DIGEST_LENGTH are still defined.\n\nI have not yet seen a good define for this and it seems weird that BoringSSL is putting up with it whe OpenSSL no longer does.",
      "parentUuid": "aaaeda44_2cbbd84b",
      "revId": "d829f347745dbe79ddca6091226459adf5169cc7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e38e0c00_9ce6ce1c",
        "filename": "rtc_base/ssl_stream_adapter_unittest.cc",
        "patchSetId": 11
      },
      "lineNbr": 1173,
      "author": {
        "id": 5602
      },
      "writtenOn": "2024-09-05T17:19:23Z",
      "side": 1,
      "message": "Oh yeah the \"security level\" stuff is kinda incoherent and not very well thought through.\n\nBoringSSL has to put up with it because a bunch of projects, like this one, write tests that assert that they need it to work. :P\n\nIf WebRTC needs these to work, it should presumably configure OpenSSL 3.x with a \"security level\" that makes those work. If WebRTC doesn\u0027t need these to work, it shouldn\u0027t wire it up and test it. Which is it?",
      "parentUuid": "a9d854ee_a1114ba4",
      "revId": "d829f347745dbe79ddca6091226459adf5169cc7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1ef86a22_7c3d0aef",
        "filename": "rtc_base/ssl_stream_adapter_unittest.cc",
        "patchSetId": 11
      },
      "lineNbr": 1173,
      "author": {
        "id": 3350241
      },
      "writtenOn": "2024-09-05T17:51:02Z",
      "side": 1,
      "message": "That inconsistency is what I figured out trying to get it to run on different operating systems. What made me discover this particular thing is that we are in the process of adding a bot to run the OpenSSL variant (which as you probably noticed turned out to be quite a rabbithole)\n\nIf BoringSSL provides more test coverage we\u0027ll take that and revisit once it breaks the roll. Added a comment.",
      "parentUuid": "e38e0c00_9ce6ce1c",
      "revId": "d829f347745dbe79ddca6091226459adf5169cc7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "25ade499_1860a86e",
        "filename": "rtc_base/ssl_stream_adapter_unittest.cc",
        "patchSetId": 11
      },
      "lineNbr": 1173,
      "author": {
        "id": 5602
      },
      "writtenOn": "2024-09-06T19:10:34Z",
      "side": 1,
      "message": "\u003e and revisit once it breaks the roll.\n\nThat is not how we do things. Once we land a change into BoringSSL, the autoroller will pull it into Chromium. If WebRTC breaks, that holds back *all* BoringSSL updates from Chromium.\n\nAs such, for things like this, the expectation is that downstream code\u0027s test accurate reflects what it actually wants. As long as WebRTC has SHA-1 tests here, the interpretation is that WebRTC actively wants to support SHA-1.\n\nSo, again, *what does WebRTC want to support in this context*? You all need to have a clear position here. The choices are:\n\n1. WebRTC wants SHA-1 to work here.\n2. WebRTC does not want SHA-1 to work here.\n\nIf you pick 1, you should remove this ifdef. Rather, the remediation for OpenSSL is to change how you call OpenSSL so that the tests pass.\n\nIF you pick 2, you should remove this ifdef and remove the tests, in both OpenSSL and BoringSSL.",
      "parentUuid": "1ef86a22_7c3d0aef",
      "revId": "d829f347745dbe79ddca6091226459adf5169cc7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "51e2387a_535eb1f7",
        "filename": "rtc_base/ssl_stream_adapter_unittest.cc",
        "patchSetId": 11
      },
      "lineNbr": 1173,
      "author": {
        "id": 5634
      },
      "writtenOn": "2024-09-07T23:51:55Z",
      "side": 1,
      "message": "Do we UMA cert sigs?\nI think the SSLCipherSuite UMA (where video SHA is 0.3% and falling) is measuring the handshake sig, not the cert sig.",
      "parentUuid": "25ade499_1860a86e",
      "revId": "d829f347745dbe79ddca6091226459adf5169cc7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ff587b62_36b4ea17",
        "filename": "rtc_base/ssl_stream_adapter_unittest.cc",
        "patchSetId": 11
      },
      "lineNbr": 1173,
      "author": {
        "id": 3350241
      },
      "writtenOn": "2024-09-09T18:18:39Z",
      "side": 1,
      "message": "The BoringSSL roll into Chromium should (hopefully) not break since these tests are not built or run in Chromium.\nThe BoringSSL roll into WebRTC would already break if BoringSSL were to remove support, this CL does not change that. It will however provide a breadcrumb to whoever finds this discussion who can then say \"away with it\" and unbreak the the roll.\n\nWhich in turn might lead to production failures if anyone is still using it; Changes like https://github.com/versatica/mediasoup/pull/1450 will need time to trickle down. I\u0027ll check if we can measure the cert signature.\n\nhta: should the position discussion go onto the IETF avtcore (?) WG or the W3C WebRTC WG?",
      "parentUuid": "51e2387a_535eb1f7",
      "revId": "d829f347745dbe79ddca6091226459adf5169cc7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4c355de4_f3f611ce",
        "filename": "rtc_base/ssl_stream_adapter_unittest.cc",
        "patchSetId": 11
      },
      "lineNbr": 1173,
      "author": {
        "id": 5634
      },
      "writtenOn": "2024-09-09T18:30:40Z",
      "side": 1,
      "message": "I think the \"should we refuse to support SHA-1 certs in webrtc\" discussion should be dispatched in the WIT area of the IETF. Which group to have the discussion in is unclear to me, since it straddles multiple areas of concern.",
      "parentUuid": "ff587b62_36b4ea17",
      "revId": "d829f347745dbe79ddca6091226459adf5169cc7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9e594a0c_a5cc7e29",
        "filename": "rtc_base/ssl_stream_adapter_unittest.cc",
        "patchSetId": 11
      },
      "lineNbr": 1173,
      "author": {
        "id": 5602
      },
      "writtenOn": "2024-09-09T18:35:50Z",
      "side": 1,
      "message": "Wait, is this the signature on the certificate (the irrelevant self-signature in the certificate itself) or the hash of the certificate that you all use to authenticate?\n\nAs I answered in https://issues.webrtc.org/issues/42225856#comment12, the signature on the certificate is basically always irrelevant. Is WebRTC checking those signatures? If so, why?\n\nIf it\u0027s the hash of the certificate, that is certainly security-relevant and you all should get SHA-1 out of there. But that has nothing to do with this mediasoup change.\n\nEither way, the question I asked is not a forward-facing one. Does WebRTC, **TODAY** care about supporting SHA-1 and SHA-224 in whatever this context is?\n\nIf the answer is yes, you should fix this by making things work in OpenSSL too.\nIf the answer is no, you should remove it.\nIf removing it would be a behavior change that you need to ask the IETF about, it sounds like the answer for *today* is yes and you should fix the code to enable these hashes in OpenSSL too.\n\nIn none of these outcomes should WebRTC have a BoringSSL vs OpenSSL ifdef.",
      "parentUuid": "4c355de4_f3f611ce",
      "revId": "d829f347745dbe79ddca6091226459adf5169cc7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "04098af2_5f9a195f",
        "filename": "rtc_base/ssl_stream_adapter_unittest.cc",
        "patchSetId": 11
      },
      "lineNbr": 1173,
      "author": {
        "id": 5602
      },
      "writtenOn": "2024-09-09T18:40:52Z",
      "side": 1,
      "message": "Ohhhhhhh...\n\nDoes WebRTC use the hash function of the (otherwise irrelevant) self-signature to determine the fingerprint hash? I.e. you all don\u0027t specify it explicitly elsewhere?\n\nhttps://source.chromium.org/chromium/chromium/src/+/main:third_party/webrtc/rtc_base/ssl_fingerprint.cc;l\u003d82-98;drc\u003d8e948282d37c0e119e3102236878d6f4d5052c16;bpv\u003d1;bpt\u003d1\n\nIn that case, yes, that mediasoup change is quite important. Although this is also a precarious place to be in with PQ transitions and whatnot because the self signature will become wasteful enough that you\u0027ll want to get rid of it.\n\nBut, again, for this CL, we only need an answer about today. It sounds like today WebRTC might indeed need SHA-1?",
      "parentUuid": "9e594a0c_a5cc7e29",
      "revId": "d829f347745dbe79ddca6091226459adf5169cc7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ba1cb193_06e3edbc",
        "filename": "rtc_base/ssl_stream_adapter_unittest.cc",
        "patchSetId": 11
      },
      "lineNbr": 1173,
      "author": {
        "id": 3350241
      },
      "writtenOn": "2024-09-09T20:40:43Z",
      "side": 1,
      "message": "The test was failing in OpenSSL because of the self-signature with SHA1. Sadly trying to dig deeper I can no longer reproduce so removed the ifdef. Sorry for the confusion!\n\nWe (well, I at least) do not *care* about SHA1 fingerprints in the SDP but we do still have the 0.3% of usage of\nhttps://source.chromium.org/chromium/chromium/src/+/main:tools/metrics/histograms/metadata/web_rtc/histograms.xml;l\u003d1435?q\u003dSSLCipherSuite%20histograms\u0026ss\u003dchromium\nand no good way to find out who is responsible.\nAnd we have \"cross-browser support\" (at least for parsing the fingerprint, whether it works in practice is a different matter but we can not test that with WPT):\nhttps://wpt.fyi/results/webrtc/protocol/dtls-fingerprint-validation.html?label\u003dexperimental\u0026label\u003dmaster\u0026aligned for parsing.\n\nMight require throwing and see who complains.",
      "parentUuid": "04098af2_5f9a195f",
      "revId": "d829f347745dbe79ddca6091226459adf5169cc7",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    }
  ]
}