/*
 *  Copyright (c) 2018 The WebRTC project authors. All Rights Reserved.
 *
 *  Use of this source code is governed by a BSD-style license
 *  that can be found in the LICENSE file in the root of the source
 *  tree. An additional intellectual property rights grant can be found
 *  in the file PATENTS.  All contributing project authors may
 *  be found in the AUTHORS file in the root of the source tree.
 */

#include <array>

#include "common_audio/rnn_vad/common.h"
#include "common_audio/rnn_vad/lp_residual.h"
#include "common_audio/rnn_vad/test_utils.h"
#include "test/fpe_observer.h"
#include "test/gtest.h"

namespace webrtc {
namespace test {

using rnn_vad::ComputeInverseFilterCoefficients;
using rnn_vad::ComputeLpResidual;
using rnn_vad::kFrameSize10ms24kHz;
using rnn_vad::kNumLpcCoefficients;

namespace {

const std::array<float, 864> kAudioFrame24kHzSamples = {
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    1.12349625e+01,  1.33808184e+01,  7.28402424e+00,  1.98561263e+00,
    1.22441471e+00,  8.70122337e+00,  2.18569794e+01,  3.71458206e+01,
    4.20801544e+01,  4.24854317e+01,  3.96427956e+01,  3.80702744e+01,
    3.47618103e+01,  3.22263756e+01,  2.79629078e+01,  2.67323647e+01,
    2.79955711e+01,  2.00206108e+01,  1.90984993e+01,  1.71789970e+01,
    1.72771301e+01,  1.96117878e+01,  2.11840324e+01,  2.37368813e+01,
    2.35254173e+01,  2.53106995e+01,  2.10887432e+01,  1.74056530e+01,
    1.12482853e+01,  5.90063334e+00,  1.20644016e+01,  1.41885014e+01,
    2.27800522e+01,  1.80731506e+01,  2.21510773e+01,  2.76765633e+01,
    2.61788578e+01,  3.09290428e+01,  2.71501045e+01,  2.31602554e+01,
    1.81963463e+01,  1.25293484e+01,  8.64809132e+00,  8.08495283e-01,
    -4.78564024e-01, 4.87671614e-01,  8.18515015e+00,  1.38178558e+01,
    1.71630421e+01,  1.54868517e+01,  1.30814285e+01,  1.11886873e+01,
    6.32062626e+00,  8.47915745e+00,  1.03641205e+01,  1.14906235e+01,
    1.60986671e+01,  2.16682796e+01,  3.31825485e+01,  4.53455658e+01,
    5.06726913e+01,  5.07182884e+01,  4.97635117e+01,  4.48213882e+01,
    4.11689377e+01,  3.47930260e+01,  3.09706230e+01,  3.01645050e+01,
    2.56226368e+01,  2.41120033e+01,  2.13634834e+01,  2.13800430e+01,
    1.59056454e+01,  1.62193012e+01,  1.85178032e+01,  1.95562248e+01,
    2.53205547e+01,  2.58008804e+01,  3.22653160e+01,  2.89378910e+01,
    2.86448689e+01,  2.98340416e+01,  2.37895603e+01,  2.65203629e+01,
    2.22383289e+01,  1.89955959e+01,  2.05149879e+01,  2.05224380e+01,
    2.15310135e+01,  2.62706680e+01,  2.47294540e+01,  2.32085648e+01,
    2.49338799e+01,  1.74154625e+01,  1.81973534e+01,  1.52172947e+01,
    1.12724237e+01,  7.35260105e+00,  2.97078657e+00,  8.35280418e+00,
    6.94854927e+00,  8.06022072e+00,  1.26466827e+01,  1.17110462e+01,
    1.65233955e+01,  2.10426731e+01,  2.82740250e+01,  3.44425201e+01,
    3.90663986e+01,  4.04058151e+01,  3.77429390e+01,  3.63488274e+01,
    3.79593964e+01,  3.75536118e+01,  3.36615791e+01,  3.30422745e+01,
    2.96806107e+01,  2.70946045e+01,  2.32791672e+01,  2.29912605e+01,
    2.34447346e+01,  1.86606750e+01,  2.09000454e+01,  1.91227188e+01,
    1.86158237e+01,  2.40932178e+01,  2.30379448e+01,  2.64891644e+01,
    3.03997746e+01,  3.02949677e+01,  3.84217682e+01,  4.09861832e+01,
    4.42864914e+01,  4.90476837e+01,  4.67849426e+01,  4.75363998e+01,
    4.80249672e+01,  4.40217514e+01,  4.60337143e+01,  3.75438156e+01,
    2.96312141e+01,  2.57625923e+01,  1.49428625e+01,  1.36938944e+01,
    1.51923494e+01,  1.59322367e+01,  1.74125748e+01,  1.63854103e+01,
    1.88607788e+01,  1.78176460e+01,  1.55401411e+01,  1.35251942e+01,
    5.03981686e+00,  1.17975235e-01,  -7.76155663e+00, -1.43268719e+01,
    -1.70982094e+01, -1.88487473e+01, -2.08345566e+01, -2.18036842e+01,
    -1.67762299e+01, -1.62852325e+01, -1.15455265e+01, -8.63216400e-01,
    4.49386024e+00,  8.06399536e+00,  1.41003008e+01,  1.80888577e+01,
    1.95538635e+01,  2.42483826e+01,  2.36614742e+01,  1.98383255e+01,
    1.70429039e+01,  1.15231285e+01,  9.04595375e+00,  9.07818890e+00,
    6.61681175e+00,  5.92080879e+00,  5.23112869e+00,  6.54173946e+00,
    6.59363461e+00,  8.14384842e+00,  8.92936325e+00,  7.46526051e+00,
    8.75753593e+00,  1.02871418e+01,  1.25551300e+01,  1.62975082e+01,
    1.67683792e+01,  1.82318230e+01,  2.09328537e+01,  2.66044807e+01,
    2.94807739e+01,  3.05909309e+01,  2.86930199e+01,  2.40671215e+01,
    1.94792023e+01,  1.76701317e+01,  1.38768110e+01,  7.62123299e+00,
    5.15728760e+00,  -1.78218079e+00, -1.04071760e+01, -1.84679012e+01,
    -2.64595299e+01, -3.33913002e+01, -3.97643967e+01, -4.20950470e+01,
    -4.66503983e+01, -4.69245377e+01, -4.84466248e+01, -4.82016449e+01,
    -4.74657021e+01, -4.92217369e+01, -4.59748154e+01, -4.54969826e+01,
    -4.05271797e+01, -3.98444214e+01, -3.91555367e+01, -3.34876099e+01,
    -3.40995941e+01, -2.87143631e+01, -2.56219845e+01, -2.35452728e+01,
    -1.92442131e+01, -1.84667130e+01, -1.56996918e+01, -1.56981277e+01,
    -1.34499636e+01, -1.39662027e+01, -1.19767733e+01, -7.51375580e+00,
    -6.57705307e+00, -6.64857292e+00, -8.70925045e+00, -6.76514339e+00,
    -7.82927418e+00, -5.88960552e+00, -5.71417809e+00, -5.03792763e+00,
    -5.86787128e+00, -6.68595219e+00, -4.50624943e+00, -3.58976841e+00,
    -2.68447113e+00, -8.27227402e+00, -1.05641451e+01, -8.10532188e+00,
    -1.14007874e+01, -1.01775055e+01, -1.22115755e+01, -1.09779339e+01,
    -1.10106955e+01, -1.30307503e+01, -1.17941656e+01, -1.33119783e+01,
    -1.38171520e+01, -1.63167305e+01, -1.85427074e+01, -1.97531738e+01,
    -1.89582024e+01, -2.06628151e+01, -1.83600082e+01, -1.65768547e+01,
    -1.55522747e+01, -1.07952747e+01, -1.08178110e+01, -7.34075356e+00,
    -3.64916420e+00, -3.97489071e+00, -3.55086231e+00, -3.12606716e+00,
    5.32444954e-01,  -2.57125092e+00, -3.15407276e+00, -4.73210907e+00,
    -5.79636574e+00, -6.10489845e+00, -6.65872192e+00, -3.71487045e+00,
    -4.04136181e+00, -4.86008930e+00, -3.67809200e+00, -2.25337791e+00,
    -9.49497223e-02, 3.29824543e+00,  9.90320683e+00,  1.09650621e+01,
    1.10240097e+01,  1.38260422e+01,  1.81011505e+01,  1.85964241e+01,
    1.93410053e+01,  2.18218651e+01,  1.77940712e+01,  1.70477180e+01,
    1.60496483e+01,  1.43169107e+01,  1.53374290e+01,  1.13592100e+01,
    1.09092875e+01,  6.96253681e+00,  2.05701828e+00,  -8.19418907e-01,
    -7.41183662e+00, -9.46133995e+00, -1.94830723e+01, -3.01630096e+01,
    -3.37755051e+01, -4.25988007e+01, -4.93499718e+01, -5.60482712e+01,
    -6.46858521e+01, -7.12549057e+01, -7.45236816e+01, -7.50223923e+01,
    -7.77591248e+01, -8.14679108e+01, -8.04008789e+01, -8.08431702e+01,
    -8.30177002e+01, -7.79386139e+01, -7.76419678e+01, -7.68385925e+01,
    -7.30495911e+01, -7.10319214e+01, -6.40355530e+01, -5.70974960e+01,
    -5.04585648e+01, -4.23756409e+01, -3.26065750e+01, -2.26682205e+01,
    -1.45523043e+01, -4.00661945e+00, 3.45803261e+00,  7.37295914e+00,
    1.00083399e+01,  1.33712749e+01,  1.12128372e+01,  5.83519459e+00,
    5.23823166e+00,  -9.61599350e-02, 1.10601616e+00,  3.78654671e+00,
    6.45353222e+00,  1.53319511e+01,  2.26418762e+01,  3.01415386e+01,
    3.68331375e+01,  4.54628372e+01,  4.70368576e+01,  5.45894241e+01,
    6.18225174e+01,  6.65064087e+01,  7.71362381e+01,  8.24351501e+01,
    8.84424744e+01,  9.43933182e+01,  9.83009033e+01,  1.03916367e+02,
    1.02496887e+02,  1.02834671e+02,  9.81686859e+01,  9.17990570e+01,
    8.99626083e+01,  8.38952560e+01,  7.68760223e+01,  6.84127655e+01,
    5.97653656e+01,  5.21836319e+01,  4.54073563e+01,  3.74353752e+01,
    2.70315666e+01,  2.02047386e+01,  1.51766062e+01,  1.26840096e+01,
    1.29558058e+01,  1.32199116e+01,  8.49339676e+00,  7.55227566e+00,
    8.60636425e+00,  4.16570759e+00,  3.00632572e+00,  1.85308552e+00,
    -5.37014008e-01, -1.16101646e+00, 1.71299553e+00,  1.56599808e+00,
    -2.56888008e+00, -2.92565250e+00, -2.53546047e+00, -3.64228153e+00,
    -2.99412537e+00, -5.09901237e+00, -9.17888737e+00, -1.02308311e+01,
    -8.78097725e+00, -1.00883408e+01, -1.23818703e+01, -1.59046021e+01,
    -2.08935680e+01, -2.48458786e+01, -3.02626495e+01, -3.81299667e+01,
    -4.51809540e+01, -4.49378738e+01, -4.56979446e+01, -4.51981354e+01,
    -4.37085304e+01, -5.04610519e+01, -5.79036560e+01, -6.22895508e+01,
    -6.71389618e+01, -7.19469757e+01, -7.74617310e+01, -8.19303894e+01,
    -8.56121216e+01, -8.60170746e+01, -8.76653748e+01, -9.12910156e+01,
    -9.23890762e+01, -9.49726944e+01, -9.62829208e+01, -9.58328552e+01,
    -9.53835754e+01, -9.56820831e+01, -9.82214127e+01, -9.94855576e+01,
    -9.64956665e+01, -9.85187988e+01, -9.87698517e+01, -1.00020981e+02,
    -1.08488113e+02, -1.10394348e+02, -1.13281960e+02, -1.13395035e+02,
    -1.12507706e+02, -1.08624008e+02, -1.01279007e+02, -9.67326050e+01,
    -8.99716644e+01, -8.47601166e+01, -7.68388367e+01, -6.97307434e+01,
    -6.59196320e+01, -6.23833237e+01, -5.71257744e+01, -4.84159470e+01,
    -4.00237274e+01, -3.09479351e+01, -2.36923714e+01, -1.82377930e+01,
    -1.38260403e+01, -1.01959686e+01, -7.09347439e+00, -3.01647282e+00,
    -4.72902298e-01, -1.93860340e+00, -1.39452553e+00, 3.38625336e+00,
    5.87873363e+00,  6.35808086e+00,  8.83133984e+00,  1.00325108e+01,
    7.48270321e+00,  8.20094490e+00,  1.09041214e+01,  1.03422928e+01,
    1.00355368e+01,  9.23083401e+00,  8.43319416e+00,  7.14059067e+00,
    4.36302853e+00,  1.35646820e+00,  -1.87413979e+00, -3.58188343e+00,
    -6.27484322e+00, -1.11920509e+01, -1.28225641e+01, -1.39445438e+01,
    -1.58020048e+01, -1.36540222e+01, -1.45186348e+01, -1.83677597e+01,
    -1.71924438e+01, -1.67798195e+01, -1.66138229e+01, -1.17115097e+01,
    -1.03418589e+01, -6.23273945e+00, 1.83181286e+00,  8.83290482e+00,
    1.55297489e+01,  1.91755180e+01,  2.17954178e+01,  2.09005489e+01,
    2.12599831e+01,  2.13667030e+01,  2.22197170e+01,  2.18160381e+01,
    2.06687164e+01,  1.97777328e+01,  2.03920708e+01,  2.27456856e+01,
    2.18336105e+01,  1.91859550e+01,  2.35446491e+01,  2.46186218e+01,
    2.36920433e+01,  2.45169220e+01,  2.58332424e+01,  2.71380348e+01,
    2.64353371e+01,  2.59841881e+01,  2.40446205e+01,  2.46075706e+01,
    2.01790657e+01,  1.92791080e+01,  1.76345711e+01,  1.62534637e+01,
    1.31337395e+01,  7.79540920e+00,  4.99437904e+00,  -3.24811935e-02,
    -4.76519966e+00, -7.96694756e+00, -1.46358099e+01, -2.07488518e+01,
    -2.73142624e+01, -3.28241730e+01, -3.40488014e+01, -3.37653008e+01,
    -3.32347221e+01, -3.29560585e+01, -3.26783104e+01, -3.26514816e+01,
    -3.31215668e+01, -3.38375740e+01, -3.37955170e+01, -3.32554550e+01,
    -3.22183838e+01, -3.16883087e+01, -3.11602097e+01, -2.86390991e+01,
    -2.71359787e+01, -2.56427803e+01, -2.46614876e+01, -2.44320374e+01,
    -2.19614601e+01, -2.17537193e+01, -1.87997799e+01, -1.56236792e+01,
    -1.49653044e+01, -1.18145981e+01, -8.69258213e+00, -5.59114838e+00,
    2.27735043e-01,  1.00816822e+00,  1.53733253e+00,  5.30420065e+00,
    7.29178524e+00,  1.15152073e+01,  1.79424438e+01,  1.98296700e+01,
    2.36970329e+01,  2.40375881e+01,  2.61254616e+01,  2.69426346e+01,
    2.40132294e+01,  2.50992393e+01,  2.41755886e+01,  2.32633572e+01,
    2.50984726e+01,  2.36749496e+01,  2.55078430e+01,  2.58240948e+01,
    2.48917999e+01,  2.44639549e+01,  2.27915649e+01,  2.16306190e+01,
    2.24760780e+01,  2.45578861e+01,  2.36291027e+01,  2.44557915e+01,
    2.60199089e+01,  2.45775146e+01,  2.46436539e+01,  2.27102928e+01,
    2.05444679e+01,  1.93921223e+01,  1.67502098e+01,  1.26317196e+01,
    1.07956047e+01,  1.19627075e+01,  1.11260242e+01,  1.10435734e+01,
    1.02123394e+01,  1.06363306e+01,  1.08055096e+01,  1.27218943e+01,
    1.53674717e+01,  1.74953194e+01,  2.11004829e+01,  2.16810398e+01,
    2.22581005e+01,  2.38276615e+01,  2.48837471e+01,  2.64304085e+01,
    2.72136688e+01,  2.79916000e+01,  2.92592087e+01,  2.77715454e+01,
    2.70436478e+01,  2.68204765e+01,  2.78450127e+01,  2.93582649e+01,
    2.93612747e+01,  2.98630962e+01,  2.86117287e+01,  2.68702087e+01,
    2.56435223e+01,  2.76676025e+01,  2.69274330e+01,  2.51971016e+01,
    2.54745750e+01,  2.37518253e+01,  2.32918816e+01,  2.35806885e+01,
    2.06222649e+01,  1.74396381e+01,  1.35307331e+01,  9.40550804e+00,
    6.80884361e+00,  3.98364449e+00,  3.17684174e+00,  -6.19629860e-01,
    -3.13577080e+00, -6.13269234e+00, -8.85344315e+00, -9.30813217e+00,
    -1.35038042e+01, -1.74124374e+01, -1.90421734e+01, -1.84161453e+01,
    -2.17863712e+01, -2.13828392e+01, -2.04866829e+01, -2.23408623e+01,
    -2.41773415e+01, -2.47511997e+01, -2.48214970e+01, -2.63872414e+01,
    -2.66894417e+01, -2.44961739e+01, -2.45634384e+01, -2.26331959e+01,
    -2.14674606e+01, -1.93091812e+01, -1.56733704e+01, -1.40609570e+01,
    -1.19618597e+01, -9.62904739e+00, -8.06447697e+00, -6.01208305e+00,
    -3.72483444e+00, -7.09707260e-01, 3.53775024e-02,  1.27750778e+00,
    4.25266075e+00,  6.20689106e+00,  1.11412544e+01,  1.27867870e+01,
    1.26766787e+01,  1.45629463e+01,  1.61825867e+01,  1.85376492e+01,
    1.93751717e+01,  2.02072353e+01,  2.25278454e+01,  2.18330421e+01,
    2.26449127e+01,  2.49413986e+01,  2.34775696e+01,  2.30234852e+01,
    2.18221149e+01,  2.16304703e+01,  2.36834908e+01,  2.47191849e+01,
    2.62476234e+01,  2.72598228e+01,  2.62708702e+01,  2.80327568e+01,
    2.82794685e+01,  2.72780895e+01,  2.72806168e+01,  2.42870483e+01,
    2.13194160e+01,  2.11176186e+01,  1.79226055e+01,  1.92443657e+01,
    1.83068123e+01,  1.78780136e+01,  1.84479294e+01,  1.70165691e+01};

const std::array<float, kNumLpcCoefficients> kAudioFrame24kHzLpcCoeffs = {
    -0.44005626, -0.8736642, 0.17899105, 0.15358731, 0.06892657};

const std::array<float, 864> kAudioFrame24kHzLpResidual = {
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
    1.12349625e+01,  8.43680286e+00,  -8.41987228e+00, -1.08991518e+01,
    -1.89256299e+00, 1.05609398e+01,  1.93546619e+01,  2.09517593e+01,
    8.52059937e+00,  -3.15217996e+00, -5.21163893e+00, -1.74916220e+00,
    2.07996392e-03,  1.89955473e-01,  -7.57417679e-01, 1.07368636e+00,
    5.53289509e+00,  -3.30344057e+00, -2.86956930e+00, 2.32738781e+00,
    2.75757551e+00,  5.42321491e+00,  4.84745836e+00,  4.32791901e+00,
    1.92009532e+00,  2.21485519e+00,  -1.74864209e+00, -4.67096710e+00,
    -5.05596542e+00, -4.97231531e+00, 7.73956585e+00,  9.86451912e+00,
    9.97954273e+00,  -5.06351531e-01, -9.04978633e-01, 9.22713470e+00,
    2.35863280e+00,  3.53965139e+00,  2.69756079e-01,  -5.34556770e+00,
    -4.25113058e+00, -4.29799938e+00, -2.31580114e+00, -5.25812721e+00,
    -1.75614929e+00, 4.71840477e+00,  1.07252073e+01,  1.04244671e+01,
    4.00084972e+00,  -2.63103604e+00, -4.96437216e+00, -2.33973217e+00,
    -3.67135048e+00, 1.82560229e+00,  6.18998146e+00,  3.27332497e+00,
    5.24704504e+00,  8.13804913e+00,  1.38154116e+01,  1.71732731e+01,
    8.87067699e+00,  -8.20367813e-01, -2.11991644e+00, -3.06648850e+00,
    -2.04527569e+00, -2.29286456e+00, -1.14658570e+00, 3.82116318e+00,
    9.30684328e-01,  2.07818747e-01,  9.21300888e-01,  2.26692128e+00,
    -1.83700681e+00, -1.65804148e-01, 6.25415897e+00,  4.84030914e+00,
    7.35604286e+00,  4.47476006e+00,  6.25224352e+00,  1.01014066e+00,
    -2.42349625e+00, 3.42983723e+00,  -2.45156145e+00, 1.78228855e+00,
    1.51789296e+00,  -3.14577055e+00, 3.18406630e+00,  4.59230280e+00,
    3.22029972e+00,  6.98838425e+00,  2.49148321e+00,  -2.20565557e+00,
    2.53921318e+00,  -3.88809013e+00, -1.48726654e+00, 1.72616780e+00,
    -2.77599144e+00, -3.25214124e+00, -3.39405441e+00, 6.23091459e+00,
    4.77360249e+00,  1.42902136e-01,  5.48717546e+00,  1.83524704e+00,
    3.40656924e+00,  7.52045870e+00,  9.17227173e+00,  9.24402905e+00,
    6.31918478e+00,  2.55479097e+00,  -2.21097255e+00, -1.33000100e+00,
    4.59559917e+00,  4.74685383e+00,  -9.39902067e-01, 3.98642302e-01,
    7.88476229e-01,  -4.25097942e-01, -9.02165890e-01, 1.78314638e+00,
    4.67485905e+00,  -1.36903620e+00, 1.76362467e+00,  2.95447588e+00,
    4.66746688e-01,  7.41730213e+00,  4.09058809e+00,  3.01143312e+00,
    7.10531139e+00,  2.88184404e+00,  8.47140598e+00,  8.70842838e+00,
    4.59989786e+00,  7.37639999e+00,  1.83506536e+00,  9.67312813e-01,
    4.63792515e+00,  3.16918135e-01,  3.77882361e+00,  -2.05208373e+00,
    -8.57614040e+00, -1.76649427e+00, -5.45739079e+00, -1.14673829e+00,
    7.86123943e+00,  5.95670652e+00,  3.65032768e+00,  6.55935764e-01,
    2.56648636e+00,  1.81333625e+00,  -2.07326651e+00, -1.78729117e+00,
    -7.27353001e+00, -7.09818649e+00, -6.18081284e+00, -6.96391201e+00,
    -2.28517151e+00, 1.68549314e-01,  -1.35028124e+00, -1.96366096e+00,
    4.03369617e+00,  2.34370232e+00,  1.87591612e+00,  1.06576710e+01,
    7.96625757e+00,  1.11652637e+00,  3.57532501e+00,  4.71469593e+00,
    1.34890461e+00,  3.91209650e+00,  1.86650491e+00,  -4.50892782e+00,
    -3.76898623e+00, -4.00152540e+00, -2.05830336e+00, 2.75846219e+00,
    7.66270280e-01,  -3.58589172e-01, 6.53276205e-01,  2.26910114e+00,
    1.84640968e+00,  1.82875514e+00,  1.96743798e+00,  -1.03365695e+00,
    5.92410564e-01,  3.21474695e+00,  3.64604235e+00,  5.11459732e+00,
    2.32849860e+00,  1.04510057e+00,  3.81436634e+00,  7.83421850e+00,
    6.44709587e+00,  2.07710838e+00,  -1.29136586e+00, -4.47988892e+00,
    -4.34261703e+00, -6.22150898e-02, -9.41121578e-02, -4.76238680e+00,
    -2.50673962e+00, -4.16970873e+00, -9.41527843e+00, -9.28101730e+00,
    -8.24183273e+00, -7.39391232e+00, -6.98044205e+00, -3.71347809e+00,
    -4.69899940e+00, -3.68851876e+00, -2.98389626e+00, -3.44220877e+00,
    -2.39363551e+00, -5.31608295e+00, -2.14819264e+00, -1.50056291e+00,
    2.37848759e-01,  -1.32165909e+00, -4.81198978e+00, 1.14302683e+00,
    -1.64657950e+00, -3.73184681e-01, 2.05143094e+00,  -1.12909675e+00,
    8.16976786e-01,  -7.74150610e-01, -8.89106035e-01, -1.48250735e+00,
    -7.09583044e-01, -1.30536461e+00, -5.74051738e-01, 4.05788755e+00,
    1.54551375e+00,  -2.40562630e+00, -4.18438625e+00, -2.80732095e-01,
    3.86453867e-02,  4.32831466e-01,  7.10942507e-01,  -4.18539464e-01,
    -1.38158882e+00, -2.16930246e+00, 1.37717557e+00,  2.01659513e+00,
    3.86974424e-01,  -6.19261169e+00, -6.37403202e+00, 2.42824602e+00,
    -7.44868755e-01, -1.42562342e+00, -1.41591907e+00, -7.26095676e-01,
    3.57659161e-01,  -3.12911224e+00, -9.82246697e-01, -1.23597121e+00,
    -2.43515468e+00, -3.47754526e+00, -4.38320112e+00, -2.66862416e+00,
    -2.58315206e-02, -1.83988822e+00, -2.12326527e-01, 1.84967339e+00,
    -1.88761234e-01, 2.76465917e+00,  3.08992743e-01,  2.55932212e-01,
    3.56884003e+00,  -6.21973276e-01, -2.33303142e+00, -6.17017269e-01,
    3.23244333e+00,  -1.57201350e+00, -3.86663699e+00, -1.72729981e+00,
    -1.55229437e+00, -3.42659593e-01, -4.16803896e-01, 2.56728435e+00,
    1.10173845e+00,  -2.36512327e+00, -1.16999596e-01, 1.85838830e+00,
    2.36341310e+00,  3.62537336e+00,  7.23151636e+00,  3.10893106e+00,
    -2.03285670e+00, 1.66768432e+00,  6.09662342e+00,  2.89146876e+00,
    2.66875446e-01,  3.18700027e+00,  -1.64463985e+00, -2.28196454e+00,
    1.15988898e+00,  2.29831338e-01,  2.30361843e+00,  -1.18075359e+00,
    -1.28650510e+00, -1.71189284e+00, -5.16229534e+00, -3.05309033e+00,
    -5.14367819e+00, -3.29433250e+00, -8.19492626e+00, -1.46340494e+01,
    -6.36875868e+00, -6.83464479e+00, -1.01390524e+01, -9.13552666e+00,
    -1.17974844e+01, -1.15259895e+01, -7.20165825e+00, -3.56293440e+00,
    -6.18850994e+00, -1.04466343e+01, -6.40063667e+00, -4.86399937e+00,
    -8.89466476e+00, -3.03951597e+00, -3.24905968e+00, -7.39724541e+00,
    -3.67630053e+00, -3.34458828e+00, -6.98089600e-03, 2.91155243e+00,
    1.38332987e+00,  2.30655336e+00,  5.17395973e+00,  6.48775387e+00,
    4.63999653e+00,  6.37904453e+00,  5.94882536e+00,  1.01792765e+00,
    -7.71977186e-01, 1.52610278e+00,  -1.84056306e+00, -7.61894178e+00,
    -2.68715143e+00, -2.74878073e+00, 2.60109484e-01,  5.99051952e+00,
    5.01046610e+00,  9.72811508e+00,  1.10977354e+01,  8.59578705e+00,
    7.78422308e+00,  9.77290630e+00,  4.78020620e+00,  6.95409298e+00,
    1.25777769e+01,  9.54867268e+00,  1.39864359e+01,  1.30786066e+01,
    9.93707085e+00,  1.17354641e+01,  1.06798706e+01,  1.19985161e+01,
    7.04702950e+00,  5.13089848e+00,  3.57186460e+00,  -1.61855221e-01,
    5.11069822e+00,  4.53526974e+00,  -4.30026054e-02, -1.74518919e+00,
    -2.34292221e+00, -1.04009485e+00, 6.38303757e-02,  -1.63379145e+00,
    -5.87782288e+00, -4.13494444e+00, -5.96971512e-02, 2.07107258e+00,
    4.46333551e+00,  4.11992455e+00,  -2.64923072e+00, -2.42191291e+00,
    3.09291959e+00,  -1.77607775e+00, -2.77842140e+00, 1.76519930e-01,
    -1.39099002e+00, -7.72562027e-01, 3.77362537e+00,  2.22222757e+00,
    -4.91715288e+00, -3.07207823e+00, 1.45969903e+00,  -7.17165172e-02,
    1.35504156e-02,  -1.67952967e+00, -5.56218052e+00, -3.00687003e+00,
    2.11684227e+00,  8.16370696e-02,  -3.86325240e+00, -5.41777229e+00,
    -6.93659639e+00, -6.12717915e+00, -6.51893806e+00, -1.01416893e+01,
    -1.07146549e+01, -2.41580248e+00, 3.64805698e-01,  -1.85702205e+00,
    -1.50501394e+00, -9.93442631e+00, -1.57174749e+01, -1.06377697e+01,
    -8.00020599e+00, -9.10899544e+00, -1.06647530e+01, -1.05606289e+01,
    -9.36555672e+00, -6.30603218e+00, -6.53777599e+00, -1.08097210e+01,
    -9.81819153e+00, -9.36201096e+00, -9.50599384e+00, -7.08914137e+00,
    -6.57421255e+00, -8.17064857e+00, -1.12698994e+01, -1.10965691e+01,
    -5.28526497e+00, -7.98907518e+00, -1.05988531e+01, -9.80598450e+00,
    -1.74932556e+01, -1.47299938e+01, -9.78327847e+00, -8.68522644e+00,
    -6.95321894e+00, -4.75444651e+00, -4.88850594e-01, -2.62528086e+00,
    -3.45844936e+00, -3.22178793e+00, -1.29111671e+00, 1.92710876e-01,
    -3.76009941e+00, -5.42670441e+00, -2.20685339e+00, 3.41966438e+00,
    5.09398031e+00,  4.61413145e+00,  3.15407324e+00,  6.88840389e-01,
    -1.24893188e-01, 6.93435669e-02,  4.36257124e-01,  2.10404348e+00,
    1.84627008e+00,  -2.88373661e+00, -2.46043539e+00, 4.65674496e+00,
    4.97939920e+00,  2.32710823e-01,  1.15569329e+00,  2.06760263e+00,
    -2.37345028e+00, -8.94458294e-01, 4.34822655e+00,  1.86791062e+00,
    -7.33544350e-01, -4.93999541e-01, -3.05405319e-01, -4.98838603e-01,
    -2.24058604e+00, -3.18306851e+00, -3.07330084e+00, -1.48333597e+00,
    -1.65616667e+00, -5.12779331e+00, -3.25079870e+00, -3.26250583e-01,
    -1.67690611e+00, 1.03601313e+00,  5.87880611e-02,  -5.90365076e+00,
    -2.25726986e+00, 1.04811013e+00,  -6.68003023e-01, 3.36036682e+00,
    2.41676140e+00,  1.81427836e+00,  7.80537701e+00,  8.67715263e+00,
    6.53116703e+00,  3.28234124e+00,  1.22207856e+00,  -1.18105686e+00,
    -5.53069651e-01, 1.66776621e+00,  2.65329361e+00,  1.88847780e+00,
    1.86176062e-01,  3.46606493e-01,  2.42151356e+00,  5.07464123e+00,
    2.22660089e+00,  -2.18192244e+00, 4.59295511e+00,  6.30259514e+00,
    6.43608332e-01,  1.24859726e+00,  3.69062090e+00,  3.99502039e+00,
    1.64748001e+00,  6.64040923e-01,  2.94990540e-02,  2.00547361e+00,
    -1.07497215e+00, -9.82857823e-01, 1.40943646e+00,  6.98390484e-01,
    -1.17924082e+00, -4.67591381e+00, -2.96400404e+00, -2.97822189e+00,
    -4.58153629e+00, -2.84512520e+00, -5.66815090e+00, -7.86150599e+00,
    -7.55694342e+00, -6.84857988e+00, -2.25169349e+00, 8.10826421e-01,
    -1.29376292e-01, -1.84986091e+00, -2.67541099e+00, -2.96016479e+00,
    -3.53380632e+00, -3.93730497e+00, -3.10279775e+00, -2.01656961e+00,
    -1.45240784e+00, -1.98537946e+00, -2.54282141e+00, -4.45740938e-01,
    -2.22046852e-01, -1.34549046e+00, -1.76560950e+00, -2.57988167e+00,
    -3.95694733e-01, -9.67026353e-01, 3.17455530e-02,  2.27153969e+00,
    -6.16050959e-01, 2.01011539e-01,  2.39784122e+00,  2.18200874e+00,
    4.79247808e+00,  1.39076424e+00,  -2.25545764e+00, 2.32977057e+00,
    3.44457793e+00,  4.11802912e+00,  7.75954199e+00,  4.09934521e+00,
    2.84183693e+00,  1.76781189e+00,  1.94309008e+00,  2.96903515e+00,
    -1.35905910e+00, 9.94700193e-01,  2.64287138e+00,  9.33369160e-01,
    3.77767062e+00,  2.14313602e+00,  2.76889658e+00,  3.64695168e+00,
    9.38329816e-01,  8.80375028e-01,  4.50770497e-01,  4.07597780e-01,
    3.02707434e+00,  5.32179499e+00,  2.24410486e+00,  1.51846194e+00,
    3.95268965e+00,  1.31151724e+00,  7.94691920e-01,  4.35307741e-01,
    -8.98479462e-01, 4.89481926e-01,  -1.88446522e-01, -2.81762767e+00,
    -1.20539308e+00, 3.56873465e+00,  2.60024309e+00,  7.23030448e-01,
    3.02082777e-01,  1.06683517e+00,  1.71283555e+00,  2.96522927e+00,
    4.56222582e+00,  3.88970065e+00,  4.64536762e+00,  2.55995440e+00,
    6.51117444e-01,  2.61398029e+00,  3.27950025e+00,  3.43110180e+00,
    3.02066183e+00,  2.57252216e+00,  3.36071491e+00,  1.08611763e+00,
    2.71559238e-01,  2.06878185e+00,  3.80949211e+00,  4.79546642e+00,
    2.98317933e+00,  2.26053524e+00,  1.19854116e+00,  -1.27157092e-01,
    7.00385094e-01,  4.63907862e+00,  3.61058998e+00,  -1.35685086e-01,
    1.60374320e+00,  1.36445570e+00,  1.13631856e+00,  2.86552167e+00,
    -2.03163147e-01, -2.66402864e+00, -2.72542191e+00, -2.86683774e+00,
    -1.23723328e+00, -7.08076358e-01, 4.38876033e-01,  -1.90207076e+00,
    -3.23151374e+00, -2.56165457e+00, -2.76350975e+00, -4.91678298e-01,
    -3.29478669e+00, -6.08054972e+00, -3.03048444e+00, 7.19196975e-01,
    -2.87802696e+00, -2.71956229e+00, 5.35800815e-01,  -2.68471098e+00,
    -4.89043188e+00, -3.04612255e+00, -1.42585444e+00, -3.01102614e+00,
    -3.07537198e+00, 3.91513705e-01,  -7.07496524e-01, -9.63248014e-01,
    -3.49920869e-01, -8.70256424e-02, 2.06689930e+00,  6.94219232e-01,
    -3.94313216e-01, 6.68681502e-01,  3.68562102e-01,  5.68332195e-01,
    1.43658853e+00,  2.43511271e+00,  6.23535573e-01,  -2.63962984e-01,
    2.54606652e+00,  2.85995841e+00,  4.87965393e+00,  3.42110562e+00,
    -8.31755459e-01, 1.05374289e+00,  3.12660599e+00,  3.69410491e+00,
    2.51437950e+00,  1.49237084e+00,  3.51541901e+00,  1.69572353e+00,
    1.22580469e+00,  4.37293816e+00,  1.47862697e+00,  -1.39091730e-01,
    6.26108408e-01,  1.50650907e+00,  4.54564524e+00,  4.45965481e+00,
    3.48856354e+00,  3.17854595e+00,  8.96316171e-01,  2.78322864e+00,
    3.60593390e+00,  1.04048753e+00,  1.50137532e+00,  -3.71839166e-01,
    -2.04424739e+00, 1.53891206e+00,  4.20960307e-01,  2.33422971e+00,
    2.90814924e+00,  9.29730177e-01,  2.23940945e+00,  7.46851921e-01};

}  // namespace

TEST(RnnVadTest, CheckEmptyFrame) {
  {
    FloatingPointExceptionObserver fpe_observer;

    // Input frame (empty, i.e., all samples set to 0).
    std::array<float, kFrameSize10ms24kHz> empty_frame;
    empty_frame.fill(0.f);
    // Compute inverse filter coefficients.
    std::array<float, kNumLpcCoefficients> lpc_coeffs;
    ComputeInverseFilterCoefficients({empty_frame},
                                     {lpc_coeffs.data(), lpc_coeffs.size()});
    // Compute LP residual.
    std::array<float, kFrameSize10ms24kHz> lp_residual;
    ComputeLpResidual({lpc_coeffs.data(), lpc_coeffs.size()}, {empty_frame},
                      {lp_residual});
  }
}

TEST(RnnVadTest, ComputeInverseFilterCoefficientsBitExactness) {
  {
    FloatingPointExceptionObserver fpe_observer;

    std::array<float, kNumLpcCoefficients> lpc_coeffs;
    ComputeInverseFilterCoefficients(
        {kAudioFrame24kHzSamples.data(), kAudioFrame24kHzSamples.size()},
        {lpc_coeffs.data(), lpc_coeffs.size()});
    ExpectNearAbsolute({kAudioFrame24kHzLpcCoeffs}, {lpc_coeffs}, 3e-6f);
  }
}

TEST(RnnVadTest, ComputeLpResidualBitExactness) {
  {
    FloatingPointExceptionObserver fpe_observer;

    std::array<float, kAudioFrame24kHzSamples.size()> lp_residual;
    ComputeLpResidual(
        {kAudioFrame24kHzLpcCoeffs.data(), kAudioFrame24kHzLpcCoeffs.size()},
        {kAudioFrame24kHzSamples}, {lp_residual});
    ExpectNearAbsolute({kAudioFrame24kHzLpResidual}, {lp_residual}, 3e-6f);
  }
}

}  // namespace test
}  // namespace webrtc
