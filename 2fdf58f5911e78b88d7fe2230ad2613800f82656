{
  "comments": [
    {
      "key": {
        "uuid": "acff9ba7_46527cda",
        "filename": "modules/audio_coding/neteq/delay_manager.cc",
        "patchSetId": 2
      },
      "lineNbr": 227,
      "author": {
        "id": 7015
      },
      "writtenOn": "2019-02-25T14:28:15Z",
      "side": 1,
      "message": "I would not touch this part unless it is not necessary. Can we only convert to ms inside enable_delay_histogram_?",
      "range": {
        "startLine": 220,
        "startChar": 0,
        "endLine": 227,
        "endChar": 5
      },
      "revId": "2fdf58f5911e78b88d7fe2230ad2613800f82656",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "408a26cc_be1b96f6",
        "filename": "modules/audio_coding/neteq/delay_manager.cc",
        "patchSetId": 2
      },
      "lineNbr": 227,
      "author": {
        "id": 8038
      },
      "writtenOn": "2019-02-25T14:49:06Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "acff9ba7_46527cda",
      "range": {
        "startLine": 220,
        "startChar": 0,
        "endLine": 227,
        "endChar": 5
      },
      "revId": "2fdf58f5911e78b88d7fe2230ad2613800f82656",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "11d70e61_ae786196",
        "filename": "modules/audio_coding/neteq/delay_manager.cc",
        "patchSetId": 2
      },
      "lineNbr": 227,
      "author": {
        "id": 8038
      },
      "writtenOn": "2019-02-25T15:15:07Z",
      "side": 1,
      "message": "This will reduce the precision of iat_ms, especially for larger packet lengths, since we round down to whole packets.",
      "parentUuid": "408a26cc_be1b96f6",
      "range": {
        "startLine": 220,
        "startChar": 0,
        "endLine": 227,
        "endChar": 5
      },
      "revId": "2fdf58f5911e78b88d7fe2230ad2613800f82656",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7f72ed25_17e38bff",
        "filename": "modules/audio_coding/neteq/delay_manager.cc",
        "patchSetId": 2
      },
      "lineNbr": 227,
      "author": {
        "id": 7015
      },
      "writtenOn": "2019-02-25T15:23:25Z",
      "side": 1,
      "message": "Ok, but it is good to make sure that the old histogram got no change. Maybe we compute this twice?",
      "parentUuid": "11d70e61_ae786196",
      "range": {
        "startLine": 220,
        "startChar": 0,
        "endLine": 227,
        "endChar": 5
      },
      "revId": "2fdf58f5911e78b88d7fe2230ad2613800f82656",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "55ebe8f6_af326972",
        "filename": "modules/audio_coding/neteq/delay_manager.cc",
        "patchSetId": 2
      },
      "lineNbr": 227,
      "author": {
        "id": 8038
      },
      "writtenOn": "2019-02-25T16:00:50Z",
      "side": 1,
      "message": "Sounds good.",
      "parentUuid": "7f72ed25_17e38bff",
      "range": {
        "startLine": 220,
        "startChar": 0,
        "endLine": 227,
        "endChar": 5
      },
      "revId": "2fdf58f5911e78b88d7fe2230ad2613800f82656",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8d8f5833_a6b8bfcf",
        "filename": "modules/audio_coding/neteq/delay_manager.cc",
        "patchSetId": 2
      },
      "lineNbr": 244,
      "author": {
        "id": 7015
      },
      "writtenOn": "2019-02-25T12:16:55Z",
      "side": 1,
      "message": "I would not touch this part unless it is not necessary. Can we only convert to ms inside enable_delay_histogram_?",
      "range": {
        "startLine": 244,
        "startChar": 0,
        "endLine": 244,
        "endChar": 31
      },
      "revId": "2fdf58f5911e78b88d7fe2230ad2613800f82656",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "55c479d2_70f3103b",
        "filename": "modules/audio_coding/neteq/delay_manager.cc",
        "patchSetId": 2
      },
      "lineNbr": 244,
      "author": {
        "id": 8038
      },
      "writtenOn": "2019-02-25T14:22:46Z",
      "side": 1,
      "message": "Not sure if I follow. You mean when we compensate for gap in sequence numbers and reordering?",
      "parentUuid": "8d8f5833_a6b8bfcf",
      "range": {
        "startLine": 244,
        "startChar": 0,
        "endLine": 244,
        "endChar": 31
      },
      "revId": "2fdf58f5911e78b88d7fe2230ad2613800f82656",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0517cca7_deb10096",
        "filename": "modules/audio_coding/neteq/delay_manager.cc",
        "patchSetId": 2
      },
      "lineNbr": 244,
      "author": {
        "id": 7015
      },
      "writtenOn": "2019-02-25T14:28:15Z",
      "side": 1,
      "message": "Oh, not actually on this line. I put this on the right lines.",
      "parentUuid": "55c479d2_70f3103b",
      "range": {
        "startLine": 244,
        "startChar": 0,
        "endLine": 244,
        "endChar": 31
      },
      "revId": "2fdf58f5911e78b88d7fe2230ad2613800f82656",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6c7fd8bc_e73906d2",
        "filename": "modules/audio_coding/neteq/delay_manager.cc",
        "patchSetId": 2
      },
      "lineNbr": 244,
      "author": {
        "id": 8038
      },
      "writtenOn": "2019-02-25T14:49:06Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "0517cca7_deb10096",
      "range": {
        "startLine": 244,
        "startChar": 0,
        "endLine": 244,
        "endChar": 31
      },
      "revId": "2fdf58f5911e78b88d7fe2230ad2613800f82656",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b31b248d_b0f79b14",
        "filename": "modules/audio_coding/neteq/delay_manager.cc",
        "patchSetId": 2
      },
      "lineNbr": 280,
      "author": {
        "id": 7015
      },
      "writtenOn": "2019-02-25T12:16:55Z",
      "side": 1,
      "message": "can we use https://cs.chromium.org/chromium/src/third_party/webrtc/rtc_base/numerics/moving_average.h\nor at least the O(1) sum in that?",
      "range": {
        "startLine": 280,
        "startChar": 18,
        "endLine": 280,
        "endChar": 53
      },
      "revId": "2fdf58f5911e78b88d7fe2230ad2613800f82656",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5e38e3e9_d708a27f",
        "filename": "modules/audio_coding/neteq/delay_manager.cc",
        "patchSetId": 2
      },
      "lineNbr": 280,
      "author": {
        "id": 8038
      },
      "writtenOn": "2019-02-25T14:22:46Z",
      "side": 1,
      "message": "No, since we do max(sum, 0) in each iteration. This is basically sliding window minimum. Not sure if there is a container implementing that? Otherwise I can implement it but it would add complexity (and it\u0027s only 100 elements).",
      "parentUuid": "b31b248d_b0f79b14",
      "range": {
        "startLine": 280,
        "startChar": 18,
        "endLine": 280,
        "endChar": 53
      },
      "revId": "2fdf58f5911e78b88d7fe2230ad2613800f82656",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7dd970a2_53d9e3aa",
        "filename": "modules/audio_coding/neteq/delay_manager.cc",
        "patchSetId": 2
      },
      "lineNbr": 280,
      "author": {
        "id": 7015
      },
      "writtenOn": "2019-02-25T14:34:40Z",
      "side": 1,
      "message": "Ok. But any reason for delay_history_ to have negative values?",
      "parentUuid": "5e38e3e9_d708a27f",
      "range": {
        "startLine": 280,
        "startChar": 18,
        "endLine": 280,
        "endChar": 53
      },
      "revId": "2fdf58f5911e78b88d7fe2230ad2613800f82656",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "14ee098d_0a4cec5f",
        "filename": "modules/audio_coding/neteq/delay_manager.cc",
        "patchSetId": 2
      },
      "lineNbr": 280,
      "author": {
        "id": 8038
      },
      "writtenOn": "2019-02-25T14:49:06Z",
      "side": 1,
      "message": "Yes, we store the iat delays in the history. If a packet comes in with iat \u003c packet_len then the delay will be negative. This will e.g. happen when network queues are drained.",
      "parentUuid": "7dd970a2_53d9e3aa",
      "range": {
        "startLine": 280,
        "startChar": 18,
        "endLine": 280,
        "endChar": 53
      },
      "revId": "2fdf58f5911e78b88d7fe2230ad2613800f82656",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "21b30919_235b7c0c",
        "filename": "modules/audio_coding/neteq/delay_manager.cc",
        "patchSetId": 2
      },
      "lineNbr": 280,
      "author": {
        "id": 7015
      },
      "writtenOn": "2019-02-25T15:21:45Z",
      "side": 1,
      "message": "So we allow a negative value to cancel out positives if there are enough positives in the time window before a negative, which, I think, makes good sense. But it means earlier negatives have less chance to cancel out any positives.\n\n-1, -1, -1, 1, 1, 1 -\u003e 3\n1, 1, 1, -1, -1, -1 -\u003e 0\n\nWould you help to judge my following alternative:\n\nvoid UpdateDelayHistory(new_value) {\n  oldest \u003d histogram_.pop_front();\n  sum_ -\u003d oldest;\n  if (sum_ + new_value \u003c 0) {\n    histogram_.push_back(-sum_); // Clamp new_value to ensure the sum is greater than 0. \n    sum_ \u003d 0;\n  } else {\n    histogram_ \u003d push_back(new_value);\n    sum_ +\u003d new_value;\n  }\n  RTC_DCHECK_EQ(sum_, std::accumulate(histogram_.begin(), histogram_.end(), 0));\n}",
      "parentUuid": "14ee098d_0a4cec5f",
      "range": {
        "startLine": 280,
        "startChar": 18,
        "endLine": 280,
        "endChar": 53
      },
      "revId": "2fdf58f5911e78b88d7fe2230ad2613800f82656",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fbf93814_9f8ac28d",
        "filename": "modules/audio_coding/neteq/delay_manager.cc",
        "patchSetId": 2
      },
      "lineNbr": 280,
      "author": {
        "id": 8038
      },
      "writtenOn": "2019-02-25T16:00:50Z",
      "side": 1,
      "message": "That is intentional. What we effectively do is calculating the relative delay from the lowest point in the history until now.\n\nNot sure about histogram_.push_back(-sum_); ?",
      "parentUuid": "21b30919_235b7c0c",
      "range": {
        "startLine": 280,
        "startChar": 18,
        "endLine": 280,
        "endChar": 53
      },
      "revId": "2fdf58f5911e78b88d7fe2230ad2613800f82656",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "db3f3012_fa949aa4",
        "filename": "modules/audio_coding/neteq/delay_manager.h",
        "patchSetId": 2
      },
      "lineNbr": 31,
      "author": {
        "id": 7015
      },
      "writtenOn": "2019-02-25T12:16:55Z",
      "side": 1,
      "message": "I think it makes it clearer to introduce a\n\nenum HistogramMode {\n  INTER_ARRIVAL_TIME,\n  RELATIVE_ARRIVAL_DELAY,\n}",
      "range": {
        "startLine": 31,
        "startChar": 2,
        "endLine": 31,
        "endChar": 14
      },
      "revId": "2fdf58f5911e78b88d7fe2230ad2613800f82656",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f3d4e9a9_517131c9",
        "filename": "modules/audio_coding/neteq/delay_manager.h",
        "patchSetId": 2
      },
      "lineNbr": 31,
      "author": {
        "id": 8038
      },
      "writtenOn": "2019-02-25T14:22:46Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "db3f3012_fa949aa4",
      "range": {
        "startLine": 31,
        "startChar": 2,
        "endLine": 31,
        "endChar": 14
      },
      "revId": "2fdf58f5911e78b88d7fe2230ad2613800f82656",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767",
      "unresolved": false
    }
  ]
}