{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "dc0645b1_f0875729",
        "filename": "test/network/network_emulation.cc",
        "patchSetId": 1
      },
      "lineNbr": 558,
      "author": {
        "id": 5234
      },
      "writtenOn": "2021-02-22T09:21:05Z",
      "side": 0,
      "message": "This is a problem, when the call goes to ActionReceiver::OnPacketReceived, which calls back to UnbindReceiver. And deadlocks with a non-reentrant mutex.\n\nOne way to fix this usecase might be to add a return value to OnPacketReceived, and do the unbinding here (without taking the lock again).",
      "range": {
        "startLine": 555,
        "startChar": 0,
        "endLine": 558,
        "endChar": 50
      },
      "revId": "a21ea29ff0e3f7c655aa2c27abf107c6840d2914",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fd4503df_cc95bdbe",
        "filename": "test/network/network_emulation.cc",
        "patchSetId": 1
      },
      "lineNbr": 558,
      "author": {
        "id": 5234
      },
      "writtenOn": "2021-02-22T16:11:11Z",
      "side": 0,
      "message": "Adding return value has the drawback that its an api change, and not really fitting well in EmulatedNetworkReceiverInterface.\n\nSince only use is in CrossTrafficRouteImpl::NetworkDelayedAction, a more local change would be to update the EmulatedEndpointImpl::port_to_receiver_ mapping to include a \"one-shot\" flag, which implies that the binding is removed after first received packet. (Or reimplement the NetworkDelayedAction in some completely different way, without binding any port, but that sounds harder).",
      "parentUuid": "dc0645b1_f0875729",
      "range": {
        "startLine": 555,
        "startChar": 0,
        "endLine": 558,
        "endChar": 50
      },
      "revId": "a21ea29ff0e3f7c655aa2c27abf107c6840d2914",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "18f96c3c_e768d00f",
        "filename": "test/network/network_emulation.cc",
        "patchSetId": 1
      },
      "lineNbr": 558,
      "author": {
        "id": 6337
      },
      "writtenOn": "2021-02-23T09:22:40Z",
      "side": 0,
      "message": "I\u0027ll say the issue arise from the fact that we call receiver holding a lock. Maybe we can relax that and actually free the lock before call to the receiver-\u003eOnPacketReceived(...). The idea was to protect against removing receiver before processing of packet. We can partly put this burden on the client, so client should ensure that receiver isn\u0027t destroyed before all packets it could receive are processed. But it might be complicated for client.",
      "parentUuid": "fd4503df_cc95bdbe",
      "range": {
        "startLine": 555,
        "startChar": 0,
        "endLine": 558,
        "endChar": 50
      },
      "revId": "a21ea29ff0e3f7c655aa2c27abf107c6840d2914",
      "serverId": "58829da1-049c-39fb-b951-ebdcd0984767"
    }
  ]
}